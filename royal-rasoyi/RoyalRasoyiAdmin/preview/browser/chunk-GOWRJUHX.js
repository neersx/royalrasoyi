import{b as Se}from"./chunk-FYT76MYP.js";import{$ as Qh,$a as Zh,A as qy,B as bl,C as Vi,Ca as Oi,D as jy,E as Wh,Fa as Xh,Fb as Yy,G as Gy,Ga as Xt,Gb as Xy,H as Sl,I as vn,Ib as wo,J as $h,Ja as mo,La as Pl,M as Ky,Ma as go,Na as at,Oa as _o,P as bt,Pb as td,Q as Yt,Qa as Tn,R as ke,S as z,Sb as nd,T as be,U as zy,V as Wy,X as wn,Xa as Ft,Ya as En,Yb as xl,Za as yo,_ as Hh,_a as Jh,a as jn,b as Ht,bb as ed,cc as Jy,db as Qy,e as Rr,ea as Rl,eb as vo,f as Uy,fb as _t,h as uo,i as Al,ia as De,j as Gn,k as Qt,l as Ae,ma as po,na as Kn,q as ho,qb as In,r as fo,sa as $y,sb as Fi,ta as Yh,x as Cl,xa as Be,za as Hy}from"./chunk-L5NC32A4.js";import{A as $,B as ft,C as Ue,D as sd,E as lv,F as Io,G as ne,H as yt,I as Fl,J as od,K as Rt,L as Wn,M as Mi,N as Ml,O as Ll,P as cv,Q as Mt,R as qe,a as O,b as Pr,c as Nl,d as Zy,e as ev,f as ze,g as kl,h as To,i as id,j as tv,k as Jt,l as rd,m as Dl,n as nv,o as iv,p as Vl,q as Ve,r as rv,s as sv,t as St,u as zn,v as Ol,w as Eo,x as xr,y as ov,z as av}from"./chunk-XK72FEAY.js";import{a as Ke,b as Ot,e as zh,f as N}from"./chunk-ZY7WU73K.js";var Li=function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n}(Li||{}),uk="*";function dv(n,e){return{type:Li.Trigger,name:n,definitions:e,options:{}}}function ad(n,e=null){return{type:Li.Animate,styles:e,timings:n}}function hk(n,e=null){return{type:Li.Sequence,steps:n,options:e}}function Bl(n){return{type:Li.Style,styles:n,offset:null}}function Ul(n,e,t){return{type:Li.State,name:n,styles:e,options:t}}function ld(n,e,t=null){return{type:Li.Transition,expr:n,animation:e,options:t}}var uv=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(e=0,t=0){this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},hv=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(e){this.players=e;let t=0,i=0,r=0,s=this.players.length;s==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++i==s&&this._onDestroy()}),o.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(i=>{let r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){let e=this.players.reduce((t,i)=>t===null||i.totalTime>t.totalTime?i:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},dk="!";var fv=["toast-component",""];function GC(n,e){if(n&1){let t=ed();Ft(0,"button",5),vo("click",function(){Hh(t);let r=_t();return Qh(r.remove())}),Ft(1,"span",6),In(2,"\xD7"),En()()}}function KC(n,e){if(n&1&&(Jh(0),In(1),Zh()),n&2){let t=_t(2);Be(),Fi("[",t.duplicatesCount+1,"]")}}function zC(n,e){if(n&1&&(Ft(0,"div"),In(1),mo(2,KC,2,1,"ng-container",4),En()),n&2){let t=_t();Tn(t.options.titleClass),go("aria-label",t.title),Be(),Fi(" ",t.title," "),Be(),at("ngIf",t.duplicatesCount)}}function WC(n,e){if(n&1&&yo(0,"div",7),n&2){let t=_t();Tn(t.options.messageClass),at("innerHTML",t.message,Yh)}}function $C(n,e){if(n&1&&(Ft(0,"div",8),In(1),En()),n&2){let t=_t();Tn(t.options.messageClass),go("aria-label",t.message),Be(),Fi(" ",t.message," ")}}function HC(n,e){if(n&1&&(Ft(0,"div"),yo(1,"div",9),En()),n&2){let t=_t();Be(),_o("width",t.width()+"%")}}function QC(n,e){if(n&1){let t=ed();Ft(0,"button",5),vo("click",function(){Hh(t);let r=_t();return Qh(r.remove())}),Ft(1,"span",6),In(2,"\xD7"),En()()}}function YC(n,e){if(n&1&&(Jh(0),In(1),Zh()),n&2){let t=_t(2);Be(),Fi("[",t.duplicatesCount+1,"]")}}function XC(n,e){if(n&1&&(Ft(0,"div"),In(1),mo(2,YC,2,1,"ng-container",4),En()),n&2){let t=_t();Tn(t.options.titleClass),go("aria-label",t.title),Be(),Fi(" ",t.title," "),Be(),at("ngIf",t.duplicatesCount)}}function JC(n,e){if(n&1&&yo(0,"div",7),n&2){let t=_t();Tn(t.options.messageClass),at("innerHTML",t.message,Yh)}}function ZC(n,e){if(n&1&&(Ft(0,"div",8),In(1),En()),n&2){let t=_t();Tn(t.options.messageClass),go("aria-label",t.message),Be(),Fi(" ",t.message," ")}}function eb(n,e){if(n&1&&(Ft(0,"div"),yo(1,"div",9),En()),n&2){let t=_t();Be(),_o("width",t.width()+"%")}}var cd=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},ud=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},hd=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new Ht;_activate=new Ht;_manualClose=new Ht;_resetTimeout=new Ht;_countDuplicate=new Ht;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},Nr=class{toastId;config;message;title;toastType;toastRef;_onTap=new Ht;_onAction=new Ht;constructor(e,t,i,r,s,o){this.toastId=e,this.config=t,this.message=i,this.title=r,this.toastType=s,this.toastRef=o,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},pv={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},mv=new ke("ToastConfig"),dd=class extends ud{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,i){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=i}attachComponentPortal(e,t){let i=this._componentFactoryResolver.resolveComponentFactory(e.component),r;return r=i.create(e.injector),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.detachView(r.hostView),r.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(r),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(r)),r}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},tb=(()=>{class n{_document=be(td);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(i){return new(i||n)};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),fd=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},nb=(()=>{class n{_overlayContainer=be(tb);_componentFactoryResolver=be(Hy);_appRef=be(Pl);_document=be(td);_paneElements=new Map;create(t,i){return this._createOverlayRef(this.getPaneElement(t,i))}getPaneElement(t="",i){return this._paneElements.get(i)||this._paneElements.set(i,{}),this._paneElements.get(i)[t]||(this._paneElements.get(i)[t]=this._createPaneElement(t,i)),this._paneElements.get(i)[t]}_createPaneElement(t,i){let r=this._document.createElement("div");return r.id="toast-container",r.classList.add(t),r.classList.add("toast-container"),i?i.getContainerElement().appendChild(r):this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalHost(t){return new dd(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new fd(this._createPortalHost(t))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),gv=(()=>{class n{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,i,r,s,o){this.overlay=i,this._injector=r,this.sanitizer=s,this.ngZone=o,this.toastrConfig=Ke(Ke({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=Ke(Ke({},t.default.iconClasses),t.config.iconClasses))}show(t,i,r={},s=""){return this._preBuildNotification(s,t,i,this.applyConfig(r))}success(t,i,r={}){let s=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}error(t,i,r={}){let s=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}info(t,i,r={}){let s=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}warning(t,i,r={}){let s=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}clear(t){for(let i of this.toasts)if(t!==void 0){if(i.toastId===t){i.toastRef.manualClose();return}}else i.toastRef.manualClose()}remove(t){let i=this._findToast(t);if(!i||(i.activeToast.toastRef.close(),this.toasts.splice(i.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let r=this.toasts[this.currentlyActive].toastRef;r.isInactive()||(this.currentlyActive=this.currentlyActive+1,r.activate())}return!0}findDuplicate(t="",i="",r,s){let{includeTitleDuplicates:o}=this.toastrConfig;for(let a of this.toasts){let c=o&&a.title===t;if((!o||c)&&a.message===i)return a.toastRef.onDuplicate(r,s),a}return null}applyConfig(t={}){return Ke(Ke({},this.toastrConfig),t)}_findToast(t){for(let i=0;i<this.toasts.length;i++)if(this.toasts[i].toastId===t)return{index:i,activeToast:this.toasts[i]};return null}_preBuildNotification(t,i,r,s){return s.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,i,r,s)):this._buildNotification(t,i,r,s)}_buildNotification(t,i,r,s){if(!s.toastComponent)throw new Error("toastComponent required");let o=this.findDuplicate(r,i,this.toastrConfig.resetTimeoutOnDuplicate&&s.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&r||i)&&this.toastrConfig.preventDuplicates&&o!==null)return o;this.previousToastMessage=i;let a=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(a=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let c=this.overlay.create(s.positionClass,this.overlayContainer);this.index=this.index+1;let u=i;i&&s.enableHtml&&(u=this.sanitizer.sanitize($y.HTML,i));let d=new hd(c),p=new Nr(this.index,s,u,r,t,d),m=[{provide:Nr,useValue:p}],y=Rl.create({providers:m,parent:this._injector}),C=new cd(s.toastComponent,y),P=c.attach(C,s.newestOnTop);d.componentInstance=P.instance;let k={toastId:this.index,title:r||"",message:i||"",toastRef:d,onShown:d.afterActivate(),onHidden:d.afterClosed(),onTap:p.onTap(),onAction:p.onAction(),portal:P};return a||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{k.toastRef.activate()})),this.toasts.push(k),k}static \u0275fac=function(i){return new(i||n)(z(mv),z(nb),z(Rl),z(Jy),z(De))};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ib=(()=>{class n{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=po(-1);toastClasses="";state;get _state(){return this.state()}get displayStyle(){if(this.state().value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,i,r){this.toastrService=t,this.toastPackage=i,this.ngZone=r,this.message=i.message,this.title=i.title,this.options=i.config,this.originalTimeout=i.config.timeOut,this.toastClasses=`${i.toastType} ${i.config.toastClass}`,this.sub=i.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=i.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=i.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=i.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s}),this.state=po({value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.update(t=>Ot(Ke({},t),{value:"active"})),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),i=this.hideTime-t;this.width.set(i/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(r=>100-r),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.update(t=>Ot(Ke({},t),{value:"active"})),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state().value!=="removed"&&(clearTimeout(this.timeout),this.state.update(t=>Ot(Ke({},t),{value:"removed"})),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state().value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state().value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state().value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,i){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),i)):this.timeout=setTimeout(()=>t(),i)}outsideInterval(t,i){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),i)):this.intervalId=setInterval(()=>t(),i)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(i){return new(i||n)(Oi(gv),Oi(Nr),Oi(De))};static \u0275cmp=Xh({type:n,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(i,r){i&1&&vo("click",function(){return r.tapToast()})("mouseenter",function(){return r.stickAround()})("mouseleave",function(){return r.delayedHideToast()}),i&2&&(Qy("@flyInOut",r._state),Tn(r.toastClasses),_o("display",r.displayStyle))},attrs:fv,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(i,r){i&1&&mo(0,GC,3,0,"button",0)(1,zC,3,5,"div",1)(2,WC,1,3,"div",2)(3,$C,2,4,"div",3)(4,HC,2,2,"div",4),i&2&&(at("ngIf",r.options.closeButton),Be(),at("ngIf",r.title),Be(),at("ngIf",r.message&&r.options.enableHtml),Be(),at("ngIf",r.message&&!r.options.enableHtml),Be(),at("ngIf",r.options.progressBar))},dependencies:[nd],encapsulation:2,data:{animation:[dv("flyInOut",[Ul("inactive",Bl({opacity:0})),Ul("active",Bl({opacity:1})),Ul("removed",Bl({opacity:0})),ld("inactive => active",ad("{{ easeTime }}ms {{ easing }}")),ld("active => removed",ad("{{ easeTime }}ms {{ easing }}"))])]},changeDetection:0})}return n})(),rb=Ot(Ke({},pv),{toastComponent:ib}),sb=(n={})=>Wy([{provide:mv,useValue:{default:rb,config:n}}]),Pk=(()=>{class n{static forRoot(t={}){return{ngModule:n,providers:[sb(t)]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Xt({type:n});static \u0275inj=Yt({})}return n})();var ob=(()=>{class n{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=po(-1);toastClasses="";get displayStyle(){return this.state()==="inactive"?"none":null}state=po("inactive");timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,i,r){this.toastrService=t,this.toastPackage=i,this.appRef=r,this.message=i.message,this.title=i.title,this.options=i.config,this.originalTimeout=i.config.timeOut,this.toastClasses=`${i.toastType} ${i.config.toastClass}`,this.sub=i.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=i.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=i.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=i.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.set("active"),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),i=this.hideTime-t;this.width.set(i/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(r=>100-r),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.set("active"),this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.state.set("removed"),this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state()!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state()==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(i){return new(i||n)(Oi(gv),Oi(Nr),Oi(Pl))};static \u0275cmp=Xh({type:n,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(i,r){i&1&&vo("click",function(){return r.tapToast()})("mouseenter",function(){return r.stickAround()})("mouseleave",function(){return r.delayedHideToast()}),i&2&&(Tn(r.toastClasses),_o("display",r.displayStyle))},attrs:fv,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(i,r){i&1&&mo(0,QC,3,0,"button",0)(1,XC,3,5,"div",1)(2,JC,1,3,"div",2)(3,ZC,2,4,"div",3)(4,eb,2,2,"div",4),i&2&&(at("ngIf",r.options.closeButton),Be(),at("ngIf",r.title),Be(),at("ngIf",r.message&&r.options.enableHtml),Be(),at("ngIf",r.message&&!r.options.enableHtml),Be(),at("ngIf",r.options.progressBar))},dependencies:[nd],encapsulation:2,changeDetection:0})}return n})(),xk=Ot(Ke({},pv),{toastComponent:ob});var ab="firebase",lb="11.4.0";Mt(ab,lb,"app");var Zt=new Yy("ANGULARFIRE2_VERSION");var _v=(n,e)=>{let t=e?[e]:cv(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},pd=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(pd||{}),jk=wo()&&typeof Zone<"u"?pd.WARN:pd.SILENT;var ql=class{zone;delegate;constructor(e,t=Uy){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r?r.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,i)}},Bi=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=be(De);this.outsideAngular=t.runOutsideAngular(()=>new ql(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new ql(typeof Zone>"u"?void 0:Zone.current,Rr))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var cb="firebase",ub="11.4.0";qe.registerVersion(cb,ub,"app-compat");var hb=["ngOnDestroy"],vv=(n,e,t,i={})=>new Proxy(n,{get:(r,s)=>t.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(hb.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>t.run(()=>u)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(d=>{let p=d?.(...u);return i?.spy?.apply&&i.spy.apply(s,u,p),p})})})});var jl=class{constructor(e){return e}},$n=new ke("angularfire2.app.options"),Hn=new ke("angularfire2.app.name");function Ui(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||i;let o=qe.apps.filter(a=>a&&a.name===r.name)[0]||e.runOutsideAngular(()=>qe.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;db("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new jl(o)}var db=(n,...e)=>{wo()&&typeof console<"u"&&console[n](...e)},fb={provide:jl,useFactory:Ui,deps:[$n,De,[new zy,Hn]]},Xk=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:$n,useValue:t},{provide:Hn,useValue:i}]}}constructor(t){qe.registerVersion("angularfire",Zt.full,"core"),qe.registerVersion("angularfire",Zt.full,"app-compat"),qe.registerVersion("angular",Xy.full,t.toString())}static \u0275fac=function(i){return new(i||n)(z(Kn))};static \u0275mod=Xt({type:n});static \u0275inj=Yt({providers:[fb]})}return n})();function kr(n,e,t,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return pb(r,o)||(yv("error",`${e} was already initialized on the ${t} Firebase App with different settings.${mb?" You may need to reload as Firebase is not HMR aware.":""}`),yv("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function pb(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var mb=typeof module<"u"&&!!module.hot,yv=(n,...e)=>{wo()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var gb=new Map,_b={activated:!1,tokenObservers:[]},yb={initialized:!1,enabled:!1};function Lt(n){return gb.get(n)||Object.assign({},_b)}function Cv(){return yb}var vb="https://content-firebaseappcheck.googleapis.com/v1";var wb="exchangeDebugToken",wv={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},oD=24*60*60*1e3;var yd=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return N(this,null,function*(){this.stop();try{this.pending=new ze,this.pending.promise.catch(t=>{}),yield Tb(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new ze,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Tb(n){return new Promise(e=>{setTimeout(e,n)})}var Eb={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Qn=new iv("appCheck","AppCheck",Eb);function bv(n){if(!Lt(n).activated)throw Qn.create("use-before-activation",{appName:n.name})}function Sv(i,r){return N(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let y=yield o.getHeartbeatsHeader();y&&(s["X-Firebase-Client"]=y)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(y){throw Qn.create("fetch-network-error",{originalErrorMessage:y?.message})}if(c.status!==200)throw Qn.create("fetch-status-error",{httpStatus:c.status});let u;try{u=yield c.json()}catch(y){throw Qn.create("fetch-parse-error",{originalErrorMessage:y?.message})}let d=u.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw Qn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let p=Number(d[1])*1e3,m=Date.now();return{token:u.token,expireTimeMillis:m+p,issuedAtTimeMillis:m}})}function Rv(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${vb}/projects/${t}/apps/${i}:${wb}?key=${r}`,body:{debug_token:e}}}var Ib="firebase-app-check-database",Ab=1,vd="firebase-app-check-store";var Gl=null;function Cb(){return Gl||(Gl=new Promise((n,e)=>{try{let t=indexedDB.open(Ib,Ab);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Qn.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(vd,{keyPath:"compositeKey"})}}}catch(t){e(Qn.create("storage-open",{originalErrorMessage:t?.message}))}}),Gl)}function bb(n,e){return Sb(Rb(n),e)}function Sb(n,e){return N(this,null,function*(){let i=(yield Cb()).transaction(vd,"readwrite"),s=i.objectStore(vd).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var u;a(Qn.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})})}function Rb(n){return`${n.options.appId}-${n.name}`}var Co=new Wn("@firebase/app-check");function gd(n,e){return Dl()?bb(n,e).catch(t=>{Co.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Pv(){return Cv().enabled}function xv(){return N(this,null,function*(){let n=Cv();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Pb={error:"UNKNOWN_ERROR"};function xb(n){return Nl.encodeString(JSON.stringify(n),!1)}function wd(n,e=!1){return N(this,null,function*(){let t=n.app;bv(t);let i=Lt(t),r=i.token,s;if(r&&!bo(r)&&(i.token=void 0,r=void 0),!r){let c=yield i.cachedTokenPromise;c&&(bo(c)?r=c:yield gd(t,void 0))}if(!e&&r&&bo(r))return{token:r.token};let o=!1;if(Pv())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Sv(Rv(t,yield xv()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let c=yield i.exchangeTokenPromise;return yield gd(t,c),i.token=c,{token:c.token}}catch(c){return c.code==="appCheck/throttled"?Co.warn(c.message):Co.error(c),_d(c)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield Lt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Co.warn(c.message):Co.error(c),s=c}let a;return r?s?bo(r)?a={token:r.token,internalError:s}:a=_d(s):(a={token:r.token},i.token=r,yield gd(t,r)):a=_d(s),o&&Vb(t,a),a})}function Nb(n){return N(this,null,function*(){let e=n.app;bv(e);let{provider:t}=Lt(e);if(Pv()){let i=yield xv(),{token:r}=yield Sv(Rv(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function kb(n,e,t,i){let{app:r}=n,s=Lt(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&bo(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Tv(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Tv(n))}function Nv(n,e){let t=Lt(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function Tv(n){let{app:e}=n,t=Lt(e),i=t.tokenRefresher;i||(i=Db(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function Db(n){let{app:e}=n;return new yd(()=>N(this,null,function*(){let t=Lt(e),i;if(t.token?i=yield wd(n,!0):i=yield wd(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Lt(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},wv.RETRIAL_MIN_WAIT,wv.RETRIAL_MAX_WAIT)}function Vb(n,e){let t=Lt(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function bo(n){return n.expireTimeMillis-Date.now()>0}function _d(n){return{token:xb(Pb),error:n}}var Td=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Lt(this.app);for(let t of e)Nv(this.app,t.next);return Promise.resolve()}};function Ob(n,e){return new Td(n,e)}function Fb(n){return{getToken:e=>wd(n,e),getLimitedUseToken:()=>Nb(n),addTokenListener:e=>kb(n,"INTERNAL",e),removeTokenListener:e=>Nv(n.app,e)}}var Mb="@firebase/app-check",Lb="0.8.12";var Bb="app-check",Ev="app-check-internal";function Ub(){Mi(new yt(Bb,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return Ob(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Ev).initialize()})),Mi(new yt(Ev,n=>{let e=n.getProvider("app-check").getImmediate();return Fb(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Mt(Mb,Lb)}Ub();var qb="app-check";var Yn=class{constructor(){return _v(qb)}};var jb=["localhost","0.0.0.0","127.0.0.1"],TD=typeof window<"u"&&jb.includes(window.location.hostname);var So=new ke("angularfire2.auth.use-emulator"),Ro=new ke("angularfire2.auth.settings"),Po=new ke("angularfire2.auth.tenant-id"),xo=new ke("angularfire2.auth.langugage-code"),No=new ke("angularfire2.auth.use-device-language"),ko=new ke("angularfire.auth.persistence"),Do=(n,e,t,i,r,s,o,a)=>kr(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),i&&(c.tenantId=i),c.languageCode=r,s&&c.useDeviceLanguage(),o)for(let[u,d]of Object.entries(o))c.settings[u]=d;return a&&c.setPersistence(a),c},[t,i,r,s,o,a]),Vo=(()=>{class n{injector=be(wn);authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,c,u,d,p,m,y){let C=new Ht,P=Qt(void 0).pipe(uo(o.outsideAngular),vn(()=>s.runOutsideAngular(()=>import("./chunk-453KAEPS.js"))),Ae(()=>Ui(t,s,i)),Ae(k=>Do(k,s,a,u,d,p,c,m)),Wh({bufferSize:1,refCount:!1}));if(xl(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Qt(null);else{P.pipe(qy()).subscribe();let k=P.pipe(vn(F=>F.getRedirectResult().then(W=>W,()=>null)),Se(this.injector),Wh({bufferSize:1,refCount:!1})),q=P.pipe(vn(F=>new jn(W=>({unsubscribe:s.runOutsideAngular(()=>F.onAuthStateChanged(Q=>W.next(Q),Q=>W.error(Q),()=>W.complete()))})))),j=P.pipe(vn(F=>new jn(W=>({unsubscribe:s.runOutsideAngular(()=>F.onIdTokenChanged(Q=>W.next(Q),Q=>W.error(Q),()=>W.complete()))}))));this.authState=k.pipe($h(q),Al(o.outsideAngular),uo(o.insideAngular)),this.user=k.pipe($h(j),Al(o.outsideAngular),uo(o.insideAngular)),this.idToken=this.user.pipe(vn(F=>F?Gn(F.getIdToken()):Qt(null))),this.idTokenResult=this.user.pipe(vn(F=>F?Gn(F.getIdTokenResult()):Qt(null))),this.credential=ho(k,C,this.authState.pipe(fo(F=>!F))).pipe(Ae(F=>F?.user?F:null),Al(o.outsideAngular),uo(o.insideAngular))}return vv(this,P,s,{spy:{apply:(k,q,j)=>{(k.startsWith("signIn")||k.startsWith("createUser"))&&j.then(F=>C.next(F))}}})}static \u0275fac=function(i){return new(i||n)(z($n),z(Hn,8),z(Kn),z(De),z(Bi),z(So,8),z(Ro,8),z(Po,8),z(xo,8),z(No,8),z(ko,8),z(Yn,8))};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),MD=(()=>{class n{constructor(){qe.registerVersion("angularfire",Zt.full,"auth-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Xt({type:n});static \u0275inj=Yt({providers:[Vo]})}return n})();var Dv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vv={};var An,Id;(function(){var n;function e(T,_){function w(){}w.prototype=_.prototype,T.D=_.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(E,I,b){for(var v=Array(arguments.length-2),gn=2;gn<arguments.length;gn++)v[gn-2]=arguments[gn];return _.prototype[I].apply(E,v)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(T,_,w){w||(w=0);var E=Array(16);if(typeof _=="string")for(var I=0;16>I;++I)E[I]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(I=0;16>I;++I)E[I]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=T.g[0],w=T.g[1],I=T.g[2];var b=T.g[3],v=_+(b^w&(I^b))+E[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[1]+3905402710&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[2]+606105819&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[3]+3250441966&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+E[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[5]+1200080426&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[6]+2821735955&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[7]+4249261313&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+E[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[9]+2336552879&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[10]+4294925233&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[11]+2304563134&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+E[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[13]+4254626195&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[14]+2792965006&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[15]+1236535329&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(I^b&(w^I))+E[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[6]+3225465664&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[11]+643717713&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[0]+3921069994&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+E[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[10]+38016083&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[15]+3634488961&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[4]+3889429448&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+E[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[14]+3275163606&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[3]+4107603335&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[8]+1163531501&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+E[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[2]+4243563512&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[7]+1735328473&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[12]+2368359562&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(w^I^b)+E[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[8]+2272392833&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[11]+1839030562&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[14]+4259657740&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+E[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[4]+1272893353&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[7]+4139469664&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[10]+3200236656&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+E[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[0]+3936430074&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[3]+3572445317&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[6]+76029189&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+E[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[12]+3873151461&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[15]+530742520&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[2]+3299628645&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(I^(w|~b))+E[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[7]+1126891415&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[14]+2878612391&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[5]+4237533241&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+E[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[3]+2399980690&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[10]+4293915773&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[1]+2240044497&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+E[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[15]+4264355552&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[6]+2734768916&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[13]+1309151649&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+E[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[11]+3174756917&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[2]+718787259&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(I+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+I&4294967295,T.g[3]=T.g[3]+b&4294967295}i.prototype.u=function(T,_){_===void 0&&(_=T.length);for(var w=_-this.blockSize,E=this.B,I=this.h,b=0;b<_;){if(I==0)for(;b<=w;)r(this,T,b),b+=this.blockSize;if(typeof T=="string"){for(;b<_;)if(E[I++]=T.charCodeAt(b++),I==this.blockSize){r(this,E),I=0;break}}else for(;b<_;)if(E[I++]=T[b++],I==this.blockSize){r(this,E),I=0;break}}this.h=I,this.o+=_},i.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var w=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=w&255,w/=256;for(this.u(T),T=Array(16),_=w=0;4>_;++_)for(var E=0;32>E;E+=8)T[w++]=this.g[_]>>>E&255;return T};function s(T,_){var w=a;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=_(T)}function o(T,_){this.h=_;for(var w=[],E=!0,I=T.length-1;0<=I;I--){var b=T[I]|0;E&&b==_||(w[I]=b,E=!1)}this.g=w}var a={};function c(T){return-128<=T&&128>T?s(T,function(_){return new o([_|0],0>_?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return p;if(0>T)return k(u(-T));for(var _=[],w=1,E=0;T>=w;E++)_[E]=T/w|0,w*=4294967296;return new o(_,0)}function d(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return k(d(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(_,8)),E=p,I=0;I<T.length;I+=8){var b=Math.min(8,T.length-I),v=parseInt(T.substring(I,I+b),_);8>b?(b=u(Math.pow(_,b)),E=E.j(b).add(u(v))):(E=E.j(w),E=E.add(u(v)))}return E}var p=c(0),m=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(P(this))return-k(this).m();for(var T=0,_=1,w=0;w<this.g.length;w++){var E=this.i(w);T+=(0<=E?E:4294967296+E)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(C(this))return"0";if(P(this))return"-"+k(this).toString(T);for(var _=u(Math.pow(T,6)),w=this,E="";;){var I=W(w,_).g;w=q(w,I.j(_));var b=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=I,C(w))return b+E;for(;6>b.length;)b="0"+b;E=b+E}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function C(T){if(T.h!=0)return!1;for(var _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function P(T){return T.h==-1}n.l=function(T){return T=q(this,T),P(T)?-1:C(T)?0:1};function k(T){for(var _=T.g.length,w=[],E=0;E<_;E++)w[E]=~T.g[E];return new o(w,~T.h).add(m)}n.abs=function(){return P(this)?k(this):this},n.add=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0,I=0;I<=_;I++){var b=E+(this.i(I)&65535)+(T.i(I)&65535),v=(b>>>16)+(this.i(I)>>>16)+(T.i(I)>>>16);E=v>>>16,b&=65535,v&=65535,w[I]=v<<16|b}return new o(w,w[w.length-1]&-2147483648?-1:0)};function q(T,_){return T.add(k(_))}n.j=function(T){if(C(this)||C(T))return p;if(P(this))return P(T)?k(this).j(k(T)):k(k(this).j(T));if(P(T))return k(this.j(k(T)));if(0>this.l(y)&&0>T.l(y))return u(this.m()*T.m());for(var _=this.g.length+T.g.length,w=[],E=0;E<2*_;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<T.g.length;I++){var b=this.i(E)>>>16,v=this.i(E)&65535,gn=T.i(I)>>>16,zs=T.i(I)&65535;w[2*E+2*I]+=v*zs,j(w,2*E+2*I),w[2*E+2*I+1]+=b*zs,j(w,2*E+2*I+1),w[2*E+2*I+1]+=v*gn,j(w,2*E+2*I+1),w[2*E+2*I+2]+=b*gn,j(w,2*E+2*I+2)}for(E=0;E<_;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=_;E<2*_;E++)w[E]=0;return new o(w,0)};function j(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function F(T,_){this.g=T,this.h=_}function W(T,_){if(C(_))throw Error("division by zero");if(C(T))return new F(p,p);if(P(T))return _=W(k(T),_),new F(k(_.g),k(_.h));if(P(_))return _=W(T,k(_)),new F(k(_.g),_.h);if(30<T.g.length){if(P(T)||P(_))throw Error("slowDivide_ only works with positive integers.");for(var w=m,E=_;0>=E.l(T);)w=Q(w),E=Q(E);var I=Y(w,1),b=Y(E,1);for(E=Y(E,2),w=Y(w,2);!C(E);){var v=b.add(E);0>=v.l(T)&&(I=I.add(w),b=v),E=Y(E,1),w=Y(w,1)}return _=q(T,I.j(_)),new F(I,_)}for(I=p;0<=T.l(_);){for(w=Math.max(1,Math.floor(T.m()/_.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),b=u(w),v=b.j(_);P(v)||0<v.l(T);)w-=E,b=u(w),v=b.j(_);C(b)&&(b=m),I=I.add(b),T=q(T,v)}return new F(I,T)}n.A=function(T){return W(this,T).h},n.and=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)&T.i(E);return new o(w,this.h&T.h)},n.or=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)|T.i(E);return new o(w,this.h|T.h)},n.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)^T.i(E);return new o(w,this.h^T.h)};function Q(T){for(var _=T.g.length+1,w=[],E=0;E<_;E++)w[E]=T.i(E)<<1|T.i(E-1)>>>31;return new o(w,T.h)}function Y(T,_){var w=_>>5;_%=32;for(var E=T.g.length-w,I=[],b=0;b<E;b++)I[b]=0<_?T.i(b+w)>>>_|T.i(b+w+1)<<32-_:T.i(b+w);return new o(I,T.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,Id=Vv.Md5=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,An=Vv.Integer=o}).apply(typeof Dv<"u"?Dv:typeof self<"u"?self:typeof window<"u"?window:{});var Kl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Cn={};var Ad,Gb,Dr,Cd,Oo,zl,bd,Sd,Rd;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Kl=="object"&&Kl];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var i=t(this);function r(l,h){if(h)e:{var f=i;l=l.split(".");for(var g=0;g<l.length-1;g++){var A=l[g];if(!(A in f))break e;f=f[A]}l=l[l.length-1],g=f[l],h=h(g),h!=g&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,g=!1,A={next:function(){if(!g&&f<l.length){var x=f++;return{value:h(x,l[x]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}r("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function p(l,h,f){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function m(l,h,f){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function C(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(g,A,x){for(var M=Array(arguments.length-2),de=2;de<arguments.length;de++)M[de-2]=arguments[de];return h.prototype[A].apply(g,M)}}function P(l){let h=l.length;if(0<h){let f=Array(h);for(let g=0;g<h;g++)f[g]=l[g];return f}return[]}function k(l,h){for(let f=1;f<arguments.length;f++){let g=arguments[f];if(c(g)){let A=l.length||0,x=g.length||0;l.length=A+x;for(let M=0;M<x;M++)l[A+M]=g[M]}else l.push(g)}}class q{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function j(l){return/^[\s\xa0]*$/.test(l)}function F(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function W(l){return W[" "](l),l}W[" "]=function(){};var Q=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function Y(l,h,f){for(let g in l)h.call(f,l[g],g,l)}function T(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(l,h){let f,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(f in g)l[f]=g[f];for(let x=0;x<w.length;x++)f=w[x],Object.prototype.hasOwnProperty.call(g,f)&&(l[f]=g[f])}}function I(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function b(l){a.setTimeout(()=>{throw l},0)}function v(){var l=wh;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class gn{constructor(){this.h=this.g=null}add(h,f){let g=zs.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var zs=new q(()=>new cC,l=>l.reset());class cC{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Ws,$s=!1,wh=new gn,B_=()=>{let l=a.Promise.resolve(void 0);Ws=()=>{l.then(uC)}};var uC=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){b(f)}var h=zs;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}$s=!1};function Ln(){this.s=this.s,this.C=this.C}Ln.prototype.s=!1,Ln.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ln.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Xe(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}Xe.prototype.h=function(){this.defaultPrevented=!0};var hC=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l}();function Hs(l,h){if(Xe.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(Q){e:{try{W(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:dC[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Hs.aa.h.call(this)}}C(Hs,Xe);var dC={2:"touch",3:"pen",4:"mouse"};Hs.prototype.h=function(){Hs.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Qs="closure_listenable_"+(1e6*Math.random()|0),fC=0;function pC(l,h,f,g,A){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=A,this.key=++fC,this.da=this.fa=!1}function al(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function ll(l){this.src=l,this.g={},this.h=0}ll.prototype.add=function(l,h,f,g,A){var x=l.toString();l=this.g[x],l||(l=this.g[x]=[],this.h++);var M=Eh(l,h,g,A);return-1<M?(h=l[M],f||(h.fa=!1)):(h=new pC(h,this.src,x,!!g,A),h.fa=f,l.push(h)),h};function Th(l,h){var f=h.type;if(f in l.g){var g=l.g[f],A=Array.prototype.indexOf.call(g,h,void 0),x;(x=0<=A)&&Array.prototype.splice.call(g,A,1),x&&(al(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function Eh(l,h,f,g){for(var A=0;A<l.length;++A){var x=l[A];if(!x.da&&x.listener==h&&x.capture==!!f&&x.ha==g)return A}return-1}var Ih="closure_lm_"+(1e6*Math.random()|0),Ah={};function U_(l,h,f,g,A){if(g&&g.once)return j_(l,h,f,g,A);if(Array.isArray(h)){for(var x=0;x<h.length;x++)U_(l,h[x],f,g,A);return null}return f=Rh(f),l&&l[Qs]?l.K(h,f,u(g)?!!g.capture:!!g,A):q_(l,h,f,!1,g,A)}function q_(l,h,f,g,A,x){if(!h)throw Error("Invalid event type");var M=u(A)?!!A.capture:!!A,de=bh(l);if(de||(l[Ih]=de=new ll(l)),f=de.add(h,f,g,M,x),f.proxy)return f;if(g=mC(),f.proxy=g,g.src=l,g.listener=f,l.addEventListener)hC||(A=M),A===void 0&&(A=!1),l.addEventListener(h.toString(),g,A);else if(l.attachEvent)l.attachEvent(K_(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function mC(){function l(f){return h.call(l.src,l.listener,f)}let h=gC;return l}function j_(l,h,f,g,A){if(Array.isArray(h)){for(var x=0;x<h.length;x++)j_(l,h[x],f,g,A);return null}return f=Rh(f),l&&l[Qs]?l.L(h,f,u(g)?!!g.capture:!!g,A):q_(l,h,f,!0,g,A)}function G_(l,h,f,g,A){if(Array.isArray(h))for(var x=0;x<h.length;x++)G_(l,h[x],f,g,A);else g=u(g)?!!g.capture:!!g,f=Rh(f),l&&l[Qs]?(l=l.i,h=String(h).toString(),h in l.g&&(x=l.g[h],f=Eh(x,f,g,A),-1<f&&(al(x[f]),Array.prototype.splice.call(x,f,1),x.length==0&&(delete l.g[h],l.h--)))):l&&(l=bh(l))&&(h=l.g[h.toString()],l=-1,h&&(l=Eh(h,f,g,A)),(f=-1<l?h[l]:null)&&Ch(f))}function Ch(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[Qs])Th(h.i,l);else{var f=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(f,g,l.capture):h.detachEvent?h.detachEvent(K_(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=bh(h))?(Th(f,l),f.h==0&&(f.src=null,h[Ih]=null)):al(l)}}}function K_(l){return l in Ah?Ah[l]:Ah[l]="on"+l}function gC(l,h){if(l.da)l=!0;else{h=new Hs(h,this);var f=l.listener,g=l.ha||l.src;l.fa&&Ch(l),l=f.call(g,h)}return l}function bh(l){return l=l[Ih],l instanceof ll?l:null}var Sh="__closure_events_fn_"+(1e9*Math.random()>>>0);function Rh(l){return typeof l=="function"?l:(l[Sh]||(l[Sh]=function(h){return l.handleEvent(h)}),l[Sh])}function Je(){Ln.call(this),this.i=new ll(this),this.M=this,this.F=null}C(Je,Ln),Je.prototype[Qs]=!0,Je.prototype.removeEventListener=function(l,h,f,g){G_(this,l,h,f,g)};function st(l,h){var f,g=l.F;if(g)for(f=[];g;g=g.F)f.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new Xe(h,l);else if(h instanceof Xe)h.target=h.target||l;else{var A=h;h=new Xe(g,l),E(h,A)}if(A=!0,f)for(var x=f.length-1;0<=x;x--){var M=h.g=f[x];A=cl(M,g,!0,h)&&A}if(M=h.g=l,A=cl(M,g,!0,h)&&A,A=cl(M,g,!1,h)&&A,f)for(x=0;x<f.length;x++)M=h.g=f[x],A=cl(M,g,!1,h)&&A}Je.prototype.N=function(){if(Je.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],g=0;g<f.length;g++)al(f[g]);delete l.g[h],l.h--}}this.F=null},Je.prototype.K=function(l,h,f,g){return this.i.add(String(l),h,!1,f,g)},Je.prototype.L=function(l,h,f,g){return this.i.add(String(l),h,!0,f,g)};function cl(l,h,f,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,x=0;x<h.length;++x){var M=h[x];if(M&&!M.da&&M.capture==f){var de=M.listener,He=M.ha||M.src;M.fa&&Th(l.i,M),A=de.call(He,g)!==!1&&A}}return A&&!g.defaultPrevented}function z_(l,h,f){if(typeof l=="function")f&&(l=m(l,f));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function W_(l){l.g=z_(()=>{l.g=null,l.i&&(l.i=!1,W_(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class _C extends Ln{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:W_(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ys(l){Ln.call(this),this.h=l,this.g={}}C(Ys,Ln);var $_=[];function H_(l){Y(l.g,function(h,f){this.g.hasOwnProperty(f)&&Ch(h)},l),l.g={}}Ys.prototype.N=function(){Ys.aa.N.call(this),H_(this)},Ys.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ph=a.JSON.stringify,yC=a.JSON.parse,vC=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function xh(){}xh.prototype.h=null;function Q_(l){return l.h||(l.h=l.i())}function Y_(){}var Xs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Nh(){Xe.call(this,"d")}C(Nh,Xe);function kh(){Xe.call(this,"c")}C(kh,Xe);var xi={},X_=null;function ul(){return X_=X_||new Je}xi.La="serverreachability";function J_(l){Xe.call(this,xi.La,l)}C(J_,Xe);function Js(l){let h=ul();st(h,new J_(h))}xi.STAT_EVENT="statevent";function Z_(l,h){Xe.call(this,xi.STAT_EVENT,l),this.stat=h}C(Z_,Xe);function ot(l){let h=ul();st(h,new Z_(h,l))}xi.Ma="timingevent";function ey(l,h){Xe.call(this,xi.Ma,l),this.size=h}C(ey,Xe);function Zs(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function eo(){this.g=!0}eo.prototype.xa=function(){this.g=!1};function wC(l,h,f,g,A,x){l.info(function(){if(l.g)if(x)for(var M="",de=x.split("&"),He=0;He<de.length;He++){var ae=de[He].split("=");if(1<ae.length){var Ze=ae[0];ae=ae[1];var et=Ze.split("_");M=2<=et.length&&et[1]=="type"?M+(Ze+"="+ae+"&"):M+(Ze+"=redacted&")}}else M=null;else M=x;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+f+`
`+M})}function TC(l,h,f,g,A,x,M){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+f+`
`+x+" "+M})}function Ar(l,h,f,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+IC(l,f)+(g?" "+g:"")})}function EC(l,h){l.info(function(){return"TIMEOUT: "+h})}eo.prototype.info=function(){};function IC(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var g=f[l];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var x=A[0];if(x!="noop"&&x!="stop"&&x!="close")for(var M=1;M<A.length;M++)A[M]=""}}}}return Ph(f)}catch{return h}}var hl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ty={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Dh;function dl(){}C(dl,xh),dl.prototype.g=function(){return new XMLHttpRequest},dl.prototype.i=function(){return{}},Dh=new dl;function Bn(l,h,f,g){this.j=l,this.i=h,this.l=f,this.R=g||1,this.U=new Ys(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ny}function ny(){this.i=null,this.g="",this.h=!1}var iy={},Vh={};function Oh(l,h,f){l.L=1,l.v=gl(_n(h)),l.m=f,l.P=!0,ry(l,null)}function ry(l,h){l.F=Date.now(),fl(l),l.A=_n(l.v);var f=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),yy(f.i,"t",g),l.C=0,f=l.j.J,l.h=new ny,l.g=Fy(l.j,f?h:null,!l.m),0<l.O&&(l.M=new _C(m(l.Y,l,l.g),l.O)),h=l.U,f=l.g,g=l.ca;var A="readystatechange";Array.isArray(A)||(A&&($_[0]=A.toString()),A=$_);for(var x=0;x<A.length;x++){var M=U_(f,A[x],g||h.handleEvent,!1,h.h||h);if(!M)break;h.g[M.key]=M}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),Js(),wC(l.i,l.u,l.A,l.l,l.R,l.m)}Bn.prototype.ca=function(l){l=l.target;let h=this.M;h&&yn(l)==3?h.j():this.Y(l)},Bn.prototype.Y=function(l){try{if(l==this.g)e:{let et=yn(this.g);var h=this.g.Ba();let Sr=this.g.Z();if(!(3>et)&&(et!=3||this.g&&(this.h.h||this.g.oa()||Cy(this.g)))){this.J||et!=4||h==7||(h==8||0>=Sr?Js(3):Js(2)),Fh(this);var f=this.g.Z();this.X=f;t:if(sy(this)){var g=Cy(this.g);l="";var A=g.length,x=yn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ni(this),to(this);var M="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(x&&h==A-1)});g.length=0,this.h.g+=l,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=f==200,TC(this.i,this.u,this.A,this.l,this.R,et,f),this.o){if(this.T&&!this.K){t:{if(this.g){var de,He=this.g;if((de=He.g?He.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(de)){var ae=de;break t}}ae=null}if(f=ae)Ar(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Mh(this,f);else{this.o=!1,this.s=3,ot(12),Ni(this),to(this);break e}}if(this.P){f=!0;let Vt;for(;!this.J&&this.C<M.length;)if(Vt=AC(this,M),Vt==Vh){et==4&&(this.s=4,ot(14),f=!1),Ar(this.i,this.l,null,"[Incomplete Response]");break}else if(Vt==iy){this.s=4,ot(15),Ar(this.i,this.l,M,"[Invalid Chunk]"),f=!1;break}else Ar(this.i,this.l,Vt,null),Mh(this,Vt);if(sy(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),et!=4||M.length!=0||this.h.h||(this.s=1,ot(16),f=!1),this.o=this.o&&f,!f)Ar(this.i,this.l,M,"[Invalid Chunked Response]"),Ni(this),to(this);else if(0<M.length&&!this.W){this.W=!0;var Ze=this.j;Ze.g==this&&Ze.ba&&!Ze.M&&(Ze.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Gh(Ze),Ze.M=!0,ot(11))}}else Ar(this.i,this.l,M,null),Mh(this,M);et==4&&Ni(this),this.o&&!this.J&&(et==4?ky(this.j,this):(this.o=!1,fl(this)))}else qC(this.g),f==400&&0<M.indexOf("Unknown SID")?(this.s=3,ot(12)):(this.s=0,ot(13)),Ni(this),to(this)}}}catch{}finally{}};function sy(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function AC(l,h){var f=l.C,g=h.indexOf(`
`,f);return g==-1?Vh:(f=Number(h.substring(f,g)),isNaN(f)?iy:(g+=1,g+f>h.length?Vh:(h=h.slice(g,g+f),l.C=g+f,h)))}Bn.prototype.cancel=function(){this.J=!0,Ni(this)};function fl(l){l.S=Date.now()+l.I,oy(l,l.I)}function oy(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Zs(m(l.ba,l),h)}function Fh(l){l.B&&(a.clearTimeout(l.B),l.B=null)}Bn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(EC(this.i,this.A),this.L!=2&&(Js(),ot(17)),Ni(this),this.s=2,to(this)):oy(this,this.S-l)};function to(l){l.j.G==0||l.J||ky(l.j,l)}function Ni(l){Fh(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,H_(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Mh(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||Lh(f.h,l))){if(!l.K&&Lh(f.h,l)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Tl(f),vl(f);else break e;jh(f),ot(18)}}else f.za=A[1],0<f.za-f.T&&37500>A[2]&&f.F&&f.v==0&&!f.C&&(f.C=Zs(m(f.Za,f),6e3));if(1>=cy(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Di(f,11)}else if((l.K||f.g==l)&&Tl(f),!j(h))for(A=f.Da.g.parse(h),h=0;h<A.length;h++){let ae=A[h];if(f.T=ae[0],ae=ae[1],f.G==2)if(ae[0]=="c"){f.K=ae[1],f.ia=ae[2];let Ze=ae[3];Ze!=null&&(f.la=Ze,f.j.info("VER="+f.la));let et=ae[4];et!=null&&(f.Aa=et,f.j.info("SVER="+f.Aa));let Sr=ae[5];Sr!=null&&typeof Sr=="number"&&0<Sr&&(g=1.5*Sr,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;let Vt=l.g;if(Vt){let Il=Vt.g?Vt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Il){var x=g.h;x.g||Il.indexOf("spdy")==-1&&Il.indexOf("quic")==-1&&Il.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&(Bh(x,x.h),x.h=null))}if(g.D){let Kh=Vt.g?Vt.g.getResponseHeader("X-HTTP-Session-Id"):null;Kh&&(g.ya=Kh,ge(g.I,g.D,Kh))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var M=l;if(g.qa=Oy(g,g.J?g.ia:null,g.W),M.K){uy(g.h,M);var de=M,He=g.L;He&&(de.I=He),de.B&&(Fh(de),fl(de)),g.g=M}else xy(g);0<f.i.length&&wl(f)}else ae[0]!="stop"&&ae[0]!="close"||Di(f,7);else f.G==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?Di(f,7):qh(f):ae[0]!="noop"&&f.l&&f.l.ta(ae),f.v=0)}}Js(4)}catch{}}var CC=class{constructor(l,h){this.g=l,this.map=h}};function ay(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ly(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function cy(l){return l.h?1:l.g?l.g.size:0}function Lh(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Bh(l,h){l.g?l.g.add(h):l.h=h}function uy(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}ay.prototype.cancel=function(){if(this.i=hy(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function hy(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return P(l.i)}function bC(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],f=l.length,g=0;g<f;g++)h.push(l[g]);return h}h=[],f=0;for(g in l)h[f++]=l[g];return h}function SC(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let g in l)h[f++]=g;return h}}}function dy(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=SC(l),g=bC(l),A=g.length,x=0;x<A;x++)h.call(void 0,g[x],f&&f[x],l)}var fy=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function RC(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var g=l[f].indexOf("="),A=null;if(0<=g){var x=l[f].substring(0,g);A=l[f].substring(g+1)}else x=l[f];h(x,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function ki(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof ki){this.h=l.h,pl(this,l.j),this.o=l.o,this.g=l.g,ml(this,l.s),this.l=l.l;var h=l.i,f=new ro;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),py(this,f),this.m=l.m}else l&&(h=String(l).match(fy))?(this.h=!1,pl(this,h[1]||"",!0),this.o=no(h[2]||""),this.g=no(h[3]||"",!0),ml(this,h[4]),this.l=no(h[5]||"",!0),py(this,h[6]||"",!0),this.m=no(h[7]||"")):(this.h=!1,this.i=new ro(null,this.h))}ki.prototype.toString=function(){var l=[],h=this.j;h&&l.push(io(h,my,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(io(h,my,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(io(f,f.charAt(0)=="/"?NC:xC,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",io(f,DC)),l.join("")};function _n(l){return new ki(l)}function pl(l,h,f){l.j=f?no(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function ml(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function py(l,h,f){h instanceof ro?(l.i=h,VC(l.i,l.h)):(f||(h=io(h,kC)),l.i=new ro(h,l.h))}function ge(l,h,f){l.i.set(h,f)}function gl(l){return ge(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function no(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function io(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,PC),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function PC(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var my=/[#\/\?@]/g,xC=/[#\?:]/g,NC=/[#\?]/g,kC=/[#\?@]/g,DC=/#/g;function ro(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Un(l){l.g||(l.g=new Map,l.h=0,l.i&&RC(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=ro.prototype,n.add=function(l,h){Un(this),this.i=null,l=Cr(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function gy(l,h){Un(l),h=Cr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function _y(l,h){return Un(l),h=Cr(l,h),l.g.has(h)}n.forEach=function(l,h){Un(this),this.g.forEach(function(f,g){f.forEach(function(A){l.call(h,A,g,this)},this)},this)},n.na=function(){Un(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){let A=l[g];for(let x=0;x<A.length;x++)f.push(h[g])}return f},n.V=function(l){Un(this);let h=[];if(typeof l=="string")_y(this,l)&&(h=h.concat(this.g.get(Cr(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return Un(this),this.i=null,l=Cr(this,l),_y(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function yy(l,h,f){gy(l,h),0<f.length&&(l.i=null,l.g.set(Cr(l,h),P(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];let x=encodeURIComponent(String(g)),M=this.V(g);for(g=0;g<M.length;g++){var A=x;M[g]!==""&&(A+="="+encodeURIComponent(String(M[g]))),l.push(A)}}return this.i=l.join("&")};function Cr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function VC(l,h){h&&!l.j&&(Un(l),l.i=null,l.g.forEach(function(f,g){var A=g.toLowerCase();g!=A&&(gy(this,g),yy(this,A,f))},l)),l.j=h}function OC(l,h){let f=new eo;if(a.Image){let g=new Image;g.onload=y(qn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=y(qn,f,"TestLoadImage: error",!1,h,g),g.onabort=y(qn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=y(qn,f,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function FC(l,h){let f=new eo,g=new AbortController,A=setTimeout(()=>{g.abort(),qn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(x=>{clearTimeout(A),x.ok?qn(f,"TestPingServer: ok",!0,h):qn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),qn(f,"TestPingServer: error",!1,h)})}function qn(l,h,f,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(f)}catch{}}function MC(){this.g=new vC}function LC(l,h,f){let g=f||"";try{dy(l,function(A,x){let M=A;u(A)&&(M=Ph(A)),h.push(g+x+"="+encodeURIComponent(M))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function so(l){this.l=l.Ub||null,this.j=l.eb||!1}C(so,xh),so.prototype.g=function(){return new _l(this.l,this.j)},so.prototype.i=function(l){return function(){return l}}({});function _l(l,h){Je.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(_l,Je),n=_l.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,ao(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,oo(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,ao(this)),this.g&&(this.readyState=3,ao(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;vy(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function vy(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?oo(this):ao(this),this.readyState==3&&vy(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,oo(this))},n.Qa=function(l){this.g&&(this.response=l,oo(this))},n.ga=function(){this.g&&oo(this)};function oo(l){l.readyState=4,l.l=null,l.j=null,l.v=null,ao(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function ao(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(_l.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function wy(l){let h="";return Y(l,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function Uh(l,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=wy(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):ge(l,h,f))}function Ie(l){Je.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Ie,Je);var BC=/^https?$/i,UC=["POST","PUT"];n=Ie.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Dh.g(),this.v=this.o?Q_(this.o):Q_(Dh),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(x){Ty(this,x);return}if(l=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)f.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let x of g.keys())f.set(x,g.get(x));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(x=>x.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(UC,h,void 0))||g||A||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[x,M]of f)this.g.setRequestHeader(x,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ay(this),this.u=!0,this.g.send(l),this.u=!1}catch(x){Ty(this,x)}};function Ty(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,Ey(l),yl(l)}function Ey(l){l.A||(l.A=!0,st(l,"complete"),st(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,st(this,"complete"),st(this,"abort"),yl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),yl(this,!0)),Ie.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Iy(this):this.bb())},n.bb=function(){Iy(this)};function Iy(l){if(l.h&&typeof o<"u"&&(!l.v[1]||yn(l)!=4||l.Z()!=2)){if(l.u&&yn(l)==4)z_(l.Ea,0,l);else if(st(l,"readystatechange"),yn(l)==4){l.h=!1;try{let M=l.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=M===0){var A=String(l.D).match(fy)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),g=!BC.test(A?A.toLowerCase():"")}f=g}if(f)st(l,"complete"),st(l,"success");else{l.m=6;try{var x=2<yn(l)?l.g.statusText:""}catch{x=""}l.l=x+" ["+l.Z()+"]",Ey(l)}}finally{yl(l)}}}}function yl(l,h){if(l.g){Ay(l);let f=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||st(l,"ready");try{f.onreadystatechange=g}catch{}}}function Ay(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function yn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<yn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),yC(h)}};function Cy(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function qC(l){let h={};l=(l.g&&2<=yn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(j(l[g]))continue;var f=I(l[g]);let A=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let x=h[A]||[];h[A]=x,x.push(f)}T(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function lo(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function by(l){this.Aa=0,this.i=[],this.j=new eo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=lo("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=lo("baseRetryDelayMs",5e3,l),this.cb=lo("retryDelaySeedMs",1e4,l),this.Wa=lo("forwardChannelMaxRetries",2,l),this.wa=lo("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new ay(l&&l.concurrentRequestLimit),this.Da=new MC,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=by.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,g){ot(0),this.W=l,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=Oy(this,null,this.W),wl(this)};function qh(l){if(Sy(l),l.G==3){var h=l.U++,f=_n(l.I);if(ge(f,"SID",l.K),ge(f,"RID",h),ge(f,"TYPE","terminate"),co(l,f),h=new Bn(l,l.j,h),h.L=2,h.v=gl(_n(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=Fy(h.j,null),h.g.ea(h.v)),h.F=Date.now(),fl(h)}Vy(l)}function vl(l){l.g&&(Gh(l),l.g.cancel(),l.g=null)}function Sy(l){vl(l),l.u&&(a.clearTimeout(l.u),l.u=null),Tl(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function wl(l){if(!ly(l.h)&&!l.s){l.s=!0;var h=l.Ga;Ws||B_(),$s||(Ws(),$s=!0),wh.add(h,l),l.B=0}}function jC(l,h){return cy(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Zs(m(l.Ga,l,h),Dy(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new Bn(this,this.j,l),x=this.o;if(this.S&&(x?(x=_(x),E(x,this.S)):x=this.S),this.m!==null||this.O||(A.H=x,x=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=Py(this,A,h),f=_n(this.I),ge(f,"RID",l),ge(f,"CVER",22),this.D&&ge(f,"X-HTTP-Session-Id",this.D),co(this,f),x&&(this.O?h="headers="+encodeURIComponent(String(wy(x)))+"&"+h:this.m&&Uh(f,this.m,x)),Bh(this.h,A),this.Ua&&ge(f,"TYPE","init"),this.P?(ge(f,"$req",h),ge(f,"SID","null"),A.T=!0,Oh(A,f,null)):Oh(A,f,h),this.G=2}}else this.G==3&&(l?Ry(this,l):this.i.length==0||ly(this.h)||Ry(this))};function Ry(l,h){var f;h?f=h.l:f=l.U++;let g=_n(l.I);ge(g,"SID",l.K),ge(g,"RID",f),ge(g,"AID",l.T),co(l,g),l.m&&l.o&&Uh(g,l.m,l.o),f=new Bn(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=Py(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Bh(l.h,f),Oh(f,g,h)}function co(l,h){l.H&&Y(l.H,function(f,g){ge(h,g,f)}),l.l&&dy({},function(f,g){ge(h,g,f)})}function Py(l,h,f){f=Math.min(l.i.length,f);var g=l.l?m(l.l.Na,l.l,l):null;e:{var A=l.i;let x=-1;for(;;){let M=["count="+f];x==-1?0<f?(x=A[0].g,M.push("ofs="+x)):x=0:M.push("ofs="+x);let de=!0;for(let He=0;He<f;He++){let ae=A[He].g,Ze=A[He].map;if(ae-=x,0>ae)x=Math.max(0,A[He].g-100),de=!1;else try{LC(Ze,M,"req"+ae+"_")}catch{g&&g(Ze)}}if(de){g=M.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,g}function xy(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;Ws||B_(),$s||(Ws(),$s=!0),wh.add(h,l),l.v=0}}function jh(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Zs(m(l.Fa,l),Dy(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,Ny(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Zs(m(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ot(10),vl(this),Ny(this))};function Gh(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function Ny(l){l.g=new Bn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=_n(l.qa);ge(h,"RID","rpc"),ge(h,"SID",l.K),ge(h,"AID",l.T),ge(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&ge(h,"TO",l.ja),ge(h,"TYPE","xmlhttp"),co(l,h),l.m&&l.o&&Uh(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=gl(_n(h)),f.m=null,f.P=!0,ry(f,l)}n.Za=function(){this.C!=null&&(this.C=null,vl(this),jh(this),ot(19))};function Tl(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function ky(l,h){var f=null;if(l.g==h){Tl(l),Gh(l),l.g=null;var g=2}else if(Lh(l.h,h))f=h.D,uy(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;g=ul(),st(g,new ey(g,f)),wl(l)}else xy(l);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&jC(l,h)||g==2&&jh(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),A){case 1:Di(l,5);break;case 4:Di(l,10);break;case 3:Di(l,6);break;default:Di(l,2)}}}function Dy(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function Di(l,h){if(l.j.info("Error code "+h),h==2){var f=m(l.fb,l),g=l.Xa;let A=!g;g=new ki(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||pl(g,"https"),gl(g),A?OC(g.toString(),f):FC(g.toString(),f)}else ot(2);l.G=0,l.l&&l.l.sa(h),Vy(l),Sy(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),ot(2)):(this.j.info("Failed to ping google.com"),ot(1))};function Vy(l){if(l.G=0,l.ka=[],l.l){let h=hy(l.h);(h.length!=0||l.i.length!=0)&&(k(l.ka,h),k(l.ka,l.i),l.h.i.length=0,P(l.i),l.i.length=0),l.l.ra()}}function Oy(l,h,f){var g=f instanceof ki?_n(f):new ki(f);if(g.g!="")h&&(g.g=h+"."+g.g),ml(g,g.s);else{var A=a.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var x=new ki(null);g&&pl(x,g),h&&(x.g=h),A&&ml(x,A),f&&(x.l=f),g=x}return f=l.D,h=l.ya,f&&h&&ge(g,f,h),ge(g,"VER",l.la),co(l,g),g}function Fy(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Ie(new so({eb:f})):new Ie(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function My(){}n=My.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function El(){}El.prototype.g=function(l,h){return new gt(l,h)};function gt(l,h){Je.call(this),this.g=new by(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!j(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!j(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new br(this)}C(gt,Je),gt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gt.prototype.close=function(){qh(this.g)},gt.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=Ph(l),l=f);h.i.push(new CC(h.Ya++,l)),h.G==3&&wl(h)},gt.prototype.N=function(){this.g.l=null,delete this.j,qh(this.g),delete this.g,gt.aa.N.call(this)};function Ly(l){Nh.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}C(Ly,Nh);function By(){kh.call(this),this.status=1}C(By,kh);function br(l){this.g=l}C(br,My),br.prototype.ua=function(){st(this.g,"a")},br.prototype.ta=function(l){st(this.g,new Ly(l))},br.prototype.sa=function(l){st(this.g,new By)},br.prototype.ra=function(){st(this.g,"b")},El.prototype.createWebChannel=El.prototype.g,gt.prototype.send=gt.prototype.o,gt.prototype.open=gt.prototype.m,gt.prototype.close=gt.prototype.close,Rd=Cn.createWebChannelTransport=function(){return new El},Sd=Cn.getStatEventTarget=function(){return ul()},bd=Cn.Event=xi,zl=Cn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},hl.NO_ERROR=0,hl.TIMEOUT=8,hl.HTTP_ERROR=6,Oo=Cn.ErrorCode=hl,ty.COMPLETE="complete",Cd=Cn.EventType=ty,Y_.EventType=Xs,Xs.OPEN="a",Xs.CLOSE="b",Xs.ERROR="c",Xs.MESSAGE="d",Je.prototype.listen=Je.prototype.K,Dr=Cn.WebChannel=Y_,Gb=Cn.FetchXmlHttpFactory=so,Ie.prototype.listenOnce=Ie.prototype.L,Ie.prototype.getLastError=Ie.prototype.Ka,Ie.prototype.getLastErrorCode=Ie.prototype.Ba,Ie.prototype.getStatus=Ie.prototype.Z,Ie.prototype.getResponseJson=Ie.prototype.Oa,Ie.prototype.getResponseText=Ie.prototype.oa,Ie.prototype.send=Ie.prototype.ea,Ie.prototype.setWithCredentials=Ie.prototype.Ha,Ad=Cn.XhrIo=Ie}).apply(typeof Kl<"u"?Kl:typeof self<"u"?self:typeof window<"u"?window:{});var Ov="@firebase/firestore",Fv="4.7.9";var Me=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Me.UNAUTHENTICATED=new Me(null),Me.GOOGLE_CREDENTIALS=new Me("google-credentials-uid"),Me.FIRST_PARTY=new Me("first-party-uid"),Me.MOCK_USER=new Me("mock-user");var ys="11.4.0";var si=new Wn("@firebase/firestore");function Ur(){return si.logLevel}function Hw(n){si.setLogLevel(n)}function V(n,...e){if(si.logLevel<=Rt.DEBUG){let t=e.map(jp);si.debug(`Firestore (${ys}): ${n}`,...t)}}function Re(n,...e){if(si.logLevel<=Rt.ERROR){let t=e.map(jp);si.error(`Firestore (${ys}): ${n}`,...t)}}function Ut(n,...e){if(si.logLevel<=Rt.WARN){let t=e.map(jp);si.warn(`Firestore (${ys}): ${n}`,...t)}}function jp(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function U(n="Unexpected state"){let e=`FIRESTORE (${ys}) INTERNAL ASSERTION FAILED: `+n;throw Re(e),new Error(e)}function G(n,e){n||U()}function Qw(n,e){n||U()}function L(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends nv{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var rc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Fd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Me.UNAUTHENTICATED))}shutdown(){}},Md=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Ld=class{constructor(e){this.t=e,this.currentUser=Me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0);let i=this.i,r=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve(),s=new je;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new je,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>N(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},a=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new je)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(G(typeof i.accessToken=="string"),new rc(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Me(e)}},Bd=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Me.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},Ud=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new Bd(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Me.FIRST_PARTY))}shutdown(){}invalidateToken(){}},sc=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},qd=class{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ml(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){G(this.o===void 0);let i=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new sc(this.V));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new sc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function zb(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}var oc=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),i="";for(;i.length<20;){let r=zb(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%62))}return i}};function H(n,e){return n<e?-1:n>e?1:0}function Qr(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function Yw(n){return n+"\0"}var Mv=-62135596800,Lv=1e6,we=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*Lv);return new n(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Mv)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Lv}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-Mv;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var K=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new we(0,0))}static max(){return new n(new we(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Bv="__name__",ac=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&U(),i===void 0?i=e.length-t:i>e.length-t&&U(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=n.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return Math.sign(e.length-t.length)}static compareSegments(e,t){let i=n.isNumericId(e),r=n.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?n.extractNumericId(e).compare(n.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return An.fromString(e.substring(4,e.length-2))}},se=class n extends ac{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},Wb=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pe=class n extends ac{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return Wb.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Bv}static keyField(){return new n([Bv])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new D(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new D(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var B=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var Yr=-1,Xr=class{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}};function jd(n){return n.fields.find(e=>e.kind===2)}function ji(n){return n.fields.filter(e=>e.kind!==2)}Xr.UNKNOWN_ID=-1;var Wr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ho=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Pt.min())}};function Xw(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=K.fromTimestamp(i===1e9?new we(t+1,0):new we(t,i));return new Pt(r,B.empty(),e)}function Jw(n){return new Pt(n.readTime,n.key,Yr)}var Pt=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(K.min(),B.empty(),Yr)}static max(){return new n(K.max(),B.empty(),Yr)}};function Gp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(n.documentKey,e.documentKey),t!==0?t:H(n.largestBatchId,e.largestBatchId))}var Zw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",lc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function gi(n){return N(this,null,function*(){if(n.code!==R.FAILED_PRECONDITION||n.message!==Zw)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var S=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===s&&i(o)},d=>r(d))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};var vt="SimpleDb",cc=class n{static open(e,t,i,r){try{return new n(t,e.transaction(r,i))}catch(s){throw new Yi(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.m=new je,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{t.error?this.m.reject(new Yi(e,t.error)):this.m.resolve()},this.transaction.onerror=i=>{let r=Kp(i.target.error);this.m.reject(new Yi(e,r))}}get p(){return this.m.promise}abort(e){e&&this.m.reject(e),this.aborted||(V(vt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}S(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Kd(t)}},oi=class n{static delete(e){return V(vt,"Removing database:",e),Ki(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Dl())return!1;if(n.v())return!0;let e=To(),t=n.C(e),i=0<t&&t<10,r=eT(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static C(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}constructor(e,t,i){this.name=e,this.version=t,this.O=i,n.C(To())===12.2&&Re("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}N(e){return N(this,null,function*(){return this.db||(V(vt,"Opening database:",this.name),this.db=yield new Promise((t,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{i(new Yi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new D(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new D(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new Yi(e,o))},r.onupgradeneeded=s=>{V(vt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.O.B(o,r.transaction,s.oldVersion,this.version).next(()=>{V(vt,"Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db})}k(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){return N(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.N(e);let a=cc.open(this.db,e,s?"readonly":"readwrite",i),c=r(a).next(u=>(a.S(),u)).catch(u=>(a.abort(u),S.reject(u))).toPromise();return c.catch(()=>{}),yield a.p,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(V(vt,"Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function eT(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Gd=class{constructor(e){this.q=e,this.$=!1,this.K=null}get isDone(){return this.$}get U(){return this.K}set cursor(e){this.q=e}done(){this.$=!0}W(e){this.K=e}delete(){return Ki(this.q.delete())}},Yi=class extends D{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function _i(n){return n.name==="IndexedDbTransactionError"}var Kd=class{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(V(vt,"PUT",this.store.name,e,t),i=this.store.put(t,e)):(V(vt,"PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Ki(i)}add(e){return V(vt,"ADD",this.store.name,e,e),Ki(this.store.add(e))}get(e){return Ki(this.store.get(e)).next(t=>(t===void 0&&(t=null),V(vt,"GET",this.store.name,e,t),t))}delete(e){return V(vt,"DELETE",this.store.name,e),Ki(this.store.delete(e))}count(){return V(vt,"COUNT",this.store.name),Ki(this.store.count())}G(e,t){let i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new S((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(i),o=[];return this.j(s,(a,c)=>{o.push(c)}).next(()=>o)}}H(e,t){let i=this.store.getAll(e,t===null?void 0:t);return new S((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}J(e,t){V(vt,"DELETE ALL",this.store.name);let i=this.options(e,t);i.Y=!1;let r=this.cursor(i);return this.j(r,(s,o,a)=>a.delete())}Z(e,t){let i;t?i=e:(i={},t=e);let r=this.cursor(i);return this.j(r,t)}X(e){let t=this.cursor({});return new S((i,r)=>{t.onerror=s=>{let o=Kp(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}j(e,t){let i=[];return new S((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void r();let c=new Gd(a),u=t(a.primaryKey,a.value,c);if(u instanceof S){let d=u.catch(p=>(c.done(),S.reject(p)));i.push(d)}c.isDone?r():c.U===null?a.continue():a.continue(c.U)}}).next(()=>S.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let i=this.store.index(e.index);return e.Y?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Ki(n){return new S((e,t)=>{n.onsuccess=i=>{let r=i.target.result;e(r)},n.onerror=i=>{let r=Kp(i.target.error);t(r)}})}var Uv=!1;function Kp(n){let e=oi.C(To());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let i=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Uv||(Uv=!0,setTimeout(()=>{throw i},0)),i}}return n}var jo="IndexBackfiller",zd=class{constructor(e,t){this.asyncQueue=e,this.ee=t,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}te(e){V(jo,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>N(this,null,function*(){this.task=null;try{let t=yield this.ee.ne();V(jo,`Documents written: ${t}`)}catch(t){_i(t)?V(jo,"Ignoring IndexedDB error during index backfill: ",t):yield gi(t)}yield this.te(6e4)}))}},Wd=class{constructor(e,t){this.localStore=e,this.persistence=t}ne(e=50){return N(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.re(t,e))})}re(e,t){let i=new Set,r=t,s=!0;return S.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return V(jo,`Processing collection: ${o}`),this.ie(e,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>t-r)}ie(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.se(r,s)).next(a=>(V(jo,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}se(e,t){let i=e;return t.changes.forEach((r,s)=>{let o=Jw(s);Gp(o,i)>0&&(i=o)}),new Pt(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}};var wt=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.oe(r),this._e=r=>i.writeSequenceNumber(r))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this._e&&this._e(t),t}}n.ae=-1;return n})(),ii=-1;function va(n){return n==null}function Qo(n){return n===0&&1/n==-1/0}function tT(n){return typeof n=="number"&&Number.isInteger(n)&&!Qo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var uc="";function it(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=qv(e)),e=$b(n.get(t),e);return qv(e)}function $b(n,e){let t=e,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":t+="";break;case uc:t+="";break;default:t+=s}}return t}function qv(n){return n+uc+""}function tn(n){let e=n.length;if(G(e>=2),e===2)return G(n.charAt(0)===uc&&n.charAt(1)===""),se.emptyPath();let t=e-2,i=[],r="";for(let s=0;s<e;){let o=n.indexOf(uc,s);switch((o<0||o>t)&&U(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;r.length===0?c=a:(r+=a,c=r,r=""),i.push(c);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:U()}s=o+2}return new se(i)}var Gi="remoteDocuments",wa="owner",Vr="owner",Yo="mutationQueues",Hb="userId",Bt="mutations",jv="batchId",Hi="userMutationsIndex",Gv=["userId","batchId"];function Xl(n,e){return[n,it(e)]}function nT(n,e,t){return[n,it(e),t]}var Qb={},Jr="documentMutations",hc="remoteDocumentsV14",Yb=["prefixPath","collectionGroup","readTime","documentId"],Jl="documentKeyIndex",Xb=["prefixPath","collectionGroup","documentId"],iT="collectionGroupIndex",Jb=["collectionGroup","readTime","prefixPath","documentId"],Xo="remoteDocumentGlobal",$d="remoteDocumentGlobalKey",Zr="targets",rT="queryTargetsIndex",Zb=["canonicalId","targetId"],es="targetDocuments",eS=["targetId","path"],zp="documentTargetsIndex",tS=["path","targetId"],dc="targetGlobalKey",Xi="targetGlobal",Jo="collectionParents",nS=["collectionId","parent"],ts="clientMetadata",iS="clientId",lu="bundles",rS="bundleId",cu="namedQueries",sS="name",Wp="indexConfiguration",oS="indexId",Hd="collectionGroupIndex",aS="collectionGroup",fc="indexState",lS=["indexId","uid"],sT="sequenceNumberIndex",cS=["uid","sequenceNumber"],pc="indexEntries",uS=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],oT="documentKeyIndex",hS=["indexId","uid","orderedDocumentKey"],uu="documentOverlays",dS=["userId","collectionPath","documentId"],Qd="collectionPathOverlayIndex",fS=["userId","collectionPath","largestBatchId"],aT="collectionGroupOverlayIndex",pS=["userId","collectionGroup","largestBatchId"],$p="globals",mS="name",lT=[Yo,Bt,Jr,Gi,Zr,wa,Xi,es,ts,Xo,Jo,lu,cu],gS=[...lT,uu],cT=[Yo,Bt,Jr,hc,Zr,wa,Xi,es,ts,Xo,Jo,lu,cu,uu],uT=cT,Hp=[...uT,Wp,fc,pc],_S=Hp,yS=[...Hp,$p];var Zo=class extends lc{constructor(e,t){super(),this.ue=e,this.currentSequenceNumber=t}};function Ge(n,e){let t=L(n);return oi.M(t.ue,e)}function Kv(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function yi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function hT(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _e=class n{constructor(e,t){this.comparator=e,this.root=t||rn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zr(this.root,e,this.comparator,!1)}getReverseIterator(){return new zr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zr(this.root,e,this.comparator,!0)}},zr=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},rn=class n{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new n(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this,s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};rn.EMPTY=null,rn.RED=!0,rn.BLACK=!1;rn.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,i,r,s){return this}insert(e,t,i){return new rn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var he=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mc(this.data.getIterator())}getIteratorFrom(e){return new mc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},mc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Or(n){return n.hasNext()?n.getNext():void 0}var Tt=class n{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new n([])}unionWith(e){let t=new he(Pe.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qr(this.fields,e.fields,(t,i)=>t.isEqual(i))}};var gc=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function dT(){return typeof atob<"u"}var Ne=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new gc("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ne.EMPTY_BYTE_STRING=new Ne("");var vS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rn(n){if(G(!!n),typeof n=="string"){let e=0,t=vS.exec(n);if(G(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ye(n.seconds),nanos:ye(n.nanos)}}function ye(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Pn(n){return typeof n=="string"?Ne.fromBase64String(n):Ne.fromUint8Array(n)}var fT="server_timestamp",pT="__type__",mT="__previous_value__",gT="__local_write_time__";function hu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[pT])===null||t===void 0?void 0:t.stringValue)===fT}function du(n){let e=n.mapValue.fields[mT];return hu(e)?du(e):e}function ea(n){let e=Rn(n.mapValue.fields[gT].timestampValue);return new we(e.seconds,e.nanos)}var Yd=class{constructor(e,t,i,r,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},Xd="(default)",ai=class n{constructor(e,t){this.projectId=e,this.database=t||Xd}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Xd}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Qp="__type__",_T="__max__",ti={mapValue:{fields:{__type__:{stringValue:_T}}}},Yp="__vector__",ns="value",Zl={nullValue:"NULL_VALUE"};function li(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?hu(n)?4:yT(n)?9007199254740991:fu(n)?10:11:U()}function an(n,e){if(n===e)return!0;let t=li(n);if(t!==li(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ea(n).isEqual(ea(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=Rn(r.timestampValue),a=Rn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return Pn(r.bytesValue).isEqual(Pn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return ye(r.geoPointValue.latitude)===ye(s.geoPointValue.latitude)&&ye(r.geoPointValue.longitude)===ye(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return ye(r.integerValue)===ye(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=ye(r.doubleValue),a=ye(s.doubleValue);return o===a?Qo(o)===Qo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Qr(n.arrayValue.values||[],e.arrayValue.values||[],an);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(Kv(o)!==Kv(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!an(o[c],a[c])))return!1;return!0}(n,e);default:return U()}}function ta(n,e){return(n.values||[]).find(t=>an(t,e))!==void 0}function ci(n,e){if(n===e)return 0;let t=li(n),i=li(e);if(t!==i)return H(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return H(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ye(s.integerValue||s.doubleValue),c=ye(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return zv(n.timestampValue,e.timestampValue);case 4:return zv(ea(n),ea(e));case 5:return H(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Pn(s),c=Pn(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=H(a[u],c[u]);if(d!==0)return d}return H(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=H(ye(s.latitude),ye(o.latitude));return a!==0?a:H(ye(s.longitude),ye(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Wv(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,u,d;let p=s.fields||{},m=o.fields||{},y=(a=p[ns])===null||a===void 0?void 0:a.arrayValue,C=(c=m[ns])===null||c===void 0?void 0:c.arrayValue,P=H(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=C?.values)===null||d===void 0?void 0:d.length)||0);return P!==0?P:Wv(y,C)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===ti.mapValue&&o===ti.mapValue)return 0;if(s===ti.mapValue)return 1;if(o===ti.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){let m=H(c[p],d[p]);if(m!==0)return m;let y=ci(a[c[p]],u[d[p]]);if(y!==0)return y}return H(c.length,d.length)}(n.mapValue,e.mapValue);default:throw U()}}function zv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return H(n,e);let t=Rn(n),i=Rn(e),r=H(t.seconds,i.seconds);return r!==0?r:H(t.nanos,i.nanos)}function Wv(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=ci(t[r],i[r]);if(s)return s}return H(t.length,i.length)}function is(n){return Jd(n)}function Jd(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let i=Rn(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Pn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return B.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(let s of t.values||[])r?r=!1:i+=",",i+=Jd(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){let i=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${Jd(t.fields[o])}`;return r+"}"}(n.mapValue):U()}function ec(n){switch(li(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=du(n);return e?16+ec(e):16;case 5:return 2*n.stringValue.length;case 6:return Pn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((r,s)=>r+ec(s),0)}(n.arrayValue);case 10:case 11:return function(i){let r=0;return yi(i.fields,(s,o)=>{r+=s.length+ec(o)}),r}(n.mapValue);default:throw U()}}function Ji(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Zd(n){return!!n&&"integerValue"in n}function na(n){return!!n&&"arrayValue"in n}function $v(n){return!!n&&"nullValue"in n}function Hv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tc(n){return!!n&&"mapValue"in n}function fu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Qp])===null||t===void 0?void 0:t.stringValue)===Yp}function Go(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return yi(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Go(i)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Go(n.arrayValue.values[t]);return e}return Object.assign({},n)}function yT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===_T}var vT={mapValue:{fields:{[Qp]:{stringValue:Yp},[ns]:{arrayValue:{}}}}};function wS(n){return"nullValue"in n?Zl:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ji(ai.empty(),B.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?fu(n)?vT:{mapValue:{}}:U()}function TS(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ji(ai.empty(),B.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?vT:"mapValue"in n?fu(n)?{mapValue:{}}:ti:U()}function Qv(n,e){let t=ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Yv(n,e){let t=ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var nt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!tc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Go(t)}setAll(e){let t=Pe.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=Go(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());tc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return an(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];tc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){yi(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(Go(this.value))}};function wT(n){let e=[];return yi(n.fields,(t,i)=>{let r=new Pe([t]);if(tc(i)){let s=wT(i.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new Tt(e)}var Le=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,K.min(),K.min(),K.min(),nt.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,K.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,K.min(),K.min(),nt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,K.min(),K.min(),nt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ln=class{constructor(e,t){this.position=e,this.inclusive=t}};function Xv(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField()?i=B.comparator(B.fromName(o.referenceValue),t.key):i=ci(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function Jv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!an(n.position[t],e.position[t]))return!1;return!0}var Zi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function ES(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var _c=class{},ie=class n extends _c{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new nf(e,t,i):t==="array-contains"?new of(e,i):t==="in"?new yc(e,i):t==="not-in"?new af(e,i):t==="array-contains-any"?new lf(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new rf(e,i):new sf(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ci(t,this.value)):t!==null&&li(this.value)===li(t)&&this.matchesComparison(ci(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends _c{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new n(e,t)}matches(e){return rs(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}};function rs(n){return n.op==="and"}function ef(n){return n.op==="or"}function Xp(n){return TT(n)&&rs(n)}function TT(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function tf(n){if(n instanceof ie)return n.field.canonicalString()+n.op.toString()+is(n.value);if(Xp(n))return n.filters.map(e=>tf(e)).join(",");{let e=n.filters.map(t=>tf(t)).join(",");return`${n.op}(${e})`}}function ET(n,e){return n instanceof ie?function(i,r){return r instanceof ie&&i.op===r.op&&i.field.isEqual(r.field)&&an(i.value,r.value)}(n,e):n instanceof ue?function(i,r){return r instanceof ue&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&ET(o,r.filters[a]),!0):!1}(n,e):void U()}function IT(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function AT(n){return n instanceof ie?function(t){return`${t.field.canonicalString()} ${t.op} ${is(t.value)}`}(n):n instanceof ue?function(t){return t.op.toString()+" {"+t.getFilters().map(AT).join(" ,")+"}"}(n):"Filter"}var nf=class extends ie{constructor(e,t,i){super(e,t,i),this.key=B.fromName(i.referenceValue)}matches(e){let t=B.comparator(e.key,this.key);return this.matchesComparison(t)}},rf=class extends ie{constructor(e,t){super(e,"in",t),this.keys=CT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},sf=class extends ie{constructor(e,t){super(e,"not-in",t),this.keys=CT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function CT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>B.fromName(i.referenceValue))}var of=class extends ie{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return na(t)&&ta(t.arrayValue,this.value)}},yc=class extends ie{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ta(this.value.arrayValue,t)}},af=class extends ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(ta(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ta(this.value.arrayValue,t)}},lf=class extends ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!na(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>ta(this.value.arrayValue,i))}};var cf=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.le=null}};function uf(n,e=null,t=[],i=[],r=null,s=null,o=null){return new cf(n,e,t,i,r,s,o)}function er(n){let e=L(n);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>tf(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),va(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>is(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>is(i)).join(",")),e.le=t}return e.le}function Ta(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ES(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ET(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Jv(n.startAt,e.startAt)&&Jv(n.endAt,e.endAt)}function vc(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function wc(n,e){return n.filters.filter(t=>t instanceof ie&&t.field.isEqual(e))}function Zv(n,e,t){let i=Zl,r=!0;for(let s of wc(n,e)){let o=Zl,a=!0;switch(s.op){case"<":case"<=":o=wS(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Zl}Qv({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Qv({value:i,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}function ew(n,e,t){let i=ti,r=!0;for(let s of wc(n,e)){let o=ti,a=!0;switch(s.op){case">=":case">":o=TS(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=ti}Yv({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Yv({value:i,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}var qt=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}};function bT(n,e,t,i,r,s,o,a){return new qt(n,e,t,i,r,s,o,a)}function vs(n){return new qt(n)}function tw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Jp(n){return n.collectionGroup!==null}function $r(n){let e=L(n);if(e.he===null){e.he=[];let t=new Set;for(let s of e.explicitOrderBy)e.he.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new he(Pe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.he.push(new Zi(s,i))}),t.has(Pe.keyField().canonicalString())||e.he.push(new Zi(Pe.keyField(),i))}return e.he}function lt(n){let e=L(n);return e.Pe||(e.Pe=IS(e,$r(n))),e.Pe}function IS(n,e){if(n.limitType==="F")return uf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Zi(r.field,s)});let t=n.endAt?new ln(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new ln(n.startAt.position,n.startAt.inclusive):null;return uf(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function hf(n,e){let t=n.filters.concat([e]);return new qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Tc(n,e,t){return new qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ea(n,e){return Ta(lt(n),lt(e))&&n.limitType===e.limitType}function ST(n){return`${er(lt(n))}|lt:${n.limitType}`}function qr(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>AT(r)).join(", ")}]`),va(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>is(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>is(r)).join(",")),`Target(${i})`}(lt(n))}; limitType=${n.limitType})`}function Ia(n,e){return e.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):B.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(let s of $r(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(o,a,c){let u=Xv(o,a,c);return o.inclusive?u<=0:u<0}(i.startAt,$r(i),r)||i.endAt&&!function(o,a,c){let u=Xv(o,a,c);return o.inclusive?u>=0:u>0}(i.endAt,$r(i),r))}(n,e)}function RT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function PT(n){return(e,t)=>{let i=!1;for(let r of $r(n)){let s=AS(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function AS(n,e,t){let i=n.field.isKeyField()?B.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?ci(c,u):U()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return U()}}var jt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){yi(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return hT(this.inner)}size(){return this.innerSize}};var CS=new _e(B.comparator);function mt(){return CS}var xT=new _e(B.comparator);function Uo(...n){let e=xT;for(let t of n)e=e.insert(t.key,t);return e}function NT(n){let e=xT;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function nn(){return Ko()}function kT(){return Ko()}function Ko(){return new jt(n=>n.toString(),(n,e)=>n.isEqual(e))}var bS=new _e(B.comparator),SS=new he(B.comparator);function J(...n){let e=SS;for(let t of n)e=e.add(t);return e}var RS=new he(H);function Zp(){return RS}function em(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qo(e)?"-0":e}}function DT(n){return{integerValue:""+n}}function VT(n,e){return tT(e)?DT(e):em(n,e)}var ss=class{constructor(){this._=void 0}};function PS(n,e,t){return n instanceof ui?function(r,s){let o={fields:{[pT]:{stringValue:fT},[gT]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&hu(s)&&(s=du(s)),s&&(o.fields[mT]=s),{mapValue:o}}(t,e):n instanceof xn?FT(n,e):n instanceof Nn?MT(n,e):function(r,s){let o=OT(r,s),a=nw(o)+nw(r.Ie);return Zd(o)&&Zd(r.Ie)?DT(a):em(r.serializer,a)}(n,e)}function xS(n,e,t){return n instanceof xn?FT(n,e):n instanceof Nn?MT(n,e):t}function OT(n,e){return n instanceof hi?function(i){return Zd(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}var ui=class extends ss{},xn=class extends ss{constructor(e){super(),this.elements=e}};function FT(n,e){let t=LT(e);for(let i of n.elements)t.some(r=>an(r,i))||t.push(i);return{arrayValue:{values:t}}}var Nn=class extends ss{constructor(e){super(),this.elements=e}};function MT(n,e){let t=LT(e);for(let i of n.elements)t=t.filter(r=>!an(r,i));return{arrayValue:{values:t}}}var hi=class extends ss{constructor(e,t){super(),this.serializer=e,this.Ie=t}};function nw(n){return ye(n.integerValue||n.doubleValue)}function LT(n){return na(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var tr=class{constructor(e,t){this.field=e,this.transform=t}};function NS(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof xn&&r instanceof xn||i instanceof Nn&&r instanceof Nn?Qr(i.elements,r.elements,an):i instanceof hi&&r instanceof hi?an(i.Ie,r.Ie):i instanceof ui&&r instanceof ui}(n.transform,e.transform)}var df=class{constructor(e,t){this.version=e,this.transformResults=t}},Ce=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function nc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var os=class{};function BT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new fi(n.key,Ce.none()):new di(n.key,n.data,Ce.none());{let t=n.data,i=nt.empty(),r=new he(Pe.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new Gt(n.key,i,new Tt(r.toArray()),Ce.none())}}function kS(n,e,t){n instanceof di?function(r,s,o){let a=r.value.clone(),c=rw(r.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Gt?function(r,s,o){if(!nc(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=rw(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(UT(r)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function zo(n,e,t,i){return n instanceof di?function(s,o,a,c){if(!nc(s.precondition,o))return a;let u=s.value.clone(),d=sw(s.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof Gt?function(s,o,a,c){if(!nc(s.precondition,o))return a;let u=sw(s.fieldTransforms,c,o),d=o.data;return d.setAll(UT(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,i):function(s,o,a){return nc(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function DS(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=OT(i.transform,r||null);s!=null&&(t===null&&(t=nt.empty()),t.set(i.field,s))}return t||null}function iw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Qr(i,r,(s,o)=>NS(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var di=class extends os{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},Gt=class extends os{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function UT(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function rw(n,e,t){let i=new Map;G(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,xS(o,a,t[r]))}return i}function sw(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,PS(s,o,e))}return i}var fi=class extends os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ia=class extends os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ra=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&kS(s,e,i[r])}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=zo(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=zo(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=kT();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let c=BT(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(K.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),J())}isEqual(e){return this.batchId===e.batchId&&Qr(this.mutations,e.mutations,(t,i)=>iw(t,i))&&Qr(this.baseMutations,e.baseMutations,(t,i)=>iw(t,i))}},ff=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){G(e.mutations.length===i.length);let r=function(){return bS}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var sa=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var pf=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Oe,re;function qT(n){switch(n){case R.OK:return U();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return U()}}function jT(n){if(n===void 0)return Re("GRPC error has no .code"),R.UNKNOWN;switch(n){case Oe.OK:return R.OK;case Oe.CANCELLED:return R.CANCELLED;case Oe.UNKNOWN:return R.UNKNOWN;case Oe.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case Oe.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case Oe.INTERNAL:return R.INTERNAL;case Oe.UNAVAILABLE:return R.UNAVAILABLE;case Oe.UNAUTHENTICATED:return R.UNAUTHENTICATED;case Oe.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case Oe.NOT_FOUND:return R.NOT_FOUND;case Oe.ALREADY_EXISTS:return R.ALREADY_EXISTS;case Oe.PERMISSION_DENIED:return R.PERMISSION_DENIED;case Oe.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case Oe.ABORTED:return R.ABORTED;case Oe.OUT_OF_RANGE:return R.OUT_OF_RANGE;case Oe.UNIMPLEMENTED:return R.UNIMPLEMENTED;case Oe.DATA_LOSS:return R.DATA_LOSS;default:return U()}}(re=Oe||(Oe={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";var ow=null;function GT(){return new TextEncoder}var VS=new An([4294967295,4294967295],0);function aw(n){let e=GT().encode(n),t=new Id;return t.update(e),new Uint8Array(t.digest())}function lw(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new An([t,i],0),new An([r,s],0)]}var mf=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Qi(`Invalid padding: ${t}`);if(i<0)throw new Qi(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Qi(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Qi(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=An.fromNumber(this.Ee)}Ae(e,t,i){let r=e.add(t.multiply(An.fromNumber(i)));return r.compare(VS)===1&&(r=new An([r.getBits(0),r.getBits(1)],0)),r.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;let t=aw(e),[i,r]=lw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ae(i,r,s);if(!this.Re(o))return!1}return!0}static create(e,t,i){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.Ee===0)return;let t=aw(e),[i,r]=lw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ae(i,r,s);this.Ve(o)}}Ve(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Qi=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var oa=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,aa.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(K.min(),r,new _e(H),mt(),J())}},aa=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,J(),J(),J())}};var Hr=class{constructor(e,t,i,r){this.me=e,this.removedTargetIds=t,this.key=i,this.fe=r}},Ec=class{constructor(e,t){this.targetId=e,this.ge=t}},Ic=class{constructor(e,t,i=Ne.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},Ac=class{constructor(){this.pe=0,this.ye=cw(),this.we=Ne.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=J(),t=J(),i=J();return this.ye.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:U()}}),new aa(this.we,this.be,e,t,i)}Me(){this.Se=!1,this.ye=cw()}xe(e,t){this.Se=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,G(this.pe>=0)}Le(){this.Se=!0,this.be=!0}},gf=class{constructor(e){this.ke=e,this.qe=new Map,this.Qe=mt(),this.$e=Wl(),this.Ke=Wl(),this.Ue=new _e(H)}We(e){for(let t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(let t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{let i=this.He(t);switch(e.state){case 0:this.Je(t)&&i.Ce(e.resumeToken);break;case 1:i.Be(),i.De||i.Me(),i.Ce(e.resumeToken);break;case 2:i.Be(),i.De||this.removeTarget(t);break;case 3:this.Je(t)&&(i.Le(),i.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),i.Ce(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((i,r)=>{this.Je(r)&&t(r)})}Ze(e){let t=e.targetId,i=e.ge.count,r=this.Xe(t);if(r){let s=r.target;if(vc(s))if(i===0){let o=new B(s.path);this.ze(t,o,Le.newNoDocument(o,K.min()))}else G(i===1);else{let o=this.et(t);if(o!==i){let a=this.tt(e),c=a?this.nt(a,e,o):1;if(c!==0){this.Ye(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(t,u)}ow?.rt(function(d,p,m,y,C){var P,k,q,j,F,W;let Q={localCacheCount:d,existenceFilterCount:p.count,databaseId:m.database,projectId:m.projectId},Y=p.unchangedNames;return Y&&(Q.bloomFilter={applied:C===0,hashCount:(P=Y?.hashCount)!==null&&P!==void 0?P:0,bitmapLength:(j=(q=(k=Y?.bits)===null||k===void 0?void 0:k.bitmap)===null||q===void 0?void 0:q.length)!==null&&j!==void 0?j:0,padding:(W=(F=Y?.bits)===null||F===void 0?void 0:F.padding)!==null&&W!==void 0?W:0,mightContain:T=>{var _;return(_=y?.mightContain(T))!==null&&_!==void 0&&_}}),Q}(o,e.ge,this.ke.it(),a,c))}}}}tt(e){let t=e.ge.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o,a;try{o=Pn(i).toUint8Array()}catch(c){if(c instanceof gc)return Ut("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new mf(o,r,s)}catch(c){return Ut(c instanceof Qi?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ee===0?null:a}nt(e,t,i){return t.ge.count===i-this.st(e,t.targetId)?0:2}st(e,t){let i=this.ke.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.ke.it(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.ze(t,s,null),r++)}),r}ot(e){let t=new Map;this.qe.forEach((s,o)=>{let a=this.Xe(o);if(a){if(s.current&&vc(a.target)){let c=new B(a.target.path);this._t(c).has(o)||this.ut(o,c)||this.ze(o,c,Le.newNoDocument(c,e))}s.ve&&(t.set(o,s.Fe()),s.Me())}});let i=J();this.Ke.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Xe(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.Qe.forEach((s,o)=>o.setReadTime(e));let r=new oa(e,t,this.Ue,this.Qe,i);return this.Qe=mt(),this.$e=Wl(),this.Ke=Wl(),this.Ue=new _e(H),r}Ge(e,t){if(!this.Je(e))return;let i=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,i),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e))}ze(e,t,i){if(!this.Je(e))return;let r=this.He(e);this.ut(e,t)?r.xe(t,1):r.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),i&&(this.Qe=this.Qe.insert(t,i))}removeTarget(e){this.qe.delete(e)}et(e){let t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new Ac,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new he(H),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new he(H),this.$e=this.$e.insert(e,t)),t}Je(e){let t=this.Xe(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){let t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new Ac),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}};function Wl(){return new _e(B.comparator)}function cw(){return new _e(B.comparator)}var OS={asc:"ASCENDING",desc:"DESCENDING"},FS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},MS={and:"AND",or:"OR"},_f=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function yf(n,e){return n.useProto3Json||va(e)?e:{value:e}}function as(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function KT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function LS(n,e){return as(n,e.toTimestamp())}function xe(n){return G(!!n),K.fromTimestamp(function(t){let i=Rn(t);return new we(i.seconds,i.nanos)}(n))}function tm(n,e){return vf(n,e).canonicalString()}function vf(n,e){let t=function(r){return new se(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function zT(n){let e=se.fromString(n);return G(tE(e)),e}function la(n,e){return tm(n.databaseId,e.path)}function sn(n,e){let t=zT(e);if(t.get(1)!==n.databaseId.projectId)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(HT(t))}function WT(n,e){return tm(n.databaseId,e)}function $T(n){let e=zT(n);return e.length===4?se.emptyPath():HT(e)}function wf(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function HT(n){return G(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function uw(n,e,t){return{name:la(n,e),fields:t.value.mapValue.fields}}function QT(n,e,t){let i=sn(n,e.name),r=xe(e.updateTime),s=e.createTime?xe(e.createTime):K.min(),o=new nt({mapValue:{fields:e.fields}}),a=Le.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function BS(n,e){return"found"in e?function(i,r){G(!!r.found),r.found.name,r.found.updateTime;let s=sn(i,r.found.name),o=xe(r.found.updateTime),a=r.found.createTime?xe(r.found.createTime):K.min(),c=new nt({mapValue:{fields:r.found.fields}});return Le.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(i,r){G(!!r.missing),G(!!r.readTime);let s=sn(i,r.missing),o=xe(r.readTime);return Le.newNoDocument(s,o)}(n,e):U()}function US(n,e){let t;if("targetChange"in e){e.targetChange;let i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?(G(d===void 0||typeof d=="string"),Ne.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ne.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?R.UNKNOWN:jT(u.code);return new D(d,u.message||"")}(o);t=new Ic(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=sn(n,i.document.name),s=xe(i.document.updateTime),o=i.document.createTime?xe(i.document.createTime):K.min(),a=new nt({mapValue:{fields:i.document.fields}}),c=Le.newFoundDocument(r,s,o,a),u=i.targetIds||[],d=i.removedTargetIds||[];t=new Hr(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=sn(n,i.document),s=i.readTime?xe(i.readTime):K.min(),o=Le.newNoDocument(r,s),a=i.removedTargetIds||[];t=new Hr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=sn(n,i.document),s=i.removedTargetIds||[];t=new Hr([],s,r,null)}else{if(!("filter"in e))return U();{e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new pf(r,s),a=i.targetId;t=new Ec(a,o)}}return t}function ca(n,e){let t;if(e instanceof di)t={update:uw(n,e.key,e.value)};else if(e instanceof fi)t={delete:la(n,e.key)};else if(e instanceof Gt)t={update:uw(n,e.key,e.data),updateMask:WS(e.fieldMask)};else{if(!(e instanceof ia))return U();t={verify:la(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof ui)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof xn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Nn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof hi)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw U()}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:LS(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(n,e.precondition)),t}function Tf(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Ce.updateTime(xe(s.updateTime)):s.exists!==void 0?Ce.exists(s.exists):Ce.none()}(e.currentDocument):Ce.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(o,a){let c=null;if("setToServerValue"in a)G(a.setToServerValue==="REQUEST_TIME"),c=new ui;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new xn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new Nn(d)}else"increment"in a?c=new hi(o,a.increment):U();let u=Pe.fromServerFormat(a.fieldPath);return new tr(u,c)}(n,r)):[];if(e.update){e.update.name;let r=sn(n,e.update.name),s=new nt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new Tt(u.map(d=>Pe.fromServerFormat(d)))}(e.updateMask);return new Gt(r,s,o,t,i)}return new di(r,s,t,i)}if(e.delete){let r=sn(n,e.delete);return new fi(r,t)}if(e.verify){let r=sn(n,e.verify);return new ia(r,t)}return U()}function qS(n,e){return n&&n.length>0?(G(e!==void 0),n.map(t=>function(r,s){let o=r.updateTime?xe(r.updateTime):xe(s);return o.isEqual(K.min())&&(o=xe(s)),new df(o,r.transformResults||[])}(t,e))):[]}function YT(n,e){return{documents:[WT(n,e.path)]}}function XT(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=WT(n,r);let s=function(u){if(u.length!==0)return eE(ue.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:jr(m.field),direction:GS(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=yf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ht:t,parent:r}}function JT(n){let e=$T(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){G(i===1);let d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(p){let m=ZT(p);return m instanceof ue&&Xp(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(m=>function(C){return new Zi(Gr(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(p){let m;return m=typeof p=="object"?p.value:p,va(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(p){let m=!!p.before,y=p.values||[];return new ln(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(p){let m=!p.before,y=p.values||[];return new ln(y,m)}(t.endAt)),bT(e,r,o,s,a,"F",c,u)}function jS(n,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ZT(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let i=Gr(t.unaryFilter.field);return ie.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=Gr(t.unaryFilter.field);return ie.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Gr(t.unaryFilter.field);return ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Gr(t.unaryFilter.field);return ie.create(o,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):n.fieldFilter!==void 0?function(t){return ie.create(Gr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ue.create(t.compositeFilter.filters.map(i=>ZT(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(n):U()}function GS(n){return OS[n]}function KS(n){return FS[n]}function zS(n){return MS[n]}function jr(n){return{fieldPath:n.canonicalString()}}function Gr(n){return Pe.fromServerFormat(n.fieldPath)}function eE(n){return n instanceof ie?function(t){if(t.op==="=="){if(Hv(t.value))return{unaryFilter:{field:jr(t.field),op:"IS_NAN"}};if($v(t.value))return{unaryFilter:{field:jr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Hv(t.value))return{unaryFilter:{field:jr(t.field),op:"IS_NOT_NAN"}};if($v(t.value))return{unaryFilter:{field:jr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jr(t.field),op:KS(t.op),value:t.value}}}(n):n instanceof ue?function(t){let i=t.getFilters().map(r=>eE(r));return i.length===1?i[0]:{compositeFilter:{op:zS(t.op),filters:i}}}(n):U()}function WS(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function tE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ls=class n{constructor(e,t,i,r,s=K.min(),o=K.min(),a=Ne.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Cc=class{constructor(e){this.Tt=e}};function $S(n,e){let t;if(e.document)t=QT(n.Tt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let i=B.fromSegments(e.noDocument.path),r=ir(e.noDocument.readTime);t=Le.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{let i=B.fromSegments(e.unknownDocument.path),r=ir(e.unknownDocument.version);t=Le.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(r){let s=new we(r[0],r[1]);return K.fromTimestamp(s)}(e.readTime)),t}function hw(n,e){let t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:bc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(s,o){return{name:la(s,o.key),fields:o.data.value.mapValue.fields,updateTime:as(s,o.version.toTimestamp()),createTime:as(s,o.createTime.toTimestamp())}}(n.Tt,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:nr(e.version)};else{if(!e.isUnknownDocument())return U();i.unknownDocument={path:t.path.toArray(),version:nr(e.version)}}return i}function bc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function nr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ir(n){let e=new we(n.seconds,n.nanoseconds);return K.fromTimestamp(e)}function zi(n,e){let t=(e.baseMutations||[]).map(s=>Tf(n.Tt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let i=e.mutations.map(s=>Tf(n.Tt,s)),r=we.fromMillis(e.localWriteTimeMs);return new ra(e.batchId,r,t,i)}function qo(n){let e=ir(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ir(n.lastLimboFreeSnapshotVersion):K.min(),i;return i=function(s){return s.documents!==void 0}(n.query)?function(s){return G(s.documents.length===1),lt(vs($T(s.documents[0])))}(n.query):function(s){return lt(JT(s))}(n.query),new ls(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ne.fromBase64String(n.resumeToken))}function nE(n,e){let t=nr(e.snapshotVersion),i=nr(e.lastLimboFreeSnapshotVersion),r;r=vc(e.target)?YT(n.Tt,e.target):XT(n.Tt,e.target).ht;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:er(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function nm(n){let e=JT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Tc(e,e.limit,"L"):e}function Pd(n,e){return new sa(e.largestBatchId,Tf(n.Tt,e.overlayMutation))}function dw(n,e){let t=e.path.lastSegment();return[n,it(e.path.popLast()),t]}function fw(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:nr(i.readTime),documentKey:it(i.documentKey.path),largestBatchId:i.largestBatchId}}var Ef=class{getBundleMetadata(e,t){return pw(e).get(t).next(i=>{if(i)return function(s){return{id:s.bundleId,createTime:ir(s.createTime),version:s.version}}(i)})}saveBundleMetadata(e,t){return pw(e).put(function(r){return{bundleId:r.id,createTime:nr(xe(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return mw(e).get(t).next(i=>{if(i)return function(s){return{name:s.name,query:nm(s.bundledQuery),readTime:ir(s.readTime)}}(i)})}saveNamedQuery(e,t){return mw(e).put(function(r){return{name:r.name,readTime:nr(xe(r.readTime)),bundledQuery:r.bundledQuery}}(t))}};function pw(n){return Ge(n,lu)}function mw(n){return Ge(n,cu)}var Sc=class n{constructor(e,t){this.serializer=e,this.userId=t}static It(e,t){let i=t.uid||"";return new n(e,i)}getOverlay(e,t){return Fo(e).get(dw(this.userId,t)).next(i=>i?Pd(this.serializer,i):null)}getOverlays(e,t){let i=nn();return S.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){let r=[];return i.forEach((s,o)=>{let a=new sa(t,o);r.push(this.Et(e,a))}),S.waitFor(r)}removeOverlaysForBatchId(e,t,i){let r=new Set;t.forEach(o=>r.add(it(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(Fo(e).J(Qd,a))}),S.waitFor(s)}getOverlaysForCollection(e,t,i){let r=nn(),s=it(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Fo(e).G(Qd,o).next(a=>{for(let c of a){let u=Pd(this.serializer,c);r.set(u.getKey(),u)}return r})}getOverlaysForCollectionGroup(e,t,i,r){let s=nn(),o,a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Fo(e).Z({index:aT,range:a},(c,u,d)=>{let p=Pd(this.serializer,u);s.size()<r||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):d.done()}).next(()=>s)}Et(e,t){return Fo(e).put(function(r,s,o){let[a,c,u]=dw(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ca(r.Tt,o.mutation)}}(this.serializer,this.userId,t))}};function Fo(n){return Ge(n,uu)}var If=class{dt(e){return Ge(e,$p)}getSessionToken(e){return this.dt(e).get("sessionToken").next(t=>{let i=t?.value;return i?Ne.fromUint8Array(i):Ne.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.dt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var bn=class{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(e.booleanValue?1:0);else if("integerValue"in e)this.ft(t,15),t.gt(ye(e.integerValue));else if("doubleValue"in e){let i=ye(e.doubleValue);isNaN(i)?this.ft(t,13):(this.ft(t,15),Qo(i)?t.gt(0):t.gt(i))}else if("timestampValue"in e){let i=e.timestampValue;this.ft(t,20),typeof i=="string"&&(i=Rn(i)),t.yt(`${i.seconds||""}`),t.gt(i.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.bt(t);else if("bytesValue"in e)this.ft(t,30),t.St(Pn(e.bytesValue)),this.bt(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.ft(t,45),t.gt(i.latitude||0),t.gt(i.longitude||0)}else"mapValue"in e?yT(e)?this.ft(t,Number.MAX_SAFE_INTEGER):fu(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.bt(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.bt(t)):U()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){let i=e.fields||{};this.ft(t,55);for(let r of Object.keys(i))this.wt(r,t),this.Rt(i[r],t)}vt(e,t){var i,r;let s=e.fields||{};this.ft(t,53);let o=ns,a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.ft(t,15),t.gt(ye(a)),this.wt(o,t),this.Rt(s[o],t)}Ft(e,t){let i=e.values||[];this.ft(t,50);for(let r of i)this.Rt(r,t)}Dt(e,t){this.ft(t,37),B.fromName(e).path.forEach(i=>{this.ft(t,60),this.Mt(i,t)})}ft(e,t){e.gt(t)}bt(e){e.gt(2)}};bn.xt=new bn;var Fr=255;function HS(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function gw(n){let e=64-function(i){let r=0;for(let s=0;s<8;++s){let o=HS(255&i[s]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(e/8)}var Af=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ot(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.Nt(i.value),i=t.next();this.Bt()}Lt(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.kt(i.value),i=t.next();this.qt()}Qt(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.Nt(i);else if(i<2048)this.Nt(960|i>>>6),this.Nt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Nt(480|i>>>12),this.Nt(128|63&i>>>6),this.Nt(128|63&i);else{let r=t.codePointAt(0);this.Nt(240|r>>>18),this.Nt(128|63&r>>>12),this.Nt(128|63&r>>>6),this.Nt(128|63&r)}}this.Bt()}$t(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.kt(i);else if(i<2048)this.kt(960|i>>>6),this.kt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.kt(480|i>>>12),this.kt(128|63&i>>>6),this.kt(128|63&i);else{let r=t.codePointAt(0);this.kt(240|r>>>18),this.kt(128|63&r>>>12),this.kt(128|63&r>>>6),this.kt(128|63&r)}}this.qt()}Kt(e){let t=this.Ut(e),i=gw(t);this.Wt(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Gt(e){let t=this.Ut(e),i=gw(t);this.Wt(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}zt(){this.jt(Fr),this.jt(255)}Ht(){this.Jt(Fr),this.Jt(255)}reset(){this.position=0}seed(e){this.Wt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Yt(){return this.buffer.slice(0,this.position)}Ut(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),i=!!(128&t[0]);t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Nt(e){let t=255&e;t===0?(this.jt(0),this.jt(255)):t===Fr?(this.jt(Fr),this.jt(0)):this.jt(t)}kt(e){let t=255&e;t===0?(this.Jt(0),this.Jt(255)):t===Fr?(this.Jt(Fr),this.Jt(0)):this.Jt(e)}Bt(){this.jt(0),this.jt(1)}qt(){this.Jt(0),this.Jt(1)}jt(e){this.Wt(1),this.buffer[this.position++]=e}Jt(e){this.Wt(1),this.buffer[this.position++]=~e}Wt(e){let t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},Cf=class{constructor(e){this.Zt=e}St(e){this.Zt.Ot(e)}yt(e){this.Zt.Qt(e)}gt(e){this.Zt.Kt(e)}Vt(){this.Zt.zt()}},bf=class{constructor(e){this.Zt=e}St(e){this.Zt.Lt(e)}yt(e){this.Zt.$t(e)}gt(e){this.Zt.Gt(e)}Vt(){this.Zt.Ht()}},Wi=class{constructor(){this.Zt=new Af,this.Xt=new Cf(this.Zt),this.en=new bf(this.Zt)}seed(e){this.Zt.seed(e)}tn(e){return e===0?this.Xt:this.en}Yt(){return this.Zt.Yt()}reset(){this.Zt.reset()}};var $i=class n{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}nn(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function Xn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=_w(n.arrayValue,e.arrayValue),t!==0?t:(t=_w(n.directionalValue,e.directionalValue),t!==0?t:B.comparator(n.documentKey,e.documentKey)))}function _w(n,e){for(let t=0;t<n.length&&t<e.length;++t){let i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}var Rc=class{constructor(e){this.rn=new he((t,i)=>Pe.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.sn=e.orderBy,this._n=[];for(let t of e.filters){let i=t;i.isInequality()?this.rn=this.rn.add(i):this._n.push(i)}}get an(){return this.rn.size>1}un(e){if(G(e.collectionGroup===this.collectionId),this.an)return!1;let t=jd(e);if(t!==void 0&&!this.cn(t))return!1;let i=ji(e),r=new Set,s=0,o=0;for(;s<i.length&&this.cn(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.rn.size>0){let a=this.rn.getIterator().getNext();if(!r.has(a.field.canonicalString())){let c=i[s];if(!this.ln(a,c)||!this.hn(this.sn[o++],c))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.sn.length||!this.hn(this.sn[o++],a))return!1}return!0}Pn(){if(this.an)return null;let e=new he(Pe.comparator),t=[];for(let i of this._n)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new Wr(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new Wr(i.field,0))}for(let i of this.sn)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new Wr(i.field,i.dir==="asc"?0:1)));return new Xr(Xr.UNKNOWN_ID,this.collectionId,t,Ho.empty())}cn(e){for(let t of this._n)if(this.ln(t,e))return!0;return!1}ln(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}hn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function iE(n){var e,t;if(G(n instanceof ie||n instanceof ue),n instanceof ie){if(n instanceof yc){let r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ie.create(n.field,"==",s)))||[];return ue.create(r,"or")}return n}let i=n.filters.map(r=>iE(r));return ue.create(i,n.op)}function QS(n){if(n.getFilters().length===0)return[];let e=Pf(iE(n));return G(rE(e)),Sf(e)||Rf(e)?[e]:e.getFilters()}function Sf(n){return n instanceof ie}function Rf(n){return n instanceof ue&&Xp(n)}function rE(n){return Sf(n)||Rf(n)||function(t){if(t instanceof ue&&ef(t)){for(let i of t.getFilters())if(!Sf(i)&&!Rf(i))return!1;return!0}return!1}(n)}function Pf(n){if(G(n instanceof ie||n instanceof ue),n instanceof ie)return n;if(n.filters.length===1)return Pf(n.filters[0]);let e=n.filters.map(i=>Pf(i)),t=ue.create(e,n.op);return t=Pc(t),rE(t)?t:(G(t instanceof ue),G(rs(t)),G(t.filters.length>1),t.filters.reduce((i,r)=>im(i,r)))}function im(n,e){let t;return G(n instanceof ie||n instanceof ue),G(e instanceof ie||e instanceof ue),t=n instanceof ie?e instanceof ie?function(r,s){return ue.create([r,s],"and")}(n,e):yw(n,e):e instanceof ie?yw(e,n):function(r,s){if(G(r.filters.length>0&&s.filters.length>0),rs(r)&&rs(s))return IT(r,s.getFilters());let o=ef(r)?r:s,a=ef(r)?s:r,c=o.filters.map(u=>im(u,a));return ue.create(c,"or")}(n,e),Pc(t)}function yw(n,e){if(rs(e))return IT(e,n.getFilters());{let t=e.filters.map(i=>im(n,i));return ue.create(t,"or")}}function Pc(n){if(G(n instanceof ie||n instanceof ue),n instanceof ie)return n;let e=n.getFilters();if(e.length===1)return Pc(e[0]);if(TT(n))return n;let t=e.map(r=>Pc(r)),i=[];return t.forEach(r=>{r instanceof ie?i.push(r):r instanceof ue&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:ue.create(i,n.op)}var xf=class{constructor(){this.Tn=new ua}addToCollectionParentIndex(e,t){return this.Tn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(Pt.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(Pt.min())}updateCollectionGroup(e,t,i){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}},ua=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new he(se.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new he(se.comparator)).toArray()}};var vw="IndexedDbIndexManager",$l=new Uint8Array(0),Nf=class{constructor(e,t){this.databaseId=t,this.In=new ua,this.En=new jt(i=>er(i),(i,r)=>Ta(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.In.has(t)){let i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.In.add(t)});let s={collectionId:i,parent:it(r)};return ww(e).put(s)}return S.resolve()}getCollectionParents(e,t){let i=[],r=IDBKeyRange.bound([t,""],[Yw(t),""],!1,!0);return ww(e).G(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;i.push(tn(o.parent))}return i})}addFieldIndex(e,t){let i=Mo(e),r=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;let s=i.add(r);if(t.indexState){let o=Lr(e);return s.next(a=>{o.put(fw(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let i=Mo(e),r=Lr(e),s=Mr(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Mo(e),i=Mr(e),r=Lr(e);return t.J().next(()=>i.J()).next(()=>r.J())}createTargetIndexes(e,t){return S.forEach(this.dn(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){let s=new Rc(i).Pn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let i=Mr(e),r=!0,s=new Map;return S.forEach(this.dn(t),o=>this.An(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=J(),a=[];return S.forEach(s,(c,u)=>{V(vw,`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${er(t)}`);let d=function(F,W){let Q=jd(W);if(Q===void 0)return null;for(let Y of wc(F,Q.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(u,c),p=function(F,W){let Q=new Map;for(let Y of ji(W))for(let T of wc(F,Y.fieldPath))switch(T.op){case"==":case"in":Q.set(Y.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return Q.set(Y.fieldPath.canonicalString(),T.value),Array.from(Q.values())}return null}(u,c),m=function(F,W){let Q=[],Y=!0;for(let T of ji(W)){let _=T.kind===0?Zv(F,T.fieldPath,F.startAt):ew(F,T.fieldPath,F.startAt);Q.push(_.value),Y&&(Y=_.inclusive)}return new ln(Q,Y)}(u,c),y=function(F,W){let Q=[],Y=!0;for(let T of ji(W)){let _=T.kind===0?ew(F,T.fieldPath,F.endAt):Zv(F,T.fieldPath,F.endAt);Q.push(_.value),Y&&(Y=_.inclusive)}return new ln(Q,Y)}(u,c),C=this.Rn(c,u,m),P=this.Rn(c,u,y),k=this.Vn(c,u,p),q=this.mn(c.indexId,d,C,m.inclusive,P,y.inclusive,k);return S.forEach(q,j=>i.H(j,t.limit).next(F=>{F.forEach(W=>{let Q=B.fromSegments(W.documentKey);o.has(Q)||(o=o.add(Q),a.push(Q))})}))}).next(()=>a)}return S.resolve(null)})}dn(e){let t=this.En.get(e);return t||(e.filters.length===0?t=[e]:t=QS(ue.create(e.filters,"and")).map(i=>uf(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.En.set(e,t),t)}mn(e,t,i,r,s,o,a){let c=(t!=null?t.length:1)*Math.max(i.length,s.length),u=c/(t!=null?t.length:1),d=[];for(let p=0;p<c;++p){let m=t?this.fn(t[p/u]):$l,y=this.gn(e,m,i[p%u],r),C=this.pn(e,m,s[p%u],o),P=a.map(k=>this.gn(e,m,k,!0));d.push(...this.createRange(y,C,P))}return d}gn(e,t,i,r){let s=new $i(e,B.empty(),t,i);return r?s:s.nn()}pn(e,t,i,r){let s=new $i(e,B.empty(),t,i);return r?s.nn():s}An(e,t){let i=new Rc(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let a of s)i.un(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2,r=this.dn(t);return S.forEach(r,s=>this.An(e,s).next(o=>{o?i!==0&&o.fields.length<function(c){let u=new he(Pe.comparator),d=!1;for(let p of c.filters)for(let m of p.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:u=u.add(m.field));for(let p of c.orderBy)p.field.isKeyField()||(u=u.add(p.field));return u.size+(d?1:0)}(s)&&(i=1):i=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&i===2?1:i)}yn(e,t){let i=new Wi;for(let r of ji(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=i.tn(r.kind);bn.xt.At(s,o)}return i.Yt()}fn(e){let t=new Wi;return bn.xt.At(e,t.tn(0)),t.Yt()}wn(e,t){let i=new Wi;return bn.xt.At(Ji(this.databaseId,t),i.tn(function(s){let o=ji(s);return o.length===0?0:o[o.length-1].kind}(e))),i.Yt()}Vn(e,t,i){if(i===null)return[];let r=[];r.push(new Wi);let s=0;for(let o of ji(e)){let a=i[s++];for(let c of r)if(this.bn(t,o.fieldPath)&&na(a))r=this.Sn(r,o,a);else{let u=c.tn(o.kind);bn.xt.At(a,u)}}return this.Dn(r)}Rn(e,t,i){return this.Vn(e,t,i.position)}Dn(e){let t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Yt();return t}Sn(e,t,i){let r=[...e],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let c=new Wi;c.seed(a.Yt()),bn.xt.At(o,c.tn(t.kind)),s.push(c)}return s}bn(e,t){return!!e.filters.find(i=>i instanceof ie&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){let i=Mo(e),r=Lr(e);return(t?i.G(Hd,IDBKeyRange.bound(t,t)):i.G()).next(s=>{let o=[];return S.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(d,p){let m=p?new Ho(p.sequenceNumber,new Pt(ir(p.readTime),new B(tn(p.documentKey)),p.largestBatchId)):Ho.empty(),y=d.fields.map(([C,P])=>new Wr(Pe.fromServerFormat(C),P));return new Xr(d.indexId,d.collectionGroup,y,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:H(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){let r=Mo(e),s=Lr(e);return this.vn(e).next(o=>r.G(Hd,IDBKeyRange.bound(t,t)).next(a=>S.forEach(a,c=>s.put(fw(c.indexId,this.uid,o,i)))))}updateIndexEntries(e,t){let i=new Map;return S.forEach(t,(r,s)=>{let o=i.get(r.collectionGroup);return(o?S.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),S.forEach(a,c=>this.Cn(e,r,c).next(u=>{let d=this.Fn(s,c);return u.isEqual(d)?S.resolve():this.Mn(e,s,c,u,d)}))))})}xn(e,t,i,r){return Mr(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.wn(i,t.key),documentKey:t.key.path.toArray()})}On(e,t,i,r){return Mr(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.wn(i,t.key),t.key.path.toArray()])}Cn(e,t,i){let r=Mr(e),s=new he(Xn);return r.Z({index:oT,range:IDBKeyRange.only([i.indexId,this.uid,this.wn(i,t)])},(o,a)=>{s=s.add(new $i(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Fn(e,t){let i=new he(Xn),r=this.yn(t,e);if(r==null)return i;let s=jd(t);if(s!=null){let o=e.data.field(s.fieldPath);if(na(o))for(let a of o.arrayValue.values||[])i=i.add(new $i(t.indexId,e.key,this.fn(a),r))}else i=i.add(new $i(t.indexId,e.key,$l,r));return i}Mn(e,t,i,r,s){V(vw,"Updating index entries for document '%s'",t.key);let o=[];return function(c,u,d,p,m){let y=c.getIterator(),C=u.getIterator(),P=Or(y),k=Or(C);for(;P||k;){let q=!1,j=!1;if(P&&k){let F=d(P,k);F<0?j=!0:F>0&&(q=!0)}else P!=null?j=!0:q=!0;q?(p(k),k=Or(C)):j?(m(P),P=Or(y)):(P=Or(y),k=Or(C))}}(r,s,Xn,a=>{o.push(this.xn(e,t,i,a))},a=>{o.push(this.On(e,t,i,a))}),S.waitFor(o)}vn(e){let t=1;return Lr(e).Z({index:sT,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>Xn(o,a)).filter((o,a,c)=>!a||Xn(o,c[a-1])!==0);let r=[];r.push(e);for(let o of i){let a=Xn(o,e),c=Xn(o,t);if(a===0)r[0]=e.nn();else if(a>0&&c<0)r.push(o),r.push(o.nn());else if(c>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.Nn(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,$l,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,$l,[]];s.push(IDBKeyRange.bound(a,c))}return s}Nn(e,t){return Xn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Tw)}getMinOffset(e,t){return S.mapArray(this.dn(t),i=>this.An(e,i).next(r=>r||U())).next(Tw)}};function ww(n){return Ge(n,Jo)}function Mr(n){return Ge(n,pc)}function Mo(n){return Ge(n,Wp)}function Lr(n){return Ge(n,fc)}function Tw(n){G(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;Gp(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Pt(e.readTime,e.documentKey,t)}var Ew={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},sE=41943040,pt=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}};function oE(n,e,t){let i=n.store(Bt),r=n.store(Jr),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=i.Z({range:o},(d,p,m)=>(a++,m.delete()));s.push(c.next(()=>{G(a===1)}));let u=[];for(let d of t.mutations){let p=nT(e,d.key.path,t.batchId);s.push(r.delete(p)),u.push(d.key)}return S.waitFor(s).next(()=>u)}function xc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U();e=n.noDocument}return JSON.stringify(e).length}pt.DEFAULT_COLLECTION_PERCENTILE=10,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pt.DEFAULT=new pt(sE,pt.DEFAULT_COLLECTION_PERCENTILE,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pt.DISABLED=new pt(-1,0,0);var Nc=class n{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.Bn={}}static It(e,t,i,r){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,i,r)}checkEmpty(e){let t=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Jn(e).Z({index:Hi,range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){let s=Kr(e),o=Jn(e);return o.add({}).next(a=>{G(typeof a=="number");let c=new ra(a,t,i,r),u=function(y,C,P){let k=P.baseMutations.map(j=>ca(y.Tt,j)),q=P.mutations.map(j=>ca(y.Tt,j));return{userId:C,batchId:P.batchId,localWriteTimeMs:P.localWriteTime.toMillis(),baseMutations:k,mutations:q}}(this.serializer,this.userId,c),d=[],p=new he((m,y)=>H(m.canonicalString(),y.canonicalString()));for(let m of r){let y=nT(this.userId,m.key.path,a);p=p.add(m.key.path.popLast()),d.push(o.put(u)),d.push(s.put(y,Qb))}return p.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Bn[a]=c.keys()}),S.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return Jn(e).get(t).next(i=>i?(G(i.userId===this.userId),zi(this.serializer,i)):null)}Ln(e,t){return this.Bn[t]?S.resolve(this.Bn[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){let r=i.keys();return this.Bn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return Jn(e).Z({index:Hi,range:r},(o,a,c)=>{a.userId===this.userId&&(G(a.batchId>=i),s=zi(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=ii;return Jn(e).Z({index:Hi,range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ii],[this.userId,Number.POSITIVE_INFINITY]);return Jn(e).G(Hi,t).next(i=>i.map(r=>zi(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let i=Xl(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return Kr(e).Z({range:r},(o,a,c)=>{let[u,d,p]=o,m=tn(d);if(u===this.userId&&t.path.isEqual(m))return Jn(e).get(p).next(y=>{if(!y)throw U();G(y.userId===this.userId),s.push(zi(this.serializer,y))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new he(H),r=[];return t.forEach(s=>{let o=Xl(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=Kr(e).Z({range:a},(u,d,p)=>{let[m,y,C]=u,P=tn(y);m===this.userId&&s.path.isEqual(P)?i=i.add(C):p.done()});r.push(c)}),S.waitFor(r).next(()=>this.kn(e,i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=Xl(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new he(H);return Kr(e).Z({range:o},(c,u,d)=>{let[p,m,y]=c,C=tn(m);p===this.userId&&i.isPrefixOf(C)?C.length===r&&(a=a.add(y)):d.done()}).next(()=>this.kn(e,a))}kn(e,t){let i=[],r=[];return t.forEach(s=>{r.push(Jn(e).get(s).next(o=>{if(o===null)throw U();G(o.userId===this.userId),i.push(zi(this.serializer,o))}))}),S.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return oE(e.ue,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.qn(t.batchId)}),S.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}qn(e){delete this.Bn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();let i=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return Kr(e).Z({range:i},(s,o,a)=>{if(s[0]===this.userId){let c=tn(s[1]);r.push(c)}else a.done()}).next(()=>{G(r.length===0)})})}containsKey(e,t){return aE(e,this.userId,t)}Qn(e){return lE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ii,lastStreamToken:""})}};function aE(n,e,t){let i=Xl(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return Kr(n).Z({range:s,Y:!0},(a,c,u)=>{let[d,p,m]=a;d===e&&p===r&&(o=!0),u.done()}).next(()=>o)}function Jn(n){return Ge(n,Bt)}function Kr(n){return Ge(n,Jr)}function lE(n){return Ge(n,Yo)}var cs=class n{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new n(0)}static Un(){return new n(-1)}};var kf=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Wn(e).next(t=>{let i=new cs(t.highestTargetId);return t.highestTargetId=i.next(),this.Gn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Wn(e).next(t=>K.fromTimestamp(new we(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Wn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Wn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Gn(e,r)))}addTargetData(e,t){return this.zn(e,t).next(()=>this.Wn(e).next(i=>(i.targetCount+=1,this.jn(t,i),this.Gn(e,i))))}updateTargetData(e,t){return this.zn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Br(e).delete(t.targetId)).next(()=>this.Wn(e)).next(i=>(G(i.targetCount>0),i.targetCount-=1,this.Gn(e,i)))}removeTargets(e,t,i){let r=0,s=[];return Br(e).Z((o,a)=>{let c=qo(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>S.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Br(e).Z((i,r)=>{let s=qo(r);t(s)})}Wn(e){return Iw(e).get(dc).next(t=>(G(t!==null),t))}Gn(e,t){return Iw(e).put(dc,t)}zn(e,t){return Br(e).put(nE(this.serializer,t))}jn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Wn(e).next(t=>t.targetCount)}getTargetData(e,t){let i=er(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return Br(e).Z({range:r,index:rT},(o,a,c)=>{let u=qo(a);Ta(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){let r=[],s=ei(e);return t.forEach(o=>{let a=it(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),S.waitFor(r)}removeMatchingKeys(e,t,i){let r=ei(e);return S.forEach(t,s=>{let o=it(s.path);return S.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){let i=ei(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){let i=IDBKeyRange.bound([t],[t+1],!1,!0),r=ei(e),s=J();return r.Z({range:i,Y:!0},(o,a,c)=>{let u=tn(o[1]),d=new B(u);s=s.add(d)}).next(()=>s)}containsKey(e,t){let i=it(t.path),r=IDBKeyRange.bound([i],[Yw(i)],!1,!0),s=0;return ei(e).Z({index:zp,Y:!0,range:r},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}lt(e,t){return Br(e).get(t).next(i=>i?qo(i):null)}};function Br(n){return Ge(n,Zr)}function Iw(n){return Ge(n,Xi)}function ei(n){return Ge(n,es)}var Aw="LruGarbageCollector",YS=1048576;function Cw([n,e],[t,i]){let r=H(n,t);return r===0?H(e,i):r}var Df=class{constructor(e){this.Hn=e,this.buffer=new he(Cw),this.Jn=0}Yn(){return++this.Jn}Zn(e){let t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{let i=this.buffer.last();Cw(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}},kc=class{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){V(Aw,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>N(this,null,function*(){this.Xn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){_i(t)?V(Aw,"Ignoring IndexedDB error during garbage collection: ",t):yield gi(t)}yield this.er(3e5)}))}},Vf=class{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return S.resolve(wt.ae);let i=new Df(t);return this.tr.forEachTarget(e,r=>i.Zn(r.sequenceNumber)).next(()=>this.tr.rr(e,r=>i.Zn(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.tr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Ew)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ew):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let i,r,s,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(i=p,a=Date.now(),this.removeTargets(e,i,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(p=>(u=Date.now(),Ur()<=Rt.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${p} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:p})))}};function cE(n,e){return new Vf(n,e)}var Of=class{constructor(e,t){this.db=e,this.garbageCollector=cE(this,t)}nr(e){let t=this.sr(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}sr(e){let t=0;return this.rr(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}rr(e,t){return this._r(e,(i,r)=>t(r))}addReference(e,t,i){return Hl(e,i)}removeReference(e,t,i){return Hl(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return Hl(e,t)}ar(e,t){return function(r,s){let o=!1;return lE(r).X(a=>aE(r,a,s).next(c=>(c&&(o=!0),S.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],s=0;return this._r(e,(o,a)=>{if(a<=t){let c=this.ar(e,o).next(u=>{if(!u)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,K.min()),ei(e).delete(function(p){return[0,it(p.path)]}(o))))});r.push(c)}}).next(()=>S.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return Hl(e,t)}_r(e,t){let i=ei(e),r,s=wt.ae;return i.Z({index:zp},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==wt.ae&&t(new B(tn(r)),s),s=u,r=c):s=wt.ae}).next(()=>{s!==wt.ae&&t(new B(tn(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Hl(n,e){return ei(n).put(function(i,r){return{targetId:0,path:it(i.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}var Dc=class{constructor(){this.changes=new jt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Le.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?S.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ff=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return qi(e).put(i)}removeEntry(e,t,i){return qi(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],bc(o),a[a.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.ur(e,i)))}getEntry(e,t){let i=Le.newInvalidDocument(t);return qi(e).Z({index:Jl,range:IDBKeyRange.only(Lo(t))},(r,s)=>{i=this.cr(t,s)}).next(()=>i)}lr(e,t){let i={size:0,document:Le.newInvalidDocument(t)};return qi(e).Z({index:Jl,range:IDBKeyRange.only(Lo(t))},(r,s)=>{i={document:this.cr(t,s),size:xc(s)}}).next(()=>i)}getEntries(e,t){let i=mt();return this.hr(e,t,(r,s)=>{let o=this.cr(r,s);i=i.insert(r,o)}).next(()=>i)}Pr(e,t){let i=mt(),r=new _e(B.comparator);return this.hr(e,t,(s,o)=>{let a=this.cr(s,o);i=i.insert(s,a),r=r.insert(s,xc(o))}).next(()=>({documents:i,Tr:r}))}hr(e,t,i){if(t.isEmpty())return S.resolve();let r=new he(Rw);t.forEach(c=>r=r.add(c));let s=IDBKeyRange.bound(Lo(r.first()),Lo(r.last())),o=r.getIterator(),a=o.getNext();return qi(e).Z({index:Jl,range:s},(c,u,d)=>{let p=B.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Rw(a,p)<0;)i(a,null),a=o.getNext();a&&a.isEqual(p)&&(i(a,u),a=o.hasNext()?o.getNext():null),a?d.W(Lo(a)):d.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),bc(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qi(e).G(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let d=mt();for(let p of u){let m=this.cr(B.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);m.isFoundDocument()&&(Ia(t,m)||r.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,i,r){let s=mt(),o=Sw(t,i),a=Sw(t,Pt.max());return qi(e).Z({index:iT,range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let p=this.cr(B.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(p.key,p),s.size===r&&d.done()}).next(()=>s)}newChangeBuffer(e){return new Mf(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return bw(e).get($d).next(t=>(G(!!t),t))}ur(e,t){return bw(e).put($d,t)}cr(e,t){if(t){let i=$S(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(K.min())))return i}return Le.newInvalidDocument(e)}};function uE(n){return new Ff(n)}var Mf=class extends Dc{constructor(e,t){super(),this.Ir=e,this.trackRemovals=t,this.Er=new jt(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){let t=[],i=0,r=new he((s,o)=>H(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.Er.get(s);if(t.push(this.Ir.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=hw(this.Ir.serializer,o);r=r.add(s.path.popLast());let u=xc(c);i+=u-a.size,t.push(this.Ir.addEntry(e,s,c))}else if(i-=a.size,this.trackRemovals){let c=hw(this.Ir.serializer,o.convertToNoDocument(K.min()));t.push(this.Ir.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.Ir.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Ir.updateMetadata(e,i)),S.waitFor(t)}getFromCache(e,t){return this.Ir.lr(e,t).next(i=>(this.Er.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Ir.Pr(e,t).next(({documents:i,Tr:r})=>(r.forEach((s,o)=>{this.Er.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function bw(n){return Ge(n,Xo)}function qi(n){return Ge(n,hc)}function Lo(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Sw(n,e){let t=e.documentKey.path.toArray();return[n,bc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Rw(n,e){let t=n.path.toArray(),i=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=H(t[s],i[s]),r)return r;return r=H(t.length,i.length),r||(r=H(t[t.length-2],i[i.length-2]),r||H(t[t.length-1],i[i.length-1]))}var Lf=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Vc=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&zo(i.mutation,r,Tt.empty(),we.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,J()).next(()=>i))}getLocalViewOfDocuments(e,t,i=J()){let r=nn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=Uo();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=nn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,J()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=mt(),o=Ko(),a=function(){return Ko()}();return t.forEach((c,u)=>{let d=i.get(u.key);r.has(u.key)&&(d===void 0||d.mutation instanceof Gt)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),zo(d.mutation,u,d.mutation.getFieldMask(),we.now())):o.set(u.key,Tt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var p;return a.set(u,new Lf(d,(p=o.get(u))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){let i=Ko(),r=new _e((o,a)=>o-a),s=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=i.get(c)||Tt.empty();d=a.applyToLocalView(u,d),i.set(c,d);let p=(r.get(a.batchId)||J()).add(c);r=r.insert(a.batchId,p)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,p=kT();d.forEach(m=>{if(!s.has(m)){let y=BT(t.get(m),i.get(m));y!==null&&p.set(m,y),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,p))}return S.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(o){return B.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Jp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):S.resolve(nn()),a=Yr,c=s;return o.next(u=>S.forEach(u,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(d)?S.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{c=c.insert(d,m)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,J())).next(d=>({batchId:a,changes:NT(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next(i=>{let r=Uo();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=Uo();return this.indexManager.getCollectionParents(e,s).next(a=>S.forEach(a,c=>{let u=function(p,m){return new qt(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,i,r).next(d=>{d.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,Le.newInvalidDocument(d)))});let a=Uo();return o.forEach((c,u)=>{let d=s.get(c);d!==void 0&&zo(d.mutation,u,Tt.empty(),we.now()),Ia(t,u)&&(a=a.insert(c,u))}),a})}};var Bf=class{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return S.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:xe(r.createTime)}}(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(r){return{name:r.name,query:nm(r.bundledQuery),readTime:xe(r.readTime)}}(t)),S.resolve()}};var Uf=class{constructor(){this.overlays=new _e(B.comparator),this.Rr=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){let i=nn();return S.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.Et(e,t,s)}),S.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.Rr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Rr.delete(i)),S.resolve()}getOverlaysForCollection(e,t,i){let r=nn(),s=t.length+1,o=new B(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return S.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new _e((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let d=s.get(u.largestBatchId);d===null&&(d=nn(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=nn(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=r)););return S.resolve(a)}Et(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.Rr.get(r.largestBatchId).delete(i.key);this.Rr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new sa(t,i));let s=this.Rr.get(t);s===void 0&&(s=J(),this.Rr.set(t,s)),this.Rr.set(t,s.add(i.key))}};var qf=class{constructor(){this.sessionToken=Ne.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}};var ha=class{constructor(){this.Vr=new he(Fe.mr),this.gr=new he(Fe.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){let i=new Fe(e,t);this.Vr=this.Vr.add(i),this.gr=this.gr.add(i)}yr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.wr(new Fe(e,t))}br(e,t){e.forEach(i=>this.removeReference(i,t))}Sr(e){let t=new B(new se([])),i=new Fe(t,e),r=new Fe(t,e+1),s=[];return this.gr.forEachInRange([i,r],o=>{this.wr(o),s.push(o.key)}),s}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){let t=new B(new se([])),i=new Fe(t,e),r=new Fe(t,e+1),s=J();return this.gr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Fe(e,0),i=this.Vr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},Fe=class{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return B.comparator(e.key,t.key)||H(e.Cr,t.Cr)}static pr(e,t){return H(e.Cr,t.Cr)||B.comparator(e.key,t.key)}};var jf=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new he(Fe.mr)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ra(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.Mr=this.Mr.add(new Fe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return S.resolve(o)}lookupMutationBatch(e,t){return S.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.Nr(i),s=r<0?0:r;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?ii:this.Fr-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new Fe(t,0),r=new Fe(t,Number.POSITIVE_INFINITY),s=[];return this.Mr.forEachInRange([i,r],o=>{let a=this.Or(o.Cr);s.push(a)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new he(H);return t.forEach(r=>{let s=new Fe(r,0),o=new Fe(r,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([s,o],a=>{i=i.add(a.Cr)})}),S.resolve(this.Br(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;B.isDocumentKey(s)||(s=s.child(""));let o=new Fe(new B(s),0),a=new he(H);return this.Mr.forEachWhile(c=>{let u=c.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(a=a.add(c.Cr)),!0)},o),S.resolve(this.Br(a))}Br(e){let t=[];return e.forEach(i=>{let r=this.Or(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){G(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.Mr;return S.forEach(t.mutations,r=>{let s=new Fe(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Mr=i})}qn(e){}containsKey(e,t){let i=new Fe(t,0),r=this.Mr.firstAfterOrEqual(i);return S.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){let t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Gf=class{constructor(e){this.kr=e,this.docs=function(){return new _e(B.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.kr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return S.resolve(i?i.document.mutableCopy():Le.newInvalidDocument(t))}getEntries(e,t){let i=mt();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Le.newInvalidDocument(r))}),S.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=mt(),o=t.path,a=new B(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Gp(Jw(d),i)<=0||(r.has(d.key)||Ia(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(e,t,i,r){U()}qr(e,t){return S.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Kf(this)}getSize(e){return S.resolve(this.size)}},Kf=class extends Dc{constructor(e){super(),this.Ir=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Ir.addEntry(e,r)):this.Ir.removeEntry(i)}),S.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}};var zf=class{constructor(e){this.persistence=e,this.Qr=new jt(t=>er(t),Ta),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.$r=0,this.Kr=new ha,this.targetCount=0,this.Ur=cs.Kn()}forEachTarget(e,t){return this.Qr.forEach((i,r)=>t(r)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.$r&&(this.$r=t),S.resolve()}zn(e){this.Qr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Ur=new cs(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.zn(t),S.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.Sr(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.Qr.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Qr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),S.waitFor(s).next(()=>r)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){let i=this.Qr.get(t)||null;return S.resolve(i)}addMatchingKeys(e,t,i){return this.Kr.yr(t,i),S.resolve()}removeMatchingKeys(e,t,i){this.Kr.br(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),S.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Kr.Sr(t),S.resolve()}getMatchingKeysForTargetId(e,t){let i=this.Kr.vr(t);return S.resolve(i)}containsKey(e,t){return S.resolve(this.Kr.containsKey(t))}};var da=class{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new wt(0),this.zr=!1,this.zr=!0,this.jr=new qf,this.referenceDelegate=e(this),this.Hr=new zf(this),this.indexManager=new xf,this.remoteDocumentCache=function(r){return new Gf(r)}(i=>this.referenceDelegate.Jr(i)),this.serializer=new Cc(t),this.Yr=new Bf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Uf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Wr[e.toKey()];return i||(i=new jf(t,this.referenceDelegate),this.Wr[e.toKey()]=i),i}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,i){V("MemoryPersistence","Starting transaction:",e);let r=new Wf(this.Gr.next());return this.referenceDelegate.Zr(),i(r).next(s=>this.referenceDelegate.Xr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}ei(e,t){return S.or(Object.values(this.Wr).map(i=>()=>i.containsKey(e,t)))}},Wf=class extends lc{constructor(e){super(),this.currentSequenceNumber=e}},Oc=class n{constructor(e){this.persistence=e,this.ti=new ha,this.ni=null}static ri(e){return new n(e)}get ii(){if(this.ni)return this.ni;throw U()}addReference(e,t,i){return this.ti.addReference(i,t),this.ii.delete(i.toString()),S.resolve()}removeReference(e,t,i){return this.ti.removeReference(i,t),this.ii.add(i.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),S.resolve()}removeTarget(e,t){this.ti.Sr(t.targetId).forEach(r=>this.ii.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.ii.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.ii,i=>{let r=B.fromPath(i);return this.si(e,r).next(s=>{s||t.removeEntry(r,K.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(i=>{i?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return S.or([()=>S.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}},Fc=class n{constructor(e,t){this.persistence=e,this.oi=new jt(i=>it(i.path),(i,r)=>i.isEqual(r)),this.garbageCollector=cE(this,t)}static ri(e,t){return new n(e,t)}Zr(){}Xr(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){let t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}sr(e){let t=0;return this.rr(e,i=>{t++}).next(()=>t)}rr(e,t){return S.forEach(this.oi,(i,r)=>this.ar(e,i,r).next(s=>s?S.resolve():t(r)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0,r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.qr(e,o=>this.ar(e,o,t).next(a=>{a||(i++,s.removeEntry(o,K.min()))})).next(()=>s.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.oi.set(i,e.currentSequenceNumber),S.resolve()}removeReference(e,t,i){return this.oi.set(i,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),S.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ec(e.data.value)),t}ar(e,t,i){return S.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let r=this.oi.get(t);return S.resolve(r!==void 0&&r>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var $f=class{constructor(e){this.serializer=e}B(e,t,i,r){let s=new cc("createOrUpgrade",t);i<1&&r>=1&&(function(c){c.createObjectStore(wa)}(e),function(c){c.createObjectStore(Yo,{keyPath:Hb}),c.createObjectStore(Bt,{keyPath:jv,autoIncrement:!0}).createIndex(Hi,Gv,{unique:!0}),c.createObjectStore(Jr)}(e),Pw(e),function(c){c.createObjectStore(Gi)}(e));let o=S.resolve();return i<3&&r>=3&&(i!==0&&(function(c){c.deleteObjectStore(es),c.deleteObjectStore(Zr),c.deleteObjectStore(Xi)}(e),Pw(e)),o=o.next(()=>function(c){let u=c.store(Xi),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return u.put(dc,d)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(c,u){return u.store(Bt).G().next(p=>{c.deleteObjectStore(Bt),c.createObjectStore(Bt,{keyPath:jv,autoIncrement:!0}).createIndex(Hi,Gv,{unique:!0});let m=u.store(Bt),y=p.map(C=>m.put(C));return S.waitFor(y)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore(ts,{keyPath:iS})})(e)})),i<5&&r>=5&&(o=o.next(()=>this._i(s))),i<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore(Xo)}(e),this.ai(s)))),i<7&&r>=7&&(o=o.next(()=>this.ui(s))),i<8&&r>=8&&(o=o.next(()=>this.ci(e,s))),i<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&r>=10&&(o=o.next(()=>this.li(s))),i<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(lu,{keyPath:rS})})(e),function(c){c.createObjectStore(cu,{keyPath:sS})}(e)})),i<12&&r>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore(uu,{keyPath:dS});u.createIndex(Qd,fS,{unique:!1}),u.createIndex(aT,pS,{unique:!1})})(e)})),i<13&&r>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore(hc,{keyPath:Yb});u.createIndex(Jl,Xb),u.createIndex(iT,Jb)}(e)).next(()=>this.hi(e,s)).next(()=>e.deleteObjectStore(Gi))),i<14&&r>=14&&(o=o.next(()=>this.Pi(e,s))),i<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore(Wp,{keyPath:oS,autoIncrement:!0}).createIndex(Hd,aS,{unique:!1}),c.createObjectStore(fc,{keyPath:lS}).createIndex(sT,cS,{unique:!1}),c.createObjectStore(pc,{keyPath:uS}).createIndex(oT,hS,{unique:!1})}(e))),i<16&&r>=16&&(o=o.next(()=>{t.objectStore(fc).clear()}).next(()=>{t.objectStore(pc).clear()})),i<17&&r>=17&&(o=o.next(()=>{(function(c){c.createObjectStore($p,{keyPath:mS})})(e)})),o}ai(e){let t=0;return e.store(Gi).Z((i,r)=>{t+=xc(r)}).next(()=>{let i={byteSize:t};return e.store(Xo).put($d,i)})}_i(e){let t=e.store(Yo),i=e.store(Bt);return t.G().next(r=>S.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,ii],[s.userId,s.lastAcknowledgedBatchId]);return i.G(Hi,o).next(a=>S.forEach(a,c=>{G(c.userId===s.userId);let u=zi(this.serializer,c);return oE(e,s.userId,u).next(()=>{})}))}))}ui(e){let t=e.store(es),i=e.store(Gi);return e.store(Xi).get(dc).next(r=>{let s=[];return i.Z((o,a)=>{let c=new se(o),u=function(p){return[0,it(p)]}(c);s.push(t.get(u).next(d=>d?S.resolve():(p=>t.put({targetId:0,path:it(p),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>S.waitFor(s))})}ci(e,t){e.createObjectStore(Jo,{keyPath:nS});let i=t.store(Jo),r=new ua,s=o=>{if(r.add(o)){let a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:it(c)})}};return t.store(Gi).Z({Y:!0},(o,a)=>{let c=new se(o);return s(c.popLast())}).next(()=>t.store(Jr).Z({Y:!0},([o,a,c],u)=>{let d=tn(a);return s(d.popLast())}))}li(e){let t=e.store(Zr);return t.Z((i,r)=>{let s=qo(r),o=nE(this.serializer,s);return t.put(o)})}hi(e,t){let i=t.store(Gi),r=[];return i.Z((s,o)=>{let a=t.store(hc),c=function(p){return p.document?new B(se.fromString(p.document.name).popFirst(5)):p.noDocument?B.fromSegments(p.noDocument.path):p.unknownDocument?B.fromSegments(p.unknownDocument.path):U()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))}).next(()=>S.waitFor(r))}Pi(e,t){let i=t.store(Bt),r=uE(this.serializer),s=new da(Oc.ri,this.serializer.Tt);return i.G().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:J();zi(this.serializer,c).keys().forEach(p=>d=d.add(p)),a.set(c.userId,d)}),S.forEach(a,(c,u)=>{let d=new Me(u),p=Sc.It(this.serializer,d),m=s.getIndexManager(d),y=Nc.It(d,this.serializer,m,s.referenceDelegate);return new Vc(r,y,p,m).recalculateAndSaveOverlaysForDocumentKeys(new Zo(t,wt.ae),c).next()})})}};function Pw(n){n.createObjectStore(es,{keyPath:eS}).createIndex(zp,tS,{unique:!0}),n.createObjectStore(Zr,{keyPath:"targetId"}).createIndex(rT,Zb,{unique:!0}),n.createObjectStore(Xi)}var Zn="IndexedDbPersistence",xd=18e5,Nd=5e3,kd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",hE="main",Hf=class n{constructor(e,t,i,r,s,o,a,c,u,d,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Ti=s,this.window=o,this.document=a,this.Ii=u,this.Ei=d,this.di=p,this.Gr=null,this.zr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ai=null,this.inForeground=!1,this.Ri=null,this.Vi=null,this.mi=Number.NEGATIVE_INFINITY,this.fi=m=>Promise.resolve(),!n.D())throw new D(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Of(this,r),this.gi=t+hE,this.serializer=new Cc(c),this.pi=new oi(this.gi,this.di,new $f(this.serializer)),this.jr=new If,this.Hr=new kf(this.referenceDelegate,this.serializer),this.remoteDocumentCache=uE(this.serializer),this.Yr=new Ef,this.window&&this.window.localStorage?this.yi=this.window.localStorage:(this.yi=null,d===!1&&Re(Zn,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,kd);return this.bi(),this.Si(),this.Di(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Hr.getHighestSequenceNumber(e))}).then(e=>{this.Gr=new wt(e,this.Ii)}).then(()=>{this.zr=!0}).catch(e=>(this.pi&&this.pi.close(),Promise.reject(e)))}Ci(e){return this.fi=t=>N(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.pi.k(t=>N(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ti.enqueueAndForget(()=>N(this,null,function*(){this.started&&(yield this.wi())})))}wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ql(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Fi(e).next(t=>{t||(this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Mi(e)).next(t=>this.isPrimary&&!t?this.xi(e).next(()=>!1):!!t&&this.Oi(e).next(()=>!0))).catch(e=>{if(_i(e))return V(Zn,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V(Zn,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ti.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Fi(e){return Bo(e).get(Vr).next(t=>S.resolve(this.Ni(t)))}Bi(e){return Ql(e).delete(this.clientId)}Li(){return N(this,null,function*(){if(this.isPrimary&&!this.ki(this.mi,xd)){this.mi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let i=Ge(t,ts);return i.G().next(r=>{let s=this.qi(r,xd),o=r.filter(a=>s.indexOf(a)===-1);return S.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.yi)for(let t of e)this.yi.removeItem(this.Qi(t.clientId))}})}Di(){this.Vi=this.Ti.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.wi().then(()=>this.Li()).then(()=>this.Di()))}Ni(e){return!!e&&e.ownerId===this.clientId}Mi(e){return this.Ei?S.resolve(!0):Bo(e).get(Vr).next(t=>{if(t!==null&&this.ki(t.leaseTimestampMs,Nd)&&!this.$i(t.ownerId)){if(this.Ni(t)&&this.networkEnabled)return!0;if(!this.Ni(t)){if(!t.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,kd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ql(e).G().next(i=>this.qi(i,Nd).find(r=>{if(this.clientId!==r.clientId){let s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V(Zn,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return N(this,null,function*(){this.zr=!1,this.Ki(),this.Vi&&(this.Vi.cancel(),this.Vi=null),this.Ui(),this.Wi(),yield this.pi.runTransaction("shutdown","readwrite",[wa,ts],e=>{let t=new Zo(e,wt.ae);return this.xi(t).next(()=>this.Bi(t))}),this.pi.close(),this.Gi()})}qi(e,t){return e.filter(i=>this.ki(i.updateTimeMs,t)&&!this.$i(i.clientId))}zi(){return this.runTransaction("getActiveClients","readonly",e=>Ql(e).G().next(t=>this.qi(t,xd).map(i=>i.clientId)))}get started(){return this.zr}getGlobalsCache(){return this.jr}getMutationQueue(e,t){return Nc.It(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Nf(e,this.serializer.Tt.databaseId)}getDocumentOverlayCache(e){return Sc.It(this.serializer,e)}getBundleCache(){return this.Yr}runTransaction(e,t,i){V(Zn,"Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?yS:c===16?_S:c===15?Hp:c===14?uT:c===13?cT:c===12?gS:c===11?lT:void U()}(this.di),o;return this.pi.runTransaction(e,r,s,a=>(o=new Zo(a,this.Gr?this.Gr.next():wt.ae),t==="readwrite-primary"?this.Fi(o).next(c=>!!c||this.Mi(o)).next(c=>{if(!c)throw Re(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)),new D(R.FAILED_PRECONDITION,Zw);return i(o)}).next(c=>this.Oi(o).next(()=>c)):this.ji(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ji(e){return Bo(e).get(Vr).next(t=>{if(t!==null&&this.ki(t.leaseTimestampMs,Nd)&&!this.$i(t.ownerId)&&!this.Ni(t)&&!(this.Ei||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(R.FAILED_PRECONDITION,kd)})}Oi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Bo(e).put(Vr,t)}static D(){return oi.D()}xi(e){let t=Bo(e);return t.get(Vr).next(i=>this.Ni(i)?(V(Zn,"Releasing primary lease."),t.delete(Vr)):S.resolve())}ki(e,t){let i=Date.now();return!(e<i-t)&&(!(e>i)||(Re(`Detected an update time that is in the future: ${e} > ${i}`),!1))}bi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ri=()=>{this.Ti.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.wi()))},this.document.addEventListener("visibilitychange",this.Ri),this.inForeground=this.document.visibilityState==="visible")}Ui(){this.Ri&&(this.document.removeEventListener("visibilitychange",this.Ri),this.Ri=null)}Si(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ai=()=>{this.Ki();let t=/(?:Version|Mobile)\/1[456]/;rd()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Ti.enterRestrictedMode(!0),this.Ti.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ai))}Wi(){this.Ai&&(this.window.removeEventListener("pagehide",this.Ai),this.Ai=null)}$i(e){var t;try{let i=((t=this.yi)===null||t===void 0?void 0:t.getItem(this.Qi(e)))!==null;return V(Zn,`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Re(Zn,"Failed to get zombied client id.",i),!1}}Ki(){if(this.yi)try{this.yi.setItem(this.Qi(this.clientId),String(Date.now()))}catch(e){Re("Failed to set zombie client id.",e)}}Gi(){if(this.yi)try{this.yi.removeItem(this.Qi(this.clientId))}catch{}}Qi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Bo(n){return Ge(n,wa)}function Ql(n){return Ge(n,ts)}function rm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Qf=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Hi=i,this.Ji=r}static Yi(e,t){let i=J(),r=J();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(e,t.fromCache,i,r)}};var Yf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Mc=class{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return rd()?8:eT(To())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.rs(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ss(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Yf;return this._s(e,t,o).next(a=>{if(s.result=a,this.Xi)return this.us(e,t,o,a.size)})}).next(()=>s.result)}us(e,t,i,r){return i.documentReadCount<this.es?(Ur()<=Rt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",qr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),S.resolve()):(Ur()<=Rt.DEBUG&&V("QueryEngine","Query:",qr(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.ts*r?(Ur()<=Rt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",qr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,lt(t))):S.resolve())}rs(e,t){if(tw(t))return S.resolve(null);let i=lt(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Tc(t,null,"F"),i=lt(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=J(...s);return this.ns.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{let u=this.cs(t,a);return this.ls(t,u,o,c.readTime)?this.rs(e,Tc(t,null,"F")):this.hs(e,u,t,c)}))})))}ss(e,t,i,r){return tw(t)||r.isEqual(K.min())?S.resolve(null):this.ns.getDocuments(e,i).next(s=>{let o=this.cs(t,s);return this.ls(t,o,i,r)?S.resolve(null):(Ur()<=Rt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),qr(t)),this.hs(e,o,t,Xw(r,Yr)).next(a=>a))})}cs(e,t){let i=new he(PT(e));return t.forEach((r,s)=>{Ia(e,s)&&(i=i.add(s))}),i}ls(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}_s(e,t,i){return Ur()<=Rt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",qr(t)),this.ns.getDocumentsMatchingQuery(e,t,Pt.min(),i)}hs(e,t,i,r){return this.ns.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var sm="LocalStore",XS=3e8,Xf=class{constructor(e,t,i,r){this.persistence=e,this.Ps=t,this.serializer=r,this.Ts=new _e(H),this.Is=new jt(s=>er(s),Ta),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(i)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vc(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}};function dE(n,e,t,i){return new Xf(n,e,t,i)}function fE(n,e){return N(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.As(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],c=J();for(let u of r){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({Rs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function JS(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.ds.newChangeBuffer({trackRemovals:!0});return function(a,c,u,d){let p=u.batch,m=p.keys(),y=S.resolve();return m.forEach(C=>{y=y.next(()=>d.getEntry(c,C)).next(P=>{let k=u.docVersions.get(C);G(k!==null),P.version.compareTo(k)<0&&(p.applyToRemoteDocument(P,u),P.isValidDocument()&&(P.setReadTime(u.commitVersion),d.addEntry(P)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,p))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=J();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function pE(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function ZS(n,e){let t=L(n),i=e.snapshotVersion,r=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.ds.newChangeBuffer({trackRemovals:!0});r=t.Ts;let a=[];e.targetChanges.forEach((d,p)=>{let m=r.get(p);if(!m)return;a.push(t.Hr.removeMatchingKeys(s,d.removedDocuments,p).next(()=>t.Hr.addMatchingKeys(s,d.addedDocuments,p)));let y=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?y=y.withResumeToken(Ne.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,i)),r=r.insert(p,y),function(P,k,q){return P.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=XS?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(m,y,d)&&a.push(t.Hr.updateTargetData(s,y))});let c=mt(),u=J();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(mE(s,o,e.documentUpdates).next(d=>{c=d.Vs,u=d.fs})),!i.isEqual(K.min())){let d=t.Hr.getLastRemoteSnapshotVersion(s).next(p=>t.Hr.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(d)}return S.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.Ts=r,s))}function mE(n,e,t){let i=J(),r=J();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=mt();return t.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(K.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):V(sm,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Vs:o,fs:r}})}function eR(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=ii),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function us(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Hr.getTargetData(i,e).next(s=>s?(r=s,S.resolve(r)):t.Hr.allocateTargetId(i).next(o=>(r=new ls(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.Hr.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.Ts.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(i.targetId,i),t.Is.set(e,i.targetId)),i})}function hs(n,e,t){return N(this,null,function*(){let i=L(n),r=i.Ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!_i(o))throw o;V(sm,`Failed to update sequence numbers for target ${e}: ${o}`)}i.Ts=i.Ts.remove(e),i.Is.delete(r.target)})}function Lc(n,e,t){let i=L(n),r=K.min(),s=J();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,d){let p=L(c),m=p.Is.get(d);return m!==void 0?S.resolve(p.Ts.get(m)):p.Hr.getTargetData(u,d)}(i,o,lt(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Hr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.Ps.getDocumentsMatchingQuery(o,e,t?r:K.min(),t?s:J())).next(a=>(yE(i,RT(e),a),{documents:a,gs:s})))}function gE(n,e){let t=L(n),i=L(t.Hr),r=t.Ts.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.lt(s,e).next(o=>o?o.target:null))}function _E(n,e){let t=L(n),i=t.Es.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.ds.getAllFromCollectionGroup(r,e,Xw(i,Yr),Number.MAX_SAFE_INTEGER)).then(r=>(yE(t,e,r),r))}function yE(n,e,t){let i=n.Es.get(e)||K.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Es.set(e,i)}function tR(n,e,t,i){return N(this,null,function*(){let r=L(n),s=J(),o=mt();for(let u of t){let d=e.ps(u.metadata.name);u.document&&(s=s.add(d));let p=e.ys(u);p.setReadTime(e.ws(u.metadata.readTime)),o=o.insert(d,p)}let a=r.ds.newChangeBuffer({trackRemovals:!0}),c=yield us(r,function(d){return lt(vs(se.fromString(`__bundle__/docs/${d}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",u=>mE(u,a,o).next(d=>(a.apply(u),d)).next(d=>r.Hr.removeMatchingKeysForTargetId(u,c.targetId).next(()=>r.Hr.addMatchingKeys(u,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(u,d.Vs,d.fs)).next(()=>d.Vs)))})}function nR(i,r){return N(this,arguments,function*(n,e,t=J()){let s=yield us(n,lt(nm(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=xe(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Yr.saveNamedQuery(a,e);let u=s.withResumeToken(Ne.EMPTY_BYTE_STRING,c);return o.Ts=o.Ts.insert(u.targetId,u),o.Hr.updateTargetData(a,u).next(()=>o.Hr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Hr.addMatchingKeys(a,t,s.targetId)).next(()=>o.Yr.saveNamedQuery(a,e))})})}var vE="firestore_clients";function xw(n,e){return`${vE}_${n}_${e}`}var wE="firestore_mutations";function Nw(n,e,t){let i=`${wE}_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}var TE="firestore_targets";function Dd(n,e){return`${TE}_${n}_${e}`}var en="SharedClientState",Bc=class n{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static bs(e,t,i){let r=JSON.parse(i),s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new D(r.error.code,r.error.message))),o?new n(e,t,r.state,s):(Re(en,`Failed to parse mutation state for ID '${t}': ${i}`),null)}Ss(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Wo=class n{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static bs(e,t){let i=JSON.parse(t),r,s=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(r=new D(i.error.code,i.error.message))),s?new n(e,i.state,r):(Re(en,`Failed to parse target state for ID '${e}': ${t}`),null)}Ss(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Uc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static bs(e,t){let i=JSON.parse(t),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=Zp();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=tT(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(e,s):(Re(en,`Failed to parse client data for instance '${e}': ${t}`),null)}},Jf=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static bs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Re(en,`Failed to parse online state: ${e}`),null)}},fa=class{constructor(){this.activeTargetIds=Zp()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},$o=class{constructor(e,t,i,r,s){this.window=e,this.Ti=t,this.persistenceKey=i,this.Cs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Fs=this.Ms.bind(this),this.xs=new _e(H),this.started=!1,this.Os=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ns=xw(this.persistenceKey,this.Cs),this.Bs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.xs=this.xs.insert(this.Cs,new fa),this.Ls=new RegExp(`^${vE}_${o}_([^_]*)$`),this.ks=new RegExp(`^${wE}_${o}_(\\d+)(?:_(.*))?$`),this.qs=new RegExp(`^${TE}_${o}_(\\d+)$`),this.Qs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.$s=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Fs)}static D(e){return!(!e||!e.localStorage)}start(){return N(this,null,function*(){let e=yield this.syncEngine.zi();for(let i of e){if(i===this.Cs)continue;let r=this.getItem(xw(this.persistenceKey,i));if(r){let s=Uc.bs(i,r);s&&(this.xs=this.xs.insert(s.clientId,s))}}this.Ks();let t=this.storage.getItem(this.Qs);if(t){let i=this.Us(t);i&&this.Ws(i)}for(let i of this.Os)this.Ms(i);this.Os=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Bs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Gs(this.xs)}isActiveQueryTarget(e){let t=!1;return this.xs.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.zs(e,"pending")}updateMutationState(e,t,i){this.zs(e,t,i),this.js(e)}addLocalQueryTarget(e,t=!0){let i="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(Dd(this.persistenceKey,e));if(r){let s=Wo.bs(e,r);s&&(i=s.state)}}return t&&this.Hs.Ds(e),this.Ks(),i}removeLocalQueryTarget(e){this.Hs.vs(e),this.Ks()}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Dd(this.persistenceKey,e))}updateQueryState(e,t,i){this.Js(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.js(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Ys(e)}notifyBundleLoaded(e){this.Zs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Fs),this.removeItem(this.Ns),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V(en,"READ",e,t),t}setItem(e,t){V(en,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){V(en,"REMOVE",e),this.storage.removeItem(e)}Ms(e){let t=e;if(t.storageArea===this.storage){if(V(en,"EVENT",t.key,t.newValue),t.key===this.Ns)return void Re("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ti.enqueueRetryable(()=>N(this,null,function*(){if(this.started){if(t.key!==null){if(this.Ls.test(t.key)){if(t.newValue==null){let i=this.Xs(t.key);return this.eo(i,null)}{let i=this.no(t.key,t.newValue);if(i)return this.eo(i.clientId,i)}}else if(this.ks.test(t.key)){if(t.newValue!==null){let i=this.ro(t.key,t.newValue);if(i)return this.io(i)}}else if(this.qs.test(t.key)){if(t.newValue!==null){let i=this.so(t.key,t.newValue);if(i)return this.oo(i)}}else if(t.key===this.Qs){if(t.newValue!==null){let i=this.Us(t.newValue);if(i)return this.Ws(i)}}else if(t.key===this.Bs){let i=function(s){let o=wt.ae;if(s!=null)try{let a=JSON.parse(s);G(typeof a=="number"),o=a}catch(a){Re(en,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);i!==wt.ae&&this.sequenceNumberHandler(i)}else if(t.key===this.$s){let i=this._o(t.newValue);yield Promise.all(i.map(r=>this.syncEngine.ao(r)))}}}else this.Os.push(t)}))}}get Hs(){return this.xs.get(this.Cs)}Ks(){this.setItem(this.Ns,this.Hs.Ss())}zs(e,t,i){let r=new Bc(this.currentUser,e,t,i),s=Nw(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Ss())}js(e){let t=Nw(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ys(e){let t={clientId:this.Cs,onlineState:e};this.storage.setItem(this.Qs,JSON.stringify(t))}Js(e,t,i){let r=Dd(this.persistenceKey,e),s=new Wo(e,t,i);this.setItem(r,s.Ss())}Zs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.$s,t)}Xs(e){let t=this.Ls.exec(e);return t?t[1]:null}no(e,t){let i=this.Xs(e);return Uc.bs(i,t)}ro(e,t){let i=this.ks.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return Bc.bs(new Me(s),r,t)}so(e,t){let i=this.qs.exec(e),r=Number(i[1]);return Wo.bs(r,t)}Us(e){return Jf.bs(e)}_o(e){return JSON.parse(e)}io(e){return N(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.uo(e.batchId,e.state,e.error);V(en,`Ignoring mutation for non-active user ${e.user.uid}`)})}oo(e){return this.syncEngine.co(e.targetId,e.state,e.error)}eo(e,t){let i=t?this.xs.insert(e,t):this.xs.remove(e),r=this.Gs(this.xs),s=this.Gs(i),o=[],a=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.lo(o,a).then(()=>{this.xs=i})}Ws(e){this.xs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Gs(e){let t=Zp();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}},qc=class{constructor(){this.ho=new fa,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,i){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new fa,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Zf=class{To(e){}shutdown(){}};var kw="ConnectivityMonitor",jc=class{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){V(kw,"Network connectivity changed: AVAILABLE");for(let e of this.Vo)e(0)}Ro(){V(kw,"Network connectivity changed: UNAVAILABLE");for(let e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Yl=null;function ep(){return Yl===null?Yl=function(){return 268435456+Math.round(2147483648*Math.random())}():Yl++,"0x"+Yl.toString(16)}var Vd="RestConnection",iR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},tp=class{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${i}/databases/${r}`,this.wo=this.databaseId.database===Xd?`project_id=${i}`:`project_id=${i}&database_id=${r}`}bo(e,t,i,r,s){let o=ep(),a=this.So(e,t.toUriEncodedString());V(Vd,`Sending RPC '${e}' ${o}:`,a,i);let c={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(c,r,s),this.vo(e,a,c,i).then(u=>(V(Vd,`Received RPC '${e}' ${o}: `,u),u),u=>{throw Ut(Vd,`RPC '${e}' ${o} failed with error: `,u,"url: ",a,"request:",i),u})}Co(e,t,i,r,s,o){return this.bo(e,t,i,r,s)}Do(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ys}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}So(e,t){let i=iR[e];return`${this.po}/v1/${t}:${i}`}terminate(){}};var np=class{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}};var tt="WebChannelConnection",ip=class extends tp{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,i,r){let s=ep();return new Promise((o,a)=>{let c=new Ad;c.setWithCredentials(!0),c.listenOnce(Cd.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Oo.NO_ERROR:let d=c.getResponseJson();V(tt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case Oo.TIMEOUT:V(tt,`RPC '${e}' ${s} timed out`),a(new D(R.DEADLINE_EXCEEDED,"Request time out"));break;case Oo.HTTP_ERROR:let p=c.getStatus();if(V(tt,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);let y=m?.error;if(y&&y.status&&y.message){let C=function(k){let q=k.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(q)>=0?q:R.UNKNOWN}(y.status);a(new D(C,y.message))}else a(new D(R.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new D(R.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{V(tt,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(r);V(tt,`RPC '${e}' ${s} sending request:`,r),c.send(t,"POST",u,i,15)})}Wo(e,t,i){let r=ep(),s=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Rd(),a=Sd(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,t,i),c.encodeInitMessageHeaders=!0;let d=s.join("");V(tt,`Creating RPC '${e}' stream ${r}: ${d}`,c);let p=o.createWebChannel(d,c),m=!1,y=!1,C=new np({Fo:k=>{y?V(tt,`Not sending because RPC '${e}' stream ${r} is closed:`,k):(m||(V(tt,`Opening RPC '${e}' stream ${r} transport.`),p.open(),m=!0),V(tt,`RPC '${e}' stream ${r} sending:`,k),p.send(k))},Mo:()=>p.close()}),P=(k,q,j)=>{k.listen(q,F=>{try{j(F)}catch(W){setTimeout(()=>{throw W},0)}})};return P(p,Dr.EventType.OPEN,()=>{y||(V(tt,`RPC '${e}' stream ${r} transport opened.`),C.Qo())}),P(p,Dr.EventType.CLOSE,()=>{y||(y=!0,V(tt,`RPC '${e}' stream ${r} transport closed`),C.Ko())}),P(p,Dr.EventType.ERROR,k=>{y||(y=!0,Ut(tt,`RPC '${e}' stream ${r} transport errored:`,k),C.Ko(new D(R.UNAVAILABLE,"The operation could not be completed")))}),P(p,Dr.EventType.MESSAGE,k=>{var q;if(!y){let j=k.data[0];G(!!j);let F=j,W=F?.error||((q=F[0])===null||q===void 0?void 0:q.error);if(W){V(tt,`RPC '${e}' stream ${r} received error:`,W);let Q=W.status,Y=function(w){let E=Oe[w];if(E!==void 0)return jT(E)}(Q),T=W.message;Y===void 0&&(Y=R.INTERNAL,T="Unknown error status: "+Q+" with message "+W.message),y=!0,C.Ko(new D(Y,T)),p.close()}else V(tt,`RPC '${e}' stream ${r} received:`,j),C.Uo(j)}}),P(a,bd.STAT_EVENT,k=>{k.stat===zl.PROXY?V(tt,`RPC '${e}' stream ${r} detected buffering proxy`):k.stat===zl.NOPROXY&&V(tt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{C.$o()},0),C}};function EE(){return typeof window<"u"?window:null}function ic(){return typeof document<"u"?document:null}function Aa(n){return new _f(n,!0)}var pa=class{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Ti=e,this.timerId=t,this.Go=i,this.zo=r,this.jo=s,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();let t=Math.floor(this.Ho+this.e_()),i=Math.max(0,Date.now()-this.Yo),r=Math.max(0,t-i);r>0&&V("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,r,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}};var Dw="PersistentStream",Gc=class{constructor(e,t,i,r,s,o,a,c){this.Ti=e,this.n_=i,this.r_=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new pa(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}stop(){return N(this,null,function*(){this.u_()&&(yield this.close(0))})}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}T_(){return N(this,null,function*(){if(this.c_())return this.close(0)})}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}close(e,t){return N(this,null,function*(){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Re(t.toString()),Re("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Lo(t)})}A_(){}auth(){this.state=1;let e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.i_===t&&this.V_(i,r)},i=>{e(()=>{let r=new D(R.UNKNOWN,"Fetching auth token failed: "+i.message);return this.m_(r)})})}V_(e,t){let i=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{i(()=>this.listener.xo())}),this.stream.No(()=>{i(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(r=>{i(()=>this.m_(r))}),this.stream.onMessage(r=>{i(()=>++this.__==1?this.g_(r):this.onNext(r))})}l_(){this.state=5,this.a_.Xo(()=>N(this,null,function*(){this.state=0,this.start()}))}m_(e){return V(Dw,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(V(Dw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},rp=class extends Gc{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();let t=US(this.serializer,e),i=function(s){if(!("targetChange"in s))return K.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?K.min():o.readTime?xe(o.readTime):K.min()}(e);return this.listener.p_(t,i)}y_(e){let t={};t.database=wf(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=vc(c)?{documents:YT(s,c)}:{query:XT(s,c).ht},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=KT(s,o.resumeToken);let u=yf(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(K.min())>0){a.readTime=as(s,o.snapshotVersion.toTimestamp());let u=yf(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let i=jS(this.serializer,e);i&&(t.labels=i),this.I_(t)}w_(e){let t={};t.database=wf(this.serializer),t.removeTarget=e,this.I_(t)}},sp=class extends Gc{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();let t=qS(e.writeResults,e.commitTime),i=xe(e.commitTime);return this.listener.v_(i,t)}C_(){let e={};e.database=wf(this.serializer),this.I_(e)}S_(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>ca(this.serializer,i))};this.I_(t)}};var op=class{},ap=class extends op{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.F_=!1}M_(){if(this.F_)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,t,i,r){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.bo(e,vf(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(R.UNKNOWN,s.toString())})}Co(e,t,i,r,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Co(e,vf(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(R.UNKNOWN,o.toString())})}terminate(){this.F_=!0,this.connection.terminate()}},lp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Re(t),this.N_=!1):V("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}};var rr="RemoteStore",cp=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=s,this.z_.To(o=>{i.enqueueAndForget(()=>N(this,null,function*(){vi(this)&&(V(rr,"Restarting streams for network reachability change."),yield function(c){return N(this,null,function*(){let u=L(c);u.W_.add(4),yield ws(u),u.j_.set("Unknown"),u.W_.delete(4),yield Ca(u)})}(this))}))}),this.j_=new lp(i,r)}};function Ca(n){return N(this,null,function*(){if(vi(n))for(let e of n.G_)yield e(!0)})}function ws(n){return N(this,null,function*(){for(let e of n.G_)yield e(!1)})}function pu(n,e){let t=L(n);t.U_.has(e.targetId)||(t.U_.set(e.targetId,e),lm(t)?am(t):Es(t).c_()&&om(t,e))}function ds(n,e){let t=L(n),i=Es(t);t.U_.delete(e),i.c_()&&IE(t,e),t.U_.size===0&&(i.c_()?i.P_():vi(t)&&t.j_.set("Unknown"))}function om(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Es(n).y_(e)}function IE(n,e){n.H_.Ne(e),Es(n).w_(e)}function am(n){n.H_=new gf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.U_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),Es(n).start(),n.j_.B_()}function lm(n){return vi(n)&&!Es(n).u_()&&n.U_.size>0}function vi(n){return L(n).W_.size===0}function AE(n){n.H_=void 0}function rR(n){return N(this,null,function*(){n.j_.set("Online")})}function sR(n){return N(this,null,function*(){n.U_.forEach((e,t)=>{om(n,e)})})}function oR(n,e){return N(this,null,function*(){AE(n),lm(n)?(n.j_.q_(e),am(n)):n.j_.set("Unknown")})}function aR(n,e,t){return N(this,null,function*(){if(n.j_.set("Online"),e instanceof Ic&&e.state===2&&e.cause)try{yield function(r,s){return N(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.U_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.U_.delete(a),r.H_.removeTarget(a))})}(n,e)}catch(i){V(rr,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield Kc(n,i)}else if(e instanceof Hr?n.H_.We(e):e instanceof Ec?n.H_.Ze(e):n.H_.je(e),!t.isEqual(K.min()))try{let i=yield pE(n.localStore);t.compareTo(i)>=0&&(yield function(s,o){let a=s.H_.ot(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=s.U_.get(u);d&&s.U_.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=s.U_.get(c);if(!d)return;s.U_.set(c,d.withResumeToken(Ne.EMPTY_BYTE_STRING,d.snapshotVersion)),IE(s,c);let p=new ls(d.target,c,u,d.sequenceNumber);om(s,p)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(i){V(rr,"Failed to raise snapshot:",i),yield Kc(n,i)}})}function Kc(n,e,t){return N(this,null,function*(){if(!_i(e))throw e;n.W_.add(1),yield ws(n),n.j_.set("Offline"),t||(t=()=>pE(n.localStore)),n.asyncQueue.enqueueRetryable(()=>N(this,null,function*(){V(rr,"Retrying IndexedDB access"),yield t(),n.W_.delete(1),yield Ca(n)}))})}function CE(n,e){return e().catch(t=>Kc(n,t,e))}function Ts(n){return N(this,null,function*(){let e=L(n),t=pi(e),i=e.K_.length>0?e.K_[e.K_.length-1].batchId:ii;for(;lR(e);)try{let r=yield eR(e.localStore,i);if(r===null){e.K_.length===0&&t.P_();break}i=r.batchId,cR(e,r)}catch(r){yield Kc(e,r)}bE(e)&&SE(e)})}function lR(n){return vi(n)&&n.K_.length<10}function cR(n,e){n.K_.push(e);let t=pi(n);t.c_()&&t.b_&&t.S_(e.mutations)}function bE(n){return vi(n)&&!pi(n).u_()&&n.K_.length>0}function SE(n){pi(n).start()}function uR(n){return N(this,null,function*(){pi(n).C_()})}function hR(n){return N(this,null,function*(){let e=pi(n);for(let t of n.K_)e.S_(t.mutations)})}function dR(n,e,t){return N(this,null,function*(){let i=n.K_.shift(),r=ff.from(i,e,t);yield CE(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Ts(n)})}function fR(n,e){return N(this,null,function*(){e&&pi(n).b_&&(yield function(i,r){return N(this,null,function*(){if(function(o){return qT(o)&&o!==R.ABORTED}(r.code)){let s=i.K_.shift();pi(i).h_(),yield CE(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield Ts(i)}})}(n,e)),bE(n)&&SE(n)})}function Vw(n,e){return N(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),V(rr,"RemoteStore received new credentials");let i=vi(t);t.W_.add(3),yield ws(t),i&&t.j_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),yield Ca(t)})}function up(n,e){return N(this,null,function*(){let t=L(n);e?(t.W_.delete(2),yield Ca(t)):e||(t.W_.add(2),yield ws(t),t.j_.set("Unknown"))})}function Es(n){return n.J_||(n.J_=function(t,i,r){let s=L(t);return s.M_(),new rp(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{xo:rR.bind(null,n),No:sR.bind(null,n),Lo:oR.bind(null,n),p_:aR.bind(null,n)}),n.G_.push(e=>N(this,null,function*(){e?(n.J_.h_(),lm(n)?am(n):n.j_.set("Unknown")):(yield n.J_.stop(),AE(n))}))),n.J_}function pi(n){return n.Y_||(n.Y_=function(t,i,r){let s=L(t);return s.M_(),new sp(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:uR.bind(null,n),Lo:fR.bind(null,n),D_:hR.bind(null,n),v_:dR.bind(null,n)}),n.G_.push(e=>N(this,null,function*(){e?(n.Y_.h_(),yield Ts(n)):(yield n.Y_.stop(),n.K_.length>0&&(V(rr,`Stopping write stream with ${n.K_.length} pending writes`),n.K_=[]))}))),n.Y_}var hp=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Is(n,e){if(Re("AsyncQueue",`${e}: ${n}`),_i(n))return new D(R.UNAVAILABLE,`${e}: ${n}`);throw n}var zc=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||B.comparator(t.key,i.key):(t,i)=>B.comparator(t.key,i.key),this.keyedMap=Uo(),this.sortedSet=new _e(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var Wc=class{constructor(){this.Z_=new _e(B.comparator)}track(e){let t=e.doc.key,i=this.Z_.get(t);i?e.type!==0&&i.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&i.type!==1?this.Z_=this.Z_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.Z_=this.Z_.remove(t):e.type===1&&i.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):U():this.Z_=this.Z_.insert(t,e)}X_(){let e=[];return this.Z_.inorderTraversal((t,i)=>{e.push(i)}),e}},fs=class n{constructor(e,t,i,r,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,zc.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ea(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var dp=class{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}},fp=class{constructor(){this.queries=Ow(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,i){let r=L(t),s=r.queries;r.queries=Ow(),s.forEach((o,a)=>{for(let c of a.ta)c.onError(i)})})(this,new D(R.ABORTED,"Firestore shutting down"))}};function Ow(){return new jt(n=>ST(n),Ea)}function cm(n,e){return N(this,null,function*(){let t=L(n),i=3,r=e.query,s=t.queries.get(r);s?!s.na()&&e.ra()&&(i=2):(s=new dp,i=e.ra()?0:1);try{switch(i){case 0:s.ea=yield t.onListen(r,!0);break;case 1:s.ea=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let a=Is(o,`Initialization of query '${qr(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.ta.push(e),e.sa(t.onlineState),s.ea&&e.oa(s.ea)&&hm(t)})}function um(n,e){return N(this,null,function*(){let t=L(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.ta.indexOf(e);o>=0&&(s.ta.splice(o,1),s.ta.length===0?r=e.ra()?0:1:!s.na()&&e.ra()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function pR(n,e){let t=L(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.ta)a.oa(r)&&(i=!0);o.ea=r}}i&&hm(t)}function mR(n,e,t){let i=L(n),r=i.queries.get(e);if(r)for(let s of r.ta)s.onError(t);i.queries.delete(e)}function hm(n){n.ia.forEach(e=>{e.next()})}var pp,Fw;(Fw=pp||(pp={}))._a="default",Fw.Cache="cache";var ma=class{constructor(e,t,i){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=i||{}}oa(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new fs(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;let i=t!=="Offline";return(!this.options.Ta||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;let t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=fs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==pp.Cache}};var mp=class{constructor(e,t){this.Ia=e,this.byteLength=t}Ea(){return"metadata"in this.Ia}};var $c=class{constructor(e){this.serializer=e}ps(e){return sn(this.serializer,e)}ys(e){return e.metadata.exists?QT(this.serializer,e.document,!1):Le.newNoDocument(this.ps(e.metadata.name),this.ws(e.metadata.readTime))}ws(e){return xe(e)}},gp=class{constructor(e,t,i){this.da=e,this.localStore=t,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=RE(e)}Aa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Ia.namedQuery)this.queries.push(e.Ia.namedQuery);else if(e.Ia.documentMetadata){this.documents.push({metadata:e.Ia.documentMetadata}),e.Ia.documentMetadata.exists||++t;let i=se.fromString(e.Ia.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.Ia.document&&(this.documents[this.documents.length-1].document=e.Ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ra(e){let t=new Map,i=new $c(this.serializer);for(let r of e)if(r.metadata.queries){let s=i.ps(r.metadata.name);for(let o of r.metadata.queries){let a=(t.get(o)||J()).add(s);t.set(o,a)}}return t}complete(){return N(this,null,function*(){let e=yield tR(this.localStore,new $c(this.serializer),this.documents,this.da.id),t=this.Ra(this.documents);for(let i of this.queries)yield nR(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Va:this.collectionGroups,ma:e}})}};function RE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Hc=class{constructor(e){this.key=e}},Qc=class{constructor(e){this.key=e}},Yc=class{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=J(),this.mutatedKeys=J(),this.ya=PT(e),this.wa=new zc(this.ya)}get ba(){return this.fa}Sa(e,t){let i=t?t.Da:new Wc,r=t?t.wa:this.wa,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,p)=>{let m=r.get(d),y=Ia(this.query,p)?p:null,C=!!m&&this.mutatedKeys.has(m.key),P=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),k=!1;m&&y?m.data.isEqual(y.data)?C!==P&&(i.track({type:3,doc:y}),k=!0):this.va(m,y)||(i.track({type:2,doc:y}),k=!0,(c&&this.ya(y,c)>0||u&&this.ya(y,u)<0)&&(a=!0)):!m&&y?(i.track({type:0,doc:y}),k=!0):m&&!y&&(i.track({type:1,doc:m}),k=!0,(c||u)&&(a=!0)),k&&(y?(o=o.add(y),s=P?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),i.track({type:1,doc:d})}return{wa:o,Da:i,ls:a,mutatedKeys:s}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;let o=e.Da.X_();o.sort((d,p)=>function(y,C){let P=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return P(y)-P(C)}(d.type,p.type)||this.ya(d.doc,p.doc)),this.Ca(i),r=r!=null&&r;let a=t&&!r?this.Fa():[],c=this.pa.size===0&&this.current&&!r?1:0,u=c!==this.ga;return this.ga=c,o.length!==0||u?{snapshot:new fs(this.query,e.wa,s,o,e.mutatedKeys,c===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),Ma:a}:{Ma:a}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Wc,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];let e=this.pa;this.pa=J(),this.wa.forEach(i=>{this.xa(i.key)&&(this.pa=this.pa.add(i.key))});let t=[];return e.forEach(i=>{this.pa.has(i)||t.push(new Qc(i))}),this.pa.forEach(i=>{e.has(i)||t.push(new Hc(i))}),t}Oa(e){this.fa=e.gs,this.pa=J();let t=this.Sa(e.documents);return this.applyChanges(t,!0)}Na(){return fs.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}},wi="SyncEngine",_p=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},yp=class{constructor(e){this.key=e,this.Ba=!1}},vp=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new jt(a=>ST(a),Ea),this.qa=new Map,this.Qa=new Set,this.$a=new _e(B.comparator),this.Ka=new Map,this.Ua=new ha,this.Wa={},this.Ga=new Map,this.za=cs.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}};function gR(n,e,t=!0){return N(this,null,function*(){let i=mu(n),r,s=i.ka.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Na()):r=yield PE(i,e,t,!0),r})}function _R(n,e){return N(this,null,function*(){let t=mu(n);yield PE(t,e,!0,!1)})}function PE(n,e,t,i){return N(this,null,function*(){let r=yield us(n.localStore,lt(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return i&&(a=yield dm(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&pu(n.remoteStore,r),a})}function dm(n,e,t,i,r){return N(this,null,function*(){n.Ha=(p,m,y)=>function(P,k,q,j){return N(this,null,function*(){let F=k.view.Sa(q);F.ls&&(F=yield Lc(P.localStore,k.query,!1).then(({documents:T})=>k.view.Sa(T,F)));let W=j&&j.targetChanges.get(k.targetId),Q=j&&j.targetMismatches.get(k.targetId)!=null,Y=k.view.applyChanges(F,P.isPrimaryClient,W,Q);return wp(P,k.targetId,Y.Ma),Y.snapshot})}(n,p,m,y);let s=yield Lc(n.localStore,e,!0),o=new Yc(e,s.gs),a=o.Sa(s.documents),c=aa.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,c);wp(n,t,u.Ma);let d=new _p(e,t,o);return n.ka.set(e,d),n.qa.has(t)?n.qa.get(t).push(e):n.qa.set(t,[e]),u.snapshot})}function yR(n,e,t){return N(this,null,function*(){let i=L(n),r=i.ka.get(e),s=i.qa.get(r.targetId);if(s.length>1)return i.qa.set(r.targetId,s.filter(o=>!Ea(o,e))),void i.ka.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield hs(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&ds(i.remoteStore,r.targetId),ps(i,r.targetId)}).catch(gi))):(ps(i,r.targetId),yield hs(i.localStore,r.targetId,!0))})}function vR(n,e){return N(this,null,function*(){let t=L(n),i=t.ka.get(e),r=t.qa.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),ds(t.remoteStore,i.targetId))})}function wR(n,e,t){return N(this,null,function*(){let i=gm(n);try{let r=yield function(o,a){let c=L(o),u=we.now(),d=a.reduce((y,C)=>y.add(C.key),J()),p,m;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let C=mt(),P=J();return c.ds.getEntries(y,d).next(k=>{C=k,C.forEach((q,j)=>{j.isValidDocument()||(P=P.add(q))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,C)).next(k=>{p=k;let q=[];for(let j of a){let F=DS(j,p.get(j.key).overlayedDocument);F!=null&&q.push(new Gt(j.key,F,wT(F.value.mapValue),Ce.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,q,a)}).next(k=>{m=k;let q=k.applyToLocalDocumentSet(p,P);return c.documentOverlayCache.saveOverlays(y,k.batchId,q)})}).then(()=>({batchId:m.batchId,changes:NT(p)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,c){let u=o.Wa[o.currentUser.toKey()];u||(u=new _e(H)),u=u.insert(a,c),o.Wa[o.currentUser.toKey()]=u}(i,r.batchId,t),yield Vn(i,r.changes),yield Ts(i.remoteStore)}catch(r){let s=Is(r,"Failed to persist write");t.reject(s)}})}function xE(n,e){return N(this,null,function*(){let t=L(n);try{let i=yield ZS(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.Ka.get(s);o&&(G(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.Ba=!0:r.modifiedDocuments.size>0?G(o.Ba):r.removedDocuments.size>0&&(G(o.Ba),o.Ba=!1))}),yield Vn(t,i,e)}catch(i){yield gi(i)}})}function Mw(n,e,t){let i=L(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.ka.forEach((s,o)=>{let a=o.view.sa(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){let c=L(o);c.onlineState=a;let u=!1;c.queries.forEach((d,p)=>{for(let m of p.ta)m.sa(a)&&(u=!0)}),u&&hm(c)}(i.eventManager,e),r.length&&i.La.p_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function TR(n,e,t){return N(this,null,function*(){let i=L(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.Ka.get(e),s=r&&r.key;if(s){let o=new _e(B.comparator);o=o.insert(s,Le.newNoDocument(s,K.min()));let a=J().add(s),c=new oa(K.min(),new Map,new _e(H),o,a);yield xE(i,c),i.$a=i.$a.remove(s),i.Ka.delete(e),mm(i)}else yield hs(i.localStore,e,!1).then(()=>ps(i,e,t)).catch(gi)})}function ER(n,e){return N(this,null,function*(){let t=L(n),i=e.batch.batchId;try{let r=yield JS(t.localStore,e);pm(t,i,null),fm(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Vn(t,r)}catch(r){yield gi(r)}})}function IR(n,e,t){return N(this,null,function*(){let i=L(n);try{let r=yield function(o,a){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(p=>(G(p!==null),d=p.keys(),c.mutationQueue.removeMutationBatch(u,p))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(i.localStore,e);pm(i,e,t),fm(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Vn(i,r)}catch(r){yield gi(r)}})}function AR(n,e){return N(this,null,function*(){let t=L(n);vi(t.remoteStore)||V(wi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield function(o){let a=L(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(i===ii)return void e.resolve();let r=t.Ga.get(i)||[];r.push(e),t.Ga.set(i,r)}catch(i){let r=Is(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function fm(n,e){(n.Ga.get(e)||[]).forEach(t=>{t.resolve()}),n.Ga.delete(e)}function pm(n,e,t){let i=L(n),r=i.Wa[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.Wa[i.currentUser.toKey()]=r}}function ps(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.qa.get(e))n.ka.delete(i),t&&n.La.Ja(i,t);n.qa.delete(e),n.isPrimaryClient&&n.Ua.Sr(e).forEach(i=>{n.Ua.containsKey(i)||NE(n,i)})}function NE(n,e){n.Qa.delete(e.path.canonicalString());let t=n.$a.get(e);t!==null&&(ds(n.remoteStore,t),n.$a=n.$a.remove(e),n.Ka.delete(t),mm(n))}function wp(n,e,t){for(let i of t)i instanceof Hc?(n.Ua.addReference(i.key,e),CR(n,i)):i instanceof Qc?(V(wi,"Document no longer in limbo: "+i.key),n.Ua.removeReference(i.key,e),n.Ua.containsKey(i.key)||NE(n,i.key)):U()}function CR(n,e){let t=e.key,i=t.path.canonicalString();n.$a.get(t)||n.Qa.has(i)||(V(wi,"New document in limbo: "+t),n.Qa.add(i),mm(n))}function mm(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){let e=n.Qa.values().next().value;n.Qa.delete(e);let t=new B(se.fromString(e)),i=n.za.next();n.Ka.set(i,new yp(t)),n.$a=n.$a.insert(t,i),pu(n.remoteStore,new ls(lt(vs(t.path)),i,"TargetPurposeLimboResolution",wt.ae))}}function Vn(n,e,t){return N(this,null,function*(){let i=L(n),r=[],s=[],o=[];i.ka.isEmpty()||(i.ka.forEach((a,c)=>{o.push(i.Ha(c,e,t).then(u=>{var d;if((u||t)&&i.isPrimaryClient){let p=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;i.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(u){r.push(u);let p=Qf.Yi(c.targetId,u);s.push(p)}}))}),yield Promise.all(o),i.La.p_(r),yield function(c,u){return N(this,null,function*(){let d=L(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>S.forEach(u,m=>S.forEach(m.Hi,y=>d.persistence.referenceDelegate.addReference(p,m.targetId,y)).next(()=>S.forEach(m.Ji,y=>d.persistence.referenceDelegate.removeReference(p,m.targetId,y)))))}catch(p){if(!_i(p))throw p;V(sm,"Failed to update sequence numbers: "+p)}for(let p of u){let m=p.targetId;if(!p.fromCache){let y=d.Ts.get(m),C=y.snapshotVersion,P=y.withLastLimboFreeSnapshotVersion(C);d.Ts=d.Ts.insert(m,P)}}})}(i.localStore,s))})}function bR(n,e){return N(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){V(wi,"User change. New user:",e.toKey());let i=yield fE(t.localStore,e);t.currentUser=e,function(s,o){s.Ga.forEach(a=>{a.forEach(c=>{c.reject(new D(R.CANCELLED,o))})}),s.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Vn(t,i.Rs)}})}function SR(n,e){let t=L(n),i=t.Ka.get(e);if(i&&i.Ba)return J().add(i.key);{let r=J(),s=t.qa.get(e);if(!s)return r;for(let o of s){let a=t.ka.get(o);r=r.unionWith(a.view.ba)}return r}}function RR(n,e){return N(this,null,function*(){let t=L(n),i=yield Lc(t.localStore,e.query,!0),r=e.view.Oa(i);return t.isPrimaryClient&&wp(t,e.targetId,r.Ma),r})}function PR(n,e){return N(this,null,function*(){let t=L(n);return _E(t.localStore,e).then(i=>Vn(t,i))})}function xR(n,e,t,i){return N(this,null,function*(){let r=L(n),s=yield function(a,c){let u=L(a),d=L(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",p=>d.Ln(p,c).next(m=>m?u.localDocuments.getDocuments(p,m):S.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?yield Ts(r.remoteStore):t==="acknowledged"||t==="rejected"?(pm(r,e,i||null),fm(r,e),function(a,c){L(L(a).mutationQueue).qn(c)}(r.localStore,e)):U(),yield Vn(r,s)):V(wi,"Cannot apply mutation batch with id: "+e)})}function NR(n,e){return N(this,null,function*(){let t=L(n);if(mu(t),gm(t),e===!0&&t.ja!==!0){let i=t.sharedClientState.getAllActiveQueryTargets(),r=yield Lw(t,i.toArray());t.ja=!0,yield up(t.remoteStore,!0);for(let s of r)pu(t.remoteStore,s)}else if(e===!1&&t.ja!==!1){let i=[],r=Promise.resolve();t.qa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(ps(t,o),hs(t.localStore,o,!0))),ds(t.remoteStore,o)}),yield r,yield Lw(t,i),function(o){let a=L(o);a.Ka.forEach((c,u)=>{ds(a.remoteStore,u)}),a.Ua.Dr(),a.Ka=new Map,a.$a=new _e(B.comparator)}(t),t.ja=!1,yield up(t.remoteStore,!1)}})}function Lw(n,e,t){return N(this,null,function*(){let i=L(n),r=[],s=[];for(let o of e){let a,c=i.qa.get(o);if(c&&c.length!==0){a=yield us(i.localStore,lt(c[0]));for(let u of c){let d=i.ka.get(u),p=yield RR(i,d);p.snapshot&&s.push(p.snapshot)}}else{let u=yield gE(i.localStore,o);a=yield us(i.localStore,u),yield dm(i,kE(u),o,!1,a.resumeToken)}r.push(a)}return i.La.p_(s),r})}function kE(n){return bT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function kR(n){return function(t){return L(L(t).persistence).zi()}(L(n).localStore)}function DR(n,e,t,i){return N(this,null,function*(){let r=L(n);if(r.ja)return void V(wi,"Ignoring unexpected query state notification.");let s=r.qa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield _E(r.localStore,RT(s[0])),a=oa.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ne.EMPTY_BYTE_STRING);yield Vn(r,o,a);break}case"rejected":yield hs(r.localStore,e,!0),ps(r,e,i);break;default:U()}})}function VR(n,e,t){return N(this,null,function*(){let i=mu(n);if(i.ja){for(let r of e){if(i.qa.has(r)&&i.sharedClientState.isActiveQueryTarget(r)){V(wi,"Adding an already active target "+r);continue}let s=yield gE(i.localStore,r),o=yield us(i.localStore,s);yield dm(i,kE(s),o.targetId,!1,o.resumeToken),pu(i.remoteStore,o)}for(let r of t)i.qa.has(r)&&(yield hs(i.localStore,r,!1).then(()=>{ds(i.remoteStore,r),ps(i,r)}).catch(gi))}})}function mu(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=xE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=SR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=TR.bind(null,e),e.La.p_=pR.bind(null,e.eventManager),e.La.Ja=mR.bind(null,e.eventManager),e}function gm(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ER.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=IR.bind(null,e),e}function OR(n,e,t){let i=L(n);(function(s,o,a){return N(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(y,C){let P=L(y),k=xe(C.createTime);return P.persistence.runTransaction("hasNewerBundle","readonly",q=>P.Yr.getBundleMetadata(q,C.id)).then(q=>!!q&&q.createTime.compareTo(k)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(RE(c));let u=new gp(c,s.localStore,o.serializer),d=yield o.Ya();for(;d;){let m=yield u.Aa(d);m&&a._updateProgress(m),d=yield o.Ya()}let p=yield u.complete();return yield Vn(s,p.ma,void 0),yield function(y,C){let P=L(y);return P.persistence.runTransaction("Save bundle","readwrite",k=>P.Yr.saveBundleMetadata(k,C))}(s.localStore,c),a._completeWith(p.progress),Promise.resolve(p.Va)}catch(c){return Ut(wi,`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}var _m=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return N(this,null,function*(){this.serializer=Aa(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),yield this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)})}tu(t,i){return null}nu(t,i){return null}eu(t){return dE(this.persistence,new Mc,t.initialUser,this.serializer)}Xa(t){return new da(Oc.ri,this.serializer)}Za(t){return new qc}terminate(){return N(this,null,function*(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Tp=class extends _m{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){G(this.persistence.referenceDelegate instanceof Fc);let i=this.persistence.referenceDelegate.garbageCollector;return new kc(i,e.asyncQueue,t)}Xa(e){let t=this.cacheSizeBytes!==void 0?pt.withCacheSize(this.cacheSizeBytes):pt.DEFAULT;return new da(i=>Fc.ri(i,t),this.serializer)}},Xc=class n extends _m{constructor(e,t,i){super(),this.ru=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){yield zh(n.prototype,this,"initialize").call(this,e),yield this.ru.initialize(this,e),yield gm(this.ru.syncEngine),yield Ts(this.ru.remoteStore),yield this.persistence.Ci(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}eu(e){return dE(this.persistence,new Mc,e.initialUser,this.serializer)}tu(e,t){let i=this.persistence.referenceDelegate.garbageCollector;return new kc(i,e.asyncQueue,t)}nu(e,t){let i=new Wd(t,this.persistence);return new zd(e.asyncQueue,i)}Xa(e){let t=rm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?pt.withCacheSize(this.cacheSizeBytes):pt.DEFAULT;return new Hf(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,EE(),ic(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Za(e){return new qc}},Ep=class n extends Xc{constructor(e,t){super(e,t,!1),this.ru=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return N(this,null,function*(){yield zh(n.prototype,this,"initialize").call(this,e);let t=this.ru.syncEngine;this.sharedClientState instanceof $o&&(this.sharedClientState.syncEngine={uo:xR.bind(null,t),co:DR.bind(null,t),lo:VR.bind(null,t),zi:kR.bind(null,t),ao:PR.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.Ci(i=>N(this,null,function*(){yield NR(this.ru.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}Za(e){let t=EE();if(!$o.D(t))throw new D(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=rm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new $o(t,e.asyncQueue,i,e.clientId,e.initialUser)}},ym=(()=>{class n{initialize(t,i){return N(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Mw(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=bR.bind(null,this.syncEngine),yield up(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new fp}()}createDatastore(t){let i=Aa(t.databaseInfo.databaseId),r=function(o){return new ip(o)}(t.databaseInfo);return function(o,a,c,u){return new ap(o,a,c,u)}(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return function(r,s,o,a,c){return new cp(r,s,o,a,c)}(this.localStore,this.datastore,t.asyncQueue,i=>Mw(this.syncEngine,i,0),function(){return jc.D()?new jc:new Zf}())}createSyncEngine(t,i){return function(s,o,a,c,u,d,p){let m=new vp(s,o,a,c,u,d);return p&&(m.ja=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}terminate(){return N(this,null,function*(){var t,i;yield function(s){return N(this,null,function*(){let o=L(s);V(rr,"RemoteStore shutting down."),o.W_.add(5),yield ws(o),o.z_.shutdown(),o.j_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()})}}return n.provider={build:()=>new n},n})();function Bw(n,e=10240){let t=0;return{read(){return N(this,null,function*(){if(t<n.byteLength){let r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})},cancel(){return N(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var ms=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Re("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Ip=class{constructor(e,t){this.ou=e,this.serializer=t,this.metadata=new je,this.buffer=new Uint8Array,this._u=function(){return new TextDecoder("utf-8")}(),this.au().then(i=>{i&&i.Ea()?this.metadata.resolve(i.Ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.Ia)}`))},i=>this.metadata.reject(i))}close(){return this.ou.cancel()}getMetadata(){return N(this,null,function*(){return this.metadata.promise})}Ya(){return N(this,null,function*(){return yield this.getMetadata(),this.au()})}au(){return N(this,null,function*(){let e=yield this.uu();if(e===null)return null;let t=this._u.decode(e),i=Number(t);isNaN(i)&&this.cu(`length string (${t}) is not valid number`);let r=yield this.lu(i);return new mp(JSON.parse(r),e.length+i)})}hu(){return this.buffer.findIndex(e=>e===123)}uu(){return N(this,null,function*(){for(;this.hu()<0&&!(yield this.Pu()););if(this.buffer.length===0)return null;let e=this.hu();e<0&&this.cu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}lu(e){return N(this,null,function*(){for(;this.buffer.length<e;)(yield this.Pu())&&this.cu("Reached the end of bundle when more is expected.");let t=this._u.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}cu(e){throw this.ou.cancel(),new Error(`Invalid bundle format: ${e}`)}Pu(){return N(this,null,function*(){let e=yield this.ou.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Ap=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(r,s){return N(this,null,function*(){let o=L(r),a={documents:s.map(p=>la(o.serializer,p))},c=yield o.Co("BatchGetDocuments",o.serializer.databaseId,se.emptyPath(),a,s.length),u=new Map;c.forEach(p=>{let m=BS(o.serializer,p);u.set(m.key.toString(),m)});let d=[];return s.forEach(p=>{let m=u.get(p.toString());G(!!m),d.push(m)}),d})}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new fi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{let r=B.fromPath(i);this.mutations.push(new ia(r,this.precondition(r)))}),yield function(i,r){return N(this,null,function*(){let s=L(i),o={writes:r.map(a=>ca(s.serializer,a))};yield s.bo("Commit",s.serializer.databaseId,se.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=K.min()}let i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new D(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Ce.exists(!1):Ce.updateTime(t):Ce.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new D(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ce.updateTime(t)}return Ce.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Cp=class{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.Tu=i.maxAttempts,this.a_=new pa(this.asyncQueue,"transaction_retry")}Iu(){this.Tu-=1,this.Eu()}Eu(){this.a_.Xo(()=>N(this,null,function*(){let e=new Ap(this.datastore),t=this.du(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.Au(r)}))}).catch(i=>{this.Au(i)})}))}du(e){try{let t=this.updateFunction(e);return!va(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Au(e){this.Tu>0&&this.Ru(e)?(this.Tu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Eu(),Promise.resolve()))):this.deferred.reject(e)}Ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!qT(t)}return!1}};var mi="FirestoreClient",bp=class{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Me.UNAUTHENTICATED,this.clientId=oc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,o=>N(this,null,function*(){V(mi,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(i,o=>(V(mi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=Is(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function Od(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V(mi,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>N(this,null,function*(){i.isEqual(r)||(yield fE(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Uw(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield vm(n);V(mi,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>Vw(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>Vw(e.remoteStore,r)),n._onlineComponents=e})}function vm(n){return N(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(mi,"Using user provided OfflineComponentProvider");try{yield Od(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===R.FAILED_PRECONDITION||r.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Ut("Error using user provided cache. Falling back to memory cache: "+t),yield Od(n,new _m)}}else V(mi,"Using default OfflineComponentProvider"),yield Od(n,new Tp(void 0));return n._offlineComponents})}function gu(n){return N(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(mi,"Using user provided OnlineComponentProvider"),yield Uw(n,n._uninitializedComponentsProvider._online)):(V(mi,"Using default OnlineComponentProvider"),yield Uw(n,new ym))),n._onlineComponents})}function DE(n){return vm(n).then(e=>e.persistence)}function wm(n){return vm(n).then(e=>e.localStore)}function VE(n){return gu(n).then(e=>e.remoteStore)}function Tm(n){return gu(n).then(e=>e.syncEngine)}function FR(n){return gu(n).then(e=>e.datastore)}function gs(n){return N(this,null,function*(){let e=yield gu(n),t=e.eventManager;return t.onListen=gR.bind(null,e.syncEngine),t.onUnlisten=yR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=_R.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=vR.bind(null,e.syncEngine),t})}function MR(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield DE(n),t=yield VE(n);return e.setNetworkEnabled(!0),function(r){let s=L(r);return s.W_.delete(0),Ca(s)}(t)}))}function LR(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield DE(n),t=yield VE(n);return e.setNetworkEnabled(!1),function(r){return N(this,null,function*(){let s=L(r);s.W_.add(0),yield ws(s),s.j_.set("Offline")})}(t)}))}function BR(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s,o){return N(this,null,function*(){try{let a=yield function(u,d){let p=L(u);return p.persistence.runTransaction("read document","readonly",m=>p.localDocuments.getDocument(m,d))}(r,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=Is(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield wm(n),e,t)})),t.promise}function OE(n,e,t={}){let i=new je;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,c,u){let d=new ms({next:m=>{d.su(),o.enqueueAndForget(()=>um(s,p));let y=m.docs.has(a);!y&&m.fromCache?u.reject(new D(R.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&c&&c.source==="server"?u.reject(new D(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new ma(vs(a.path),d,{includeMetadataChanges:!0,Ta:!0});return cm(s,p)}(yield gs(n),n.asyncQueue,e,t,i)})),i.promise}function UR(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s,o){return N(this,null,function*(){try{let a=yield Lc(r,s,!0),c=new Yc(s,a.gs),u=c.Sa(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=Is(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield wm(n),e,t)})),t.promise}function FE(n,e,t={}){let i=new je;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,c,u){let d=new ms({next:m=>{d.su(),o.enqueueAndForget(()=>um(s,p)),m.fromCache&&c.source==="server"?u.reject(new D(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new ma(a,d,{includeMetadataChanges:!0,Ta:!0});return cm(s,p)}(yield gs(n),n.asyncQueue,e,t,i)})),i.promise}function qR(n,e){let t=new ms(e);return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s){L(r).ia.add(s),s.next()}(yield gs(n),t)})),()=>{t.su(),n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s){L(r).ia.delete(s)}(yield gs(n),t)}))}}function jR(n,e,t,i){let r=function(o,a){let c;return c=typeof o=="string"?GT().encode(o):o,function(d,p){return new Ip(d,p)}(function(d,p){if(d instanceof Uint8Array)return Bw(d,p);if(d instanceof ArrayBuffer)return Bw(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,Aa(e));n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){OR(yield Tm(n),r,i)}))}function GR(n,e){return n.asyncQueue.enqueue(()=>N(this,null,function*(){return function(i,r){let s=L(i);return s.persistence.runTransaction("Get named query","readonly",o=>s.Yr.getNamedQuery(o,r))}(yield wm(n),e)}))}function ME(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var qw=new Map;function Em(n,e,t){if(!t)throw new D(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Im(n,e,t,i){if(e===!0&&i===!0)throw new D(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function jw(n){if(!B.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Gw(n){if(B.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function _u(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U()}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=_u(n);throw new D(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function LE(n,e){if(e<=0)throw new D(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var BE="firestore.googleapis.com",Kw=!0,Jc=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new D(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=BE,this.ssl=Kw}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Kw;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=sE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<YS)throw new D(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Im("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ME((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},sr=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new Fd;switch(i.type){case"firstParty":return new Ud(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new D(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return N(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let i=qw.get(t);i&&(V("ComponentProvider","Removing Datastore"),qw.delete(t),i.terminate())}(this),Promise.resolve()}};function UE(n,e,t,i={}){var r;let s=(n=oe(n,sr))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:n._getEmulatorOptions()}),a=`${e}:${t}`;s.host!==BE&&s.host!==a&&Ut("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let c=Object.assign(Object.assign({},s),{host:a,ssl:!1,emulatorOptions:i});if(!xr(c,o)&&(n._setSettings(c),i.mockUserToken)){let u,d;if(typeof i.mockUserToken=="string")u=i.mockUserToken,d=Me.MOCK_USER;else{u=kl(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let p=i.mockUserToken.sub||i.mockUserToken.user_id;if(!p)throw new D(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Me(p)}n._authCredentials=new Md(new rc(u,d))}}var Qe=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},pe=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new on(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},on=class n extends Qe{constructor(e,t,i){super(e,t,vs(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new B(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Am(n,e,...t){if(n=ne(n),Em("collection","path",e),n instanceof sr){let i=se.fromString(e,...t);return Gw(i),new on(n,null,i)}{if(!(n instanceof pe||n instanceof on))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(se.fromString(e,...t));return Gw(i),new on(n.firestore,null,i)}}function qE(n,e){if(n=oe(n,sr),Em("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Qe(n,null,function(i){return new qt(se.emptyPath(),i)}(e))}function ba(n,e,...t){if(n=ne(n),arguments.length===1&&(e=oc.newId()),Em("doc","path",e),n instanceof sr){let i=se.fromString(e,...t);return jw(i),new pe(n,null,new B(i))}{if(!(n instanceof pe||n instanceof on))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(se.fromString(e,...t));return jw(i),new pe(n.firestore,n instanceof on?n.converter:null,new B(i))}}function Cm(n,e){return n=ne(n),e=ne(e),(n instanceof pe||n instanceof on)&&(e instanceof pe||e instanceof on)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function bm(n,e){return n=ne(n),e=ne(e),n instanceof Qe&&e instanceof Qe&&n.firestore===e.firestore&&Ea(n._query,e._query)&&n.converter===e.converter}var zw="AsyncQueue",Zc=class{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new pa(this,"async_queue_retry"),this.bu=()=>{let i=ic();i&&V(zw,"Visibility state changed to "+i.visibilityState),this.a_.t_()},this.Su=e;let t=ic();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;let t=ic();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});let t=new je;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}Cu(){return N(this,null,function*(){if(this.Vu.length!==0){try{yield this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!_i(e))throw e;V(zw,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}})}vu(e){let t=this.Su.then(()=>(this.pu=!0,e().catch(i=>{this.gu=i,this.pu=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw Re("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.pu=!1,i))));return this.Su=t,t}enqueueAfterDelay(e,t,i){this.Du(),this.wu.indexOf(e)>-1&&(t=0);let r=hp.createAndSchedule(this,e,t,i,s=>this.Fu(s));return this.fu.push(r),r}Du(){this.gu&&U()}verifyOperationInProgress(){}Mu(){return N(this,null,function*(){let e;do e=this.Su,yield e;while(e!==this.Su)})}xu(e){for(let t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){let t=this.fu.indexOf(e);this.fu.splice(t,1)}};function Sp(n){return function(t,i){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Rp=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new je,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var jE=-1,Te=class extends sr{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new Zc,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return N(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Zc(e),this._firestoreClient=void 0,yield e}})}};function Ye(n){if(n._terminated)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||GE(n),n._firestoreClient}function GE(n){var e,t,i;let r=n._freezeSettings(),s=function(a,c,u,d){return new Yd(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,ME(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new bp(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(n._componentsProvider))}function KE(n,e){Ut("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return WE(n,ym.provider,{build:i=>new Xc(i,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function zE(n){return N(this,null,function*(){Ut("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();WE(n,ym.provider,{build:t=>new Ep(t,e.cacheSizeBytes)})})}function WE(n,e,t){if((n=oe(n,Te))._firestoreClient||n._terminated)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(R.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},GE(n)}function $E(n){if(n._initialized&&!n._terminated)throw new D(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new je;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{yield function(i){return N(this,null,function*(){if(!oi.D())return Promise.resolve();let r=i+hE;yield oi.delete(r)})}(rm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function HE(n){return function(t){let i=new je;return t.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return AR(yield Tm(t),i)})),i.promise}(Ye(n=oe(n,Te)))}function QE(n){return MR(Ye(n=oe(n,Te)))}function YE(n){return LR(Ye(n=oe(n,Te)))}function XE(n,e){let t=Ye(n=oe(n,Te)),i=new Rp;return jR(t,n._databaseId,e,i),i}function JE(n,e){return GR(Ye(n=oe(n,Te)),e).then(t=>t?new Qe(n,null,t.query):null)}var cn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ne.fromBase64String(e))}catch(t){throw new D(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Kt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var kn=class{constructor(e){this._methodName=e}};var or=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}};var ga=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}};var KR=/^__.*__$/,Pp=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Gt(e,this.data,this.fieldMask,t,this.fieldTransforms):new di(e,this.data,t,this.fieldTransforms)}},eu=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Gt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ZE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var tu=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.Bu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.ku({path:i,Qu:!1});return r.$u(e),r}Ku(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.ku({path:i,Qu:!1});return r.Bu(),r}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return nu(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(ZE(this.Lu)&&KR.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}},xp=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Aa(e)}ju(e,t,i,r=!1){return new tu({Lu:e,methodName:t,zu:i,path:Pe.emptyPath(),Qu:!1,Gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function cr(n){let e=n._freezeSettings(),t=Aa(n._databaseId);return new xp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function yu(n,e,t,i,r,s={}){let o=n.ju(s.merge||s.mergeFields?2:0,e,t,r);Pm("Data must be an object, but it was:",o,i);let a=nI(i,o),c,u;if(s.merge)c=new Tt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let p of s.mergeFields){let m=Op(e,p,t);if(!o.contains(m))throw new D(R.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);rI(d,m)||d.push(m)}c=new Tt(d),u=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,u=o.fieldTransforms;return new Pp(new nt(a),c,u)}var _a=class n extends kn{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function eI(n,e,t){return new tu({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Np=class n extends kn{_toFieldTransform(e){return new tr(e.path,new ui)}isEqual(e){return e instanceof n}},kp=class n extends kn{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){let t=eI(this,e,!0),i=this.Hu.map(s=>ur(s,t)),r=new xn(i);return new tr(e.path,r)}isEqual(e){return e instanceof n&&xr(this.Hu,e.Hu)}},Dp=class n extends kn{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){let t=eI(this,e,!0),i=this.Hu.map(s=>ur(s,t)),r=new Nn(i);return new tr(e.path,r)}isEqual(e){return e instanceof n&&xr(this.Hu,e.Hu)}},Vp=class n extends kn{constructor(e,t){super(e),this.Ju=t}_toFieldTransform(e){let t=new hi(e.serializer,VT(e.serializer,this.Ju));return new tr(e.path,t)}isEqual(e){return e instanceof n&&this.Ju===e.Ju}};function Sm(n,e,t,i){let r=n.ju(1,e,t);Pm("Data must be an object, but it was:",r,i);let s=[],o=nt.empty();yi(i,(c,u)=>{let d=xm(e,c,t);u=ne(u);let p=r.Ku(d);if(u instanceof _a)s.push(d);else{let m=ur(u,p);m!=null&&(s.push(d),o.set(d,m))}});let a=new Tt(s);return new eu(o,a,r.fieldTransforms)}function Rm(n,e,t,i,r,s){let o=n.ju(1,e,t),a=[Op(e,i,t)],c=[r];if(s.length%2!=0)throw new D(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(Op(e,s[m])),c.push(s[m+1]);let u=[],d=nt.empty();for(let m=a.length-1;m>=0;--m)if(!rI(u,a[m])){let y=a[m],C=c[m];C=ne(C);let P=o.Ku(y);if(C instanceof _a)u.push(y);else{let k=ur(C,P);k!=null&&(u.push(y),d.set(y,k))}}let p=new Tt(u);return new eu(d,p,o.fieldTransforms)}function tI(n,e,t,i=!1){return ur(t,n.ju(i?4:3,e))}function ur(n,e){if(iI(n=ne(n)))return Pm("Unsupported field value:",e,n),nI(n,e);if(n instanceof kn)return function(i,r){if(!ZE(r.Lu))throw r.Wu(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Wu(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let c=ur(a,r.Uu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=ne(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return VT(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=we.fromDate(i);return{timestampValue:as(r.serializer,s)}}if(i instanceof we){let s=new we(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:as(r.serializer,s)}}if(i instanceof or)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof cn)return{bytesValue:KT(r.serializer,i._byteString)};if(i instanceof pe){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.Wu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:tm(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof ga)return function(o,a){return{mapValue:{fields:{[Qp]:{stringValue:Yp},[ns]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Wu("VectorValues must only contain numeric values.");return em(a.serializer,u)})}}}}}}(i,r);throw r.Wu(`Unsupported field value: ${_u(i)}`)}(n,e)}function nI(n,e){let t={};return hT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yi(n,(i,r)=>{let s=ur(r,e.qu(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function iI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof we||n instanceof or||n instanceof cn||n instanceof pe||n instanceof kn||n instanceof ga)}function Pm(n,e,t){if(!iI(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let i=_u(t);throw i==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+i)}}function Op(n,e,t){if((e=ne(e))instanceof Kt)return e._internalPath;if(typeof e=="string")return xm(n,e);throw nu("Field path arguments must be of type string or ",n,!1,void 0,t)}var zR=new RegExp("[~\\*/\\[\\]]");function xm(n,e,t){if(e.search(zR)>=0)throw nu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Kt(...e.split("."))._internalPath}catch{throw nu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function nu(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new D(R.INVALID_ARGUMENT,a+n+c)}function rI(n,e){return n.some(t=>t.isEqual(e))}var ar=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Fp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(vu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Fp=class extends ar{data(){return super.data()}};function vu(n,e){return typeof e=="string"?xm(n,e):e instanceof Kt?e._internalPath:e._delegate._internalPath}function sI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ya=class{},lr=class extends ya{};function On(n,e,...t){let i=[];e instanceof ya&&i.push(e),i=i.concat(t),function(s){let o=s.filter(c=>c instanceof Mp).length,a=s.filter(c=>c instanceof iu).length;if(o>1||o>0&&a>0)throw new D(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var iu=class n extends lr{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return mI(e._query,t),new Qe(e.firestore,e.converter,hf(e._query,t))}_parse(e){let t=cr(e.firestore);return function(s,o,a,c,u,d,p){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new D(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){$w(p,d);let C=[];for(let P of p)C.push(Ww(c,s,P));m={arrayValue:{values:C}}}else m=Ww(c,s,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||$w(p,d),m=tI(a,o,p,d==="in"||d==="not-in");return ie.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function oI(n,e,t){let i=e,r=vu("where",n);return iu._create(r,i,t)}var Mp=class n extends ya{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let c of a)mI(o,c),o=hf(o,c)}(e._query,t),new Qe(e.firestore,e.converter,hf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Lp=class n extends lr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Zi(s,o)}(e._query,this._field,this._direction);return new Qe(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new qt(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function aI(n,e="asc"){let t=e,i=vu("orderBy",n);return Lp._create(i,t)}var ru=class n extends lr{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new Qe(e.firestore,e.converter,Tc(e._query,this._limit,this._limitType))}};function lI(n){return LE("limit",n),ru._create("limit",n,"F")}function cI(n){return LE("limitToLast",n),ru._create("limitToLast",n,"L")}var su=class n extends lr{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=pI(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(r,s){return new qt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function uI(...n){return su._create("startAt",n,!0)}function hI(...n){return su._create("startAfter",n,!1)}var ou=class n extends lr{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=pI(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(r,s){return new qt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)}(e._query,t))}};function dI(...n){return ou._create("endBefore",n,!1)}function fI(...n){return ou._create("endAt",n,!0)}function pI(n,e,t,i){if(t[0]=ne(t[0]),t[0]instanceof ar)return function(s,o,a,c,u){if(!c)throw new D(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let p of $r(s))if(p.field.isKeyField())d.push(Ji(o,c.key));else{let m=c.data.field(p.field);if(hu(m))throw new D(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let y=p.field.canonicalString();throw new D(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(m)}return new ln(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=cr(n.firestore);return function(o,a,c,u,d,p){let m=o.explicitOrderBy;if(d.length>m.length)throw new D(R.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let C=0;C<d.length;C++){let P=d[C];if(m[C].field.isKeyField()){if(typeof P!="string")throw new D(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof P}`);if(!Jp(o)&&P.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${P}' contains a slash.`);let k=o.path.child(se.fromString(P));if(!B.isDocumentKey(k))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let q=new B(k);y.push(Ji(a,q))}else{let k=tI(c,u,P);y.push(k)}}return new ln(y,p)}(n._query,n.firestore._databaseId,r,e,t,i)}}function Ww(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new D(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jp(e)&&t.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(se.fromString(t));if(!B.isDocumentKey(i))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Ji(n,new B(i))}if(t instanceof pe)return Ji(n,t._key);throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_u(t)}.`)}function $w(n,e){if(!Array.isArray(n)||n.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mI(n,e){let t=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var _s=class{convertValue(e,t="none"){switch(li(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ye(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Pn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return yi(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t[ns].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>ye(o.doubleValue));return new ga(s)}convertGeoPoint(e){return new or(ye(e.latitude),ye(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=du(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(ea(e));default:return null}}convertTimestamp(e){let t=Rn(e);return new we(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=se.fromString(e);G(tE(i));let r=new ai(i.get(1),i.get(3)),s=new B(i.popFirst(5));return r.isEqual(t)||Re(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function wu(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}var Bp=class extends _s{constructor(e){super(),this.firestore=e}convertBytes(e){return new cn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}};var Sn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},xt=class extends ar{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ri(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let i=this._document.data.field(vu("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},ri=class extends xt{data(e={}){return super.data(e)}},zt=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Sn(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new ri(this._firestore,this._userDataWriter,i.key,i,new Sn(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let c=new ri(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Sn(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new ri(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Sn(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:WR(a.type),doc:c,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function WR(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Nm(n,e){return n instanceof xt&&e instanceof xt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof zt&&e instanceof zt&&n._firestore===e._firestore&&bm(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function gI(n){n=oe(n,pe);let e=oe(n.firestore,Te);return OE(Ye(e),n._key).then(t=>Om(e,n,t))}var Dn=class extends _s{constructor(e){super(),this.firestore=e}convertBytes(e){return new cn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}};function _I(n){n=oe(n,pe);let e=oe(n.firestore,Te),t=Ye(e),i=new Dn(e);return BR(t,n._key).then(r=>new xt(e,i,n._key,r,new Sn(r!==null&&r.hasLocalMutations,!0),n.converter))}function yI(n){n=oe(n,pe);let e=oe(n.firestore,Te);return OE(Ye(e),n._key,{source:"server"}).then(t=>Om(e,n,t))}function vI(n){n=oe(n,Qe);let e=oe(n.firestore,Te),t=Ye(e),i=new Dn(e);return sI(n._query),FE(t,n._query).then(r=>new zt(e,i,n,r))}function wI(n){n=oe(n,Qe);let e=oe(n.firestore,Te),t=Ye(e),i=new Dn(e);return UR(t,n._query).then(r=>new zt(e,i,n,r))}function TI(n){n=oe(n,Qe);let e=oe(n.firestore,Te),t=Ye(e),i=new Dn(e);return FE(t,n._query,{source:"server"}).then(r=>new zt(e,i,n,r))}function km(n,e,t){n=oe(n,pe);let i=oe(n.firestore,Te),r=wu(n.converter,e,t);return As(i,[yu(cr(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Ce.none())])}function Dm(n,e,t,...i){n=oe(n,pe);let r=oe(n.firestore,Te),s=cr(r),o;return o=typeof(e=ne(e))=="string"||e instanceof Kt?Rm(s,"updateDoc",n._key,e,t,i):Sm(s,"updateDoc",n._key,e),As(r,[o.toMutation(n._key,Ce.exists(!0))])}function EI(n){return As(oe(n.firestore,Te),[new fi(n._key,Ce.none())])}function II(n,e){let t=oe(n.firestore,Te),i=ba(n),r=wu(n.converter,e);return As(t,[yu(cr(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Ce.exists(!1))]).then(()=>i)}function Vm(n,...e){var t,i,r;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Sp(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Sp(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(i=p.error)===null||i===void 0?void 0:i.bind(p),e[o+2]=(r=p.complete)===null||r===void 0?void 0:r.bind(p)}let c,u,d;if(n instanceof pe)u=oe(n.firestore,Te),d=vs(n._key.path),c={next:p=>{e[o]&&e[o](Om(u,n,p))},error:e[o+1],complete:e[o+2]};else{let p=oe(n,Qe);u=oe(p.firestore,Te),d=p._query;let m=new Dn(u);c={next:y=>{e[o]&&e[o](new zt(u,m,p,y))},error:e[o+1],complete:e[o+2]},sI(n._query)}return function(m,y,C,P){let k=new ms(P),q=new ma(y,k,C);return m.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return cm(yield gs(m),q)})),()=>{k.su(),m.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return um(yield gs(m),q)}))}}(Ye(u),d,a,c)}function AI(n,e){return qR(Ye(n=oe(n,Te)),Sp(e)?e:{next:e})}function As(n,e){return function(i,r){let s=new je;return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return wR(yield Tm(i),r,s)})),s.promise}(Ye(n),e)}function Om(n,e,t){let i=t.docs.get(e._key),r=new Dn(n);return new xt(n,r,e._key,i,new Sn(t.hasPendingWrites,t.fromCache),e.converter)}var $R={maxAttempts:5};var au=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cr(e)}set(e,t,i){this._verifyNotCommitted();let r=ni(e,this._firestore),s=wu(r.converter,t,i),o=yu(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,Ce.none())),this}update(e,t,i,...r){this._verifyNotCommitted();let s=ni(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof Kt?Rm(this._dataReader,"WriteBatch.update",s._key,t,i,r):Sm(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ce.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ni(e,this._firestore);return this._mutations=this._mutations.concat(new fi(t._key,Ce.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ni(n,e){if((n=ne(n)).firestore!==e)throw new D(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Up=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=cr(e)}get(e){let t=ni(e,this._firestore),i=new Bp(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||r.length!==1)return U();let s=r[0];if(s.isFoundDocument())return new ar(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new ar(this._firestore,i,t._key,null,t.converter);throw U()})}set(e,t,i){let r=ni(e,this._firestore),s=wu(r.converter,t,i),o=yu(this._dataReader,"Transaction.set",r._key,s,r.converter!==null,i);return this._transaction.set(r._key,o),this}update(e,t,i,...r){let s=ni(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof Kt?Rm(this._dataReader,"Transaction.update",s._key,t,i,r):Sm(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=ni(e,this._firestore);return this._transaction.delete(t._key),this}};var qp=class extends Up{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ni(e,this._firestore),i=new Dn(this._firestore);return super.get(e).then(r=>new xt(this._firestore,i,t._key,r._document,new Sn(!1,!1),t.converter))}};function CI(n,e,t){n=oe(n,Te);let i=Object.assign(Object.assign({},$R),t);return function(s){if(s.maxAttempts<1)throw new D(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(s,o,a){let c=new je;return s.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){let u=yield FR(s);new Cp(s.asyncQueue,u,a,o,c).Iu()})),c.promise}(Ye(n),r=>e(new qp(n,r)),i)}function bI(){return new _a("deleteField")}function SI(){return new Np("serverTimestamp")}function RI(...n){return new kp("arrayUnion",n)}function PI(...n){return new Dp("arrayRemove",n)}function xI(n){return new Vp("increment",n)}(function(e,t=!0){(function(r){ys=r})(Ll),Mi(new yt("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new Te(new Ld(i.getProvider("auth-internal")),new qd(o,i.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new D(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ai(u.options.projectId,d)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Mt(Ov,Fv,e),Mt(Ov,Fv,"esm2017")})();var HR="@firebase/firestore-compat",QR="0.3.44";function qm(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function NI(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function kI(){if(!dT())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Tu=class n{constructor(e){this._delegate=e}static fromBase64String(e){return kI(),new n(cn.fromBase64String(e))}static fromUint8Array(e){return NI(),new n(cn.fromUint8Array(e))}toBase64(){return kI(),this._delegate.toBase64()}toUint8Array(){return NI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Fm(n){return YR(n,["next","error","complete"])}function YR(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Mm=class{enableIndexedDbPersistence(e,t){return KE(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return zE(e._delegate)}clearIndexedDbPersistence(e){return $E(e._delegate)}},Eu=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof ai||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ut("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){UE(this._delegate,e,t,i)}enableNetwork(){return QE(this._delegate)}disableNetwork(){return YE(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,Im("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return HE(this._delegate)}onSnapshotsInSync(e){return AI(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ss(this,Am(this._delegate,e))}catch(t){throw ct(t,"collection()","Firestore.collection()")}}doc(e){try{return new un(this,ba(this._delegate,e))}catch(t){throw ct(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new pr(this,qE(this._delegate,e))}catch(t){throw ct(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return CI(this._delegate,t=>e(new Iu(this,t)))}batch(){return Ye(this._delegate),new Au(new au(this._delegate,e=>As(this._delegate,e)))}loadBundle(e){return XE(this._delegate,e)}namedQuery(e){return JE(this._delegate,e).then(t=>t?new pr(this,t):null)}},Cs=class extends _s{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tu(new cn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return un.forKey(t,this.firestore,null)}};function XR(n){Hw(n)}var Iu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Cs(e)}get(e){let t=hr(e);return this._delegate.get(t).then(i=>new dr(this._firestore,new xt(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let r=hr(e);return i?(qm("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=hr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=hr(e);return this._delegate.delete(t),this}},Au=class{constructor(e){this._delegate=e}set(e,t,i){let r=hr(e);return i?(qm("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=hr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=hr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},bs=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new ri(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new fr(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new n(e,new Cs(e),t),r.set(t,s)),s}};bs.INSTANCES=new WeakMap;var un=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Cs(e)}static forPath(e,t,i){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new pe(t._delegate,i,new B(e)))}static forKey(e,t,i){return new n(t,new pe(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new Ss(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ss(this.firestore,Am(this._delegate,e))}catch(t){throw ct(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof pe?Cm(this._delegate,e):!1}set(e,t){t=qm("DocumentReference.set",t);try{return t?km(this._delegate,e,t):km(this._delegate,e)}catch(i){throw ct(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?Dm(this._delegate,e):Dm(this._delegate,e,t,...i)}catch(r){throw ct(r,"updateDoc()","DocumentReference.update()")}}delete(){return EI(this._delegate)}onSnapshot(...e){let t=DI(e),i=VI(e,r=>new dr(this.firestore,new xt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Vm(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=_I(this._delegate):e?.source==="server"?t=yI(this._delegate):t=gI(this._delegate),t.then(i=>new dr(this.firestore,new xt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(bs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ct(n,e,t){return n.message=n.message.replace(e,t),n}function DI(n){for(let e of n)if(typeof e=="object"&&!Fm(e))return e;return{}}function VI(n,e){var t,i;let r;return Fm(n[0])?r=n[0]:Fm(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}var dr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new un(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Nm(this._delegate,e._delegate)}},fr=class extends dr{data(e){let t=this._delegate.data(e);return this._delegate._converter||Qw(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},pr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Cs(e)}where(e,t,i){try{return new n(this.firestore,On(this._delegate,oI(e,t,i)))}catch(r){throw ct(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,On(this._delegate,aI(e,t)))}catch(i){throw ct(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,On(this._delegate,lI(e)))}catch(t){throw ct(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,On(this._delegate,cI(e)))}catch(t){throw ct(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,On(this._delegate,uI(...e)))}catch(t){throw ct(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,On(this._delegate,hI(...e)))}catch(t){throw ct(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,On(this._delegate,dI(...e)))}catch(t){throw ct(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,On(this._delegate,fI(...e)))}catch(t){throw ct(t,"endAt()","Query.endAt()")}}isEqual(e){return bm(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=wI(this._delegate):e?.source==="server"?t=TI(this._delegate):t=vI(this._delegate),t.then(i=>new Sa(this.firestore,new zt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=DI(e),i=VI(e,r=>new Sa(this.firestore,new zt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Vm(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(bs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Lm=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new fr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Sa=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new pr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new fr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Lm(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new fr(this._firestore,i))})}isEqual(e){return Nm(this._delegate,e._delegate)}},Ss=class n extends pr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new un(this.firestore,e):null}doc(e){try{return e===void 0?new un(this.firestore,ba(this._delegate)):new un(this.firestore,ba(this._delegate,e))}catch(t){throw ct(t,"doc()","CollectionReference.doc()")}}add(e){return II(this._delegate,e).then(t=>new un(this.firestore,t))}isEqual(e){return Cm(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(bs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function hr(n){return oe(n,pe)}var Bm=class n{constructor(...e){this._delegate=new Kt(...e)}static documentId(){return new n(Pe.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof Kt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Um=class n{static serverTimestamp(){let e=SI();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=bI();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=RI(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=PI(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=xI(e);return t._methodName="FieldValue.increment",new n(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}};var JR={Firestore:Eu,GeoPoint:or,Timestamp:we,Blob:Tu,Transaction:Iu,WriteBatch:Au,DocumentReference:un,DocumentSnapshot:dr,Query:pr,QueryDocumentSnapshot:fr,QuerySnapshot:Sa,CollectionReference:Ss,FieldPath:Bm,FieldValue:Um,setLogLevel:XR,CACHE_SIZE_UNLIMITED:jE};function ZR(n,e){n.INTERNAL.registerComponent(new yt("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},JR)))}function eP(n){ZR(n,(e,t)=>new Eu(e,t,new Mm)),n.registerVersion(HR,QR)}eP(qe);function tP(n,e=Rr){return new jn(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function OI(n,e){return tP(n,e)}function nP(n,e){return OI(n,e).pipe(Sl(void 0),bl(),Ae(t=>{let[i,r]=t;return r.exists?i?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function Km(n,e){return OI(n,e).pipe(Ae(t=>({payload:t,type:"query"})))}var Cu=class{ref;afs;injector=be(wn);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:r,query:s}=UI(i,t);return new Su(r,s,this.afs)}snapshotChanges(){return nP(this.ref,this.afs.schedulers.outsideAngular).pipe(Se(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe(Ae(({payload:t})=>e.idField?Ot(Ke({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Gn(this.ref.get(e)).pipe(Se(this.injector))}};function bu(n,e){return Km(n,e).pipe(Sl(void 0),bl(),Ae(t=>{let[i,r]=t,s=r.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((a,c)=>{let u=s.find(p=>p.doc.ref.isEqual(a.ref)),d=i?.payload.docs.find(p=>p.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function FI(n,e,t){return bu(n,t).pipe(Vi((i,r)=>iP(i,r.map(s=>s.payload),e),[]),Cl(),Ae(i=>i.map(r=>({type:r.type,payload:r}))))}function iP(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=rP(n,i))}),n}function jm(n,e,t,...i){let r=n.slice();return r.splice(e,t,...i),r}function rP(n,e){switch(e.type){case"added":if(!n[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return jm(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return jm(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return jm(n,e.oldIndex,1);break}return n}function MI(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Su=class{ref;query;afs;injector=be(wn);constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=bu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ae(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Sl(void 0),bl(),fo(([i,r])=>r.length>0||!i),Ae(([,i])=>i),Se(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(Vi((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=MI(e);return FI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Se(this.injector))}valueChanges(e={}){return Km(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.payload.docs.map(i=>e.idField?Ot(Ke({},i.data()),{[e.idField]:i.id}):i.data())),Se(this.injector))}get(e){return Gn(this.query.get(e)).pipe(Se(this.injector))}add(e){return this.ref.add(e)}doc(e){return new Cu(this.ref.doc(e),this.afs)}},Gm=class{query;afs;injector=be(wn);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?bu(this.query,this.afs.schedulers.outsideAngular).pipe(Se(this.injector)):bu(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.filter(i=>e.indexOf(i.type)>-1)),fo(t=>t.length>0),Se(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(Vi((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=MI(e);return FI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Se(this.injector))}valueChanges(e={}){return Km(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(i=>i.payload.docs.map(r=>e.idField?Ke({[e.idField]:r.id},r.data()):r.data())),Se(this.injector))}get(e){return Gn(this.query.get(e)).pipe(Se(this.injector))}},LI=new ke("angularfire2.enableFirestorePersistence"),BI=new ke("angularfire2.firestore.persistenceSettings"),sP=new ke("angularfire2.firestore.settings"),oP=new ke("angularfire2.firestore.use-emulator");function UI(n,e=t=>t){return{query:e(n),ref:n}}var aP=(()=>{class n{schedulers;firestore;persistenceEnabled$;ngZone=be(De);constructor(t,i,r,s,o,a,c,u,d,p,m,y,C,P,k,q,j){this.schedulers=c;let F=Ui(t,a,i),W=d;p&&Do(F,a,m,C,P,k,y,q),[this.firestore,this.persistenceEnabled$]=kr(`${F.name}.firestore`,"AngularFirestore",F.name,()=>{let Q=a.runOutsideAngular(()=>F.firestore());if(s&&Q.settings(s),W&&Q.useEmulator(...W),r&&!xl(o)){let Y=()=>{try{return Gn(Q.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),Qt(!1)}};return[Q,a.runOutsideAngular(Y)]}else return[Q,Qt(!1)]},[s,W,r])}collection(t,i){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=UI(r,i),a=this.ngZone.run(()=>s);return new Su(a,o,this)}collectionGroup(t,i){let r=i||(o=>o),s=this.firestore.collectionGroup(t);return new Gm(r(s),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let r=this.ngZone.run(()=>i);return new Cu(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(z($n),z(Hn,8),z(LI,8),z(sP,8),z(Kn),z(De),z(Bi),z(BI,8),z(oP,8),z(Vo,8),z(So,8),z(Ro,8),z(Po,8),z(xo,8),z(No,8),z(ko,8),z(Yn,8))};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),v1=(()=>{class n{constructor(){qe.registerVersion("angularfire",Zt.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:LI,useValue:!0},{provide:BI,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Xt({type:n});static \u0275inj=Yt({providers:[aP]})}return n})();var qI="@firebase/database",jI="1.0.13";var n_="";function i_(n){n_=n}var Jm=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ve(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Vl(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Zm=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return St(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var v0=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Jm(e)}}catch{}return new Zm},gr=v0("localStorage"),eg=v0("sessionStorage");var Ns=new Wn("@firebase/database"),w0=function(){let n=1;return function(){return n++}}(),T0=function(n){let e=lv(n),t=new av;t.update(e);let i=t.digest();return Nl.encodeByteArray(i)},Xa=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Xa.apply(null,i):typeof i=="object"?e+=Ve(i):e+=i,e+=" "}return e},_r=null,GI=!0,E0=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ns.logLevel=Rt.VERBOSE,_r=Ns.log.bind(Ns),e&&eg.set("logging_enabled",!0)):typeof n=="function"?_r=n:(_r=null,eg.remove("logging_enabled"))},We=function(...n){if(GI===!0&&(GI=!1,_r===null&&eg.get("logging_enabled")===!0&&E0(!0)),_r){let e=Xa.apply(null,n);_r(e)}},Ja=function(n){return function(...e){We(n,...e)}},tg=function(...n){let e="FIREBASE INTERNAL ERROR: "+Xa(...n);Ns.error(e)},fn=function(...n){let e=`FIREBASE FATAL ERROR: ${Xa(...n)}`;throw Ns.error(e),new Error(e)},rt=function(...n){let e="FIREBASE WARNING: "+Xa(...n);Ns.warn(e)},lP=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&rt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},th=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},cP=function(n){if(Jt()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ai="[MIN_NAME]",Fn="[MAX_NAME]",vr=function(n,e){if(n===e)return 0;if(n===Ai||e===Fn)return-1;if(e===Ai||n===Fn)return 1;{let t=KI(n),i=KI(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},uP=function(n,e){return n===e?0:n<e?-1:1},Ra=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ve(e))},r_=function(n){if(typeof n!="object"||n===null)return Ve(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=Ve(e[i]),t+=":",t+=r_(n[e[i]]);return t+="}",t},I0=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function $e(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var A0=function(n){O(!th(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(r?1:0),u.reverse();let d=u.join(""),p="";for(c=0;c<64;c+=8){let m=parseInt(d.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},hP=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},dP=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function fP(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var pP=new RegExp("^-?(0*)\\d{1,10}$"),mP=-2147483648,gP=2147483647,KI=function(n){if(pP.test(n)){let e=Number(n);if(e>=mP&&e<=gP)return e}return null},Us=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw rt("Exception was thrown by user callback.",t),e},Math.floor(0))}},_P=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ka=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var ng=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Ml(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){rt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var ig=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(We("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',rt(e)}},Da=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Pu="5",C0="v",b0="s",S0="r",R0="f",P0=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,x0="ls",N0="p",rg="ac",k0="websocket",D0="long_polling";var xu=class{constructor(e,t,i,r,s=!1,o="",a=!1,c=!1,u=null){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=gr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&gr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function yP(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function V0(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let i;if(e===k0)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===D0)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);yP(n)&&(t.ns=n.namespace);let r=[];return $e(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var sg=class{constructor(){this.counters_={}}incrementCounter(e,t=1){St(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ev(this.counters_)}};var zm={},Wm={};function s_(n){let e=n.toString();return zm[e]||(zm[e]=new sg),zm[e]}function vP(n,e){let t=n.toString();return Wm[t]||(Wm[t]=e()),Wm[t]}var og=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Us(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var zI="start",wP="close",TP="pLPCommand",EP="pRTLPCB",O0="id",F0="pw",M0="ser",IP="cb",AP="seg",CP="ts",bP="d",SP="dframe",L0=1870,B0=30,RP=L0-B0,PP=25e3,xP=3e4,Ma=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ja(e),this.stats_=s_(t),this.urlFn=c=>(this.appCheckToken&&(c[rg]=this.appCheckToken),V0(t,D0,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new og(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(xP)),cP(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ag((...s)=>{let[o,a,c,u,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===zI)this.id=a,this.password=c;else if(o===wP)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[zI]="t",i[M0]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[IP]=this.scriptTagHolder.uniqueCallbackIdentifier),i[C0]=Pu,this.transportSessionId&&(i[b0]=this.transportSessionId),this.lastSessionId&&(i[x0]=this.lastSessionId),this.applicationId&&(i[N0]=this.applicationId),this.appCheckToken&&(i[rg]=this.appCheckToken),typeof location<"u"&&location.hostname&&P0.test(location.hostname)&&(i[S0]=R0);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Jt()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!hP()&&!dP()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=Zy(t),r=I0(i,RP);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Jt())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[SP]="t",i[O0]=e,i[F0]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Ve(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},ag=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Jt())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=w0(),window[TP+this.uniqueCallbackIdentifier]=e,window[EP+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){We("frame writing exception"),a.stack&&We(a.stack),We(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||We("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[O0]=this.myID,e[F0]=this.myPW,e[M0]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+B0+i.length<=L0;){let o=this.pendingSegs.shift();i=i+"&"+AP+r+"="+o.seg+"&"+CP+r+"="+o.ts+"&"+bP+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(PP)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){Jt()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{We("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var NP=16384,kP=45e3,Nu=null;typeof MozWebSocket<"u"?Nu=MozWebSocket:typeof WebSocket<"u"&&(Nu=WebSocket);var Ps=(()=>{class n{constructor(t,i,r,s,o,a,c){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ja(this.connId),this.stats_=s_(i),this.connURL=n.connectionURL_(i,a,c,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[C0]=Pu,!Jt()&&typeof location<"u"&&location.hostname&&P0.test(location.hostname)&&(a[S0]=R0),i&&(a[b0]=i),r&&(a[x0]=r),s&&(a[rg]=s),o&&(a[N0]=o),V0(t,k0,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,gr.set("previous_websocket_failure",!0);try{let r;if(Jt()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${Pu}/${n_}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new Nu(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&Nu!==null&&!n.forceDisallow_}static previouslyFailed(){return gr.isInMemoryStorage||gr.get("previous_websocket_failure")===!0}markConnectionHealthy(){gr.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=Vl(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=Ve(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=I0(i,NP);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(kP))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),U0=(()=>{class n{static get ALL_TRANSPORTS(){return[Ma,Ps]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let i=Ps&&Ps.isAvailable(),r=i&&!Ps.previouslyFailed();if(t.webSocketOnly&&(i||rt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Ps];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),DP=6e4,VP=5e3,OP=10*1024,FP=100*1024,$m="t",WI="d",MP="s",$I="r",LP="e",HI="o",QI="a",YI="n",XI="p",BP="h",lg=class{constructor(e,t,i,r,s,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ja("c:"+this.id+":"),this.transportManager_=new U0(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ka(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>FP?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>OP?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if($m in e){let t=e[$m];t===QI?this.upgradeIfSecondaryHealthy_():t===$I?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===HI&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Ra("t",e),i=Ra("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:XI,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:QI,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:YI,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Ra("t",e),i=Ra("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Ra($m,e);if(WI in e){let i=e[WI];if(t===BP){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===YI){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===MP?this.onConnectionShutdown_(i):t===$I?this.onReset_(i):t===LP?tg("Server Error: "+i):t===HI?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tg("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Pu!==i&&rt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ka(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(DP))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ka(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(VP))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:XI,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(gr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var ku=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var Du=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Vu=class n extends Du{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!id()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var JI=32,ZI=768,ce=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function le(){return new ce("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ci(n){return n.pieces_.length-n.pieceNum_}function fe(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ce(n.pieces_,e)}function o_(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function UP(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function La(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function q0(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ce(e,0)}function ve(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof ce)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new ce(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function ut(n,e){let t=Z(n),i=Z(e);if(t===null)return e;if(t===i)return ut(fe(n),fe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function qP(n,e){let t=La(n,0),i=La(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=vr(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function a_(n,e){if(Ci(n)!==Ci(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Nt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Ci(n)>Ci(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var cg=class{constructor(e,t){this.errorPrefix_=t,this.parts_=La(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Io(this.parts_[i]);j0(this)}};function jP(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Io(e),j0(n)}function GP(n){let e=n.parts_.pop();n.byteLength_-=Io(e),n.parts_.length>0&&(n.byteLength_-=1)}function j0(n){if(n.byteLength_>ZI)throw new Error(n.errorPrefix_+"has a key path longer than "+ZI+" bytes ("+n.byteLength_+").");if(n.parts_.length>JI)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+JI+") or object contains a cycle "+mr(n))}function mr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var ug=class n extends Du{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var Pa=1e3,KP=60*5*1e3,e0=30*1e3,zP=1.3,WP=3e4,$P="server_kill",t0=3,l_=(()=>{class n extends ku{constructor(t,i,r,s,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=Ja("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Pa,this.maxReconnectDelay_=KP,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!Jt())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ug.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Vu.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(Ve(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new ze,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;n.warnOnListenWarnings_(u,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&St(t,"w")){let r=zn(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();rt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||sv(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=e0)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=rv(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ve(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):tg("Unrecognized action received from server: "+Ve(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Pa,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Pa,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>WP&&(this.reconnectDelay_=Pa),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*zP)}this.onConnectStatus_(!1)}establishConnection_(){return N(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,r())},d=function(m){O(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(m)};this.realtime_={close:u,sendRequest:d};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,y]=yield Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?We("getToken() completed but was canceled"):(We("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=y&&y.token,c=new lg(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,C=>{rt(C+" ("+this.repoInfo_.toString()+")"),this.interrupt($P)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&rt(m),u())}}})}interrupt(t){We("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){We("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ol(this.interruptReasons_)&&(this.reconnectDelay_=Pa,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>r_(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new ce(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){We("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=t0&&(this.reconnectDelay_=e0,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){We("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=t0&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";Jt()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+n_.replace(/\./g,"-")]=1,id()?t["framework.cordova"]=1:tv()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Vu.getInstance().currentlyOnline();return Ol(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),te=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var ks=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new te(Ai,e),r=new te(Ai,t);return this.compare(i,r)!==0}minPost(){return te.MIN}};var Ru,Ou=class extends ks{static get __EMPTY_NODE(){return Ru}static set __EMPTY_NODE(e){Ru=e}compare(e,t){return vr(e.name,t.name)}isDefinedOn(e){throw Pr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return te.MIN}maxPost(){return new te(Fn,Ru)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new te(e,Ru)}toString(){return".key"}},dn=new Ou;var xs=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Wt=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??kt.EMPTY_NODE,this.right=o??kt.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return kt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return kt.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),hg=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new Wt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},kt=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Wt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Wt.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new xs(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new xs(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new xs(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new xs(this.root_,null,this.comparator_,!0,e)}};kt.EMPTY_NODE=new hg;function HP(n,e){return vr(n.name,e.name)}function c_(n,e){return vr(n,e)}var dg;function QP(n){dg=n}var G0=function(n){return typeof n=="number"?"number:"+A0(n):"string:"+n},K0=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&St(e,".sv"),"Priority must be a string or number.")}else O(n===dg||n.isEmpty(),"priority of unexpected type.");O(n===dg||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var n0,Ds=(()=>{class n{static set __childrenNodeConstructor(t){n0=t}static get __childrenNodeConstructor(){return n0}constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),K0(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ee(t)?this:Z(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=Z(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(O(r!==".priority"||Ci(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(fe(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+G0(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=A0(this.value_):t+=this.value_,this.lazyHash_=T0(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return O(s>=0,"Unknown leaf type: "+i),O(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),z0,W0;function YP(n){z0=n}function XP(n){W0=n}var fg=class extends ks{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?vr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return te.MIN}maxPost(){return new te(Fn,new Ds("[PRIORITY-POST]",W0))}makePost(e,t){let i=z0(e);return new te(t,new Ds("[PRIORITY-POST]",i))}toString(){return".priority"}},me=new fg;var JP=Math.log(2),pg=class{constructor(e){let t=s=>parseInt(Math.log(s)/JP,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Fu=function(n,e,t,i){n.sort(e);let r=function(c,u){let d=u-c,p,m;if(d===0)return null;if(d===1)return p=n[c],m=t?t(p):p,new Wt(m,p.node,Wt.BLACK,null,null);{let y=parseInt(d/2,10)+c,C=r(c,y),P=r(y+1,u);return p=n[y],m=t?t(p):p,new Wt(m,p.node,Wt.BLACK,C,P)}},s=function(c){let u=null,d=null,p=n.length,m=function(C,P){let k=p-C,q=p;p-=C;let j=r(k+1,q),F=n[k],W=t?t(F):F;y(new Wt(W,F.node,P,null,j))},y=function(C){u?(u.left=C,u=C):(d=C,u=C)};for(let C=0;C<c.count;++C){let P=c.nextBitIsOne(),k=Math.pow(2,c.count-(C+1));P?m(k,Wt.BLACK):(m(k,Wt.BLACK),m(k,Wt.RED))}return d},o=new pg(n.length),a=s(o);return new kt(i||e,a)};var Hm,Rs={},Vs=class n{static get Default(){return O(Rs&&me,"ChildrenNode.ts has not been loaded"),Hm=Hm||new n({".priority":Rs},{".priority":me}),Hm}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=zn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof kt?t:null}hasIndex(e){return St(this.indexSet_,e.toString())}addIndex(e,t){O(e!==dn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(te.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Fu(i,e.getCompare()):a=Rs;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,u)}addToIndexes(e,t){let i=Eo(this.indexes_,(r,s)=>{let o=zn(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),r===Rs)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(te.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Fu(a,o.getCompare())}else return Rs;else{let a=t.get(e.name),c=r;return a&&(c=c.remove(new te(e.name,a))),c.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=Eo(this.indexes_,r=>{if(r===Rs)return r;{let s=t.get(e.name);return s?r.remove(new te(e.name,s)):r}});return new n(i,this.indexSet_)}};var xa,X=(()=>{class n{static get EMPTY_NODE(){return xa||(xa=new n(new kt(c_),null,Vs.Default))}constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&K0(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||xa}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?xa:i}}getChild(t){let i=Z(t);return i===null?this:this.getImmediateChild(i).getChild(fe(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(O(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new te(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?xa:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=Z(t);if(r===null)return i;{O(Z(t)!==".priority"||Ci(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(fe(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(me,(a,c)=>{i[a]=c.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let c in i)a[c]=i[c];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+G0(this.getPriority().val())+":"),this.forEachChild(me,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":T0(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new te(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new te(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new te(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Za?-1:0}withIndex(t){if(t===dn||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===dn||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(me),s=i.getIterator(me),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===dn?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),mg=class extends X{constructor(){super(new kt(c_),X.EMPTY_NODE,Vs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return X.EMPTY_NODE}isEmpty(){return!1}},Za=new mg;Object.defineProperties(te,{MIN:{value:new te(Ai,X.EMPTY_NODE)},MAX:{value:new te(Fn,Za)}});Ou.__EMPTY_NODE=X.EMPTY_NODE;Ds.__childrenNodeConstructor=X;QP(Za);XP(Za);var ZP=!0;function Ee(n,e=null){if(n===null)return X.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Ds(t,Ee(e))}if(!(n instanceof Array)&&ZP){let t=[],i=!1;if($e(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=Ee(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new te(o,c)))}}),t.length===0)return X.EMPTY_NODE;let s=Fu(t,HP,o=>o.name,c_);if(i){let o=Fu(t,me.getCompare());return new X(s,Ee(e),new Vs({".priority":o},{".priority":me}))}else return new X(s,Ee(e),Vs.Default)}else{let t=X.EMPTY_NODE;return $e(n,(i,r)=>{if(St(n,i)&&i.substring(0,1)!=="."){let s=Ee(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(Ee(e))}}YP(Ee);var Ba=class extends ks{constructor(e){super(),this.indexPath_=e,O(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?vr(e.name,t.name):s}makePost(e,t){let i=Ee(e),r=X.EMPTY_NODE.updateChild(this.indexPath_,i);return new te(t,r)}maxPost(){let e=X.EMPTY_NODE.updateChild(this.indexPath_,Za);return new te(Fn,e)}toString(){return La(this.indexPath_,0).join("/")}};var gg=class extends ks{compare(e,t){let i=e.node.compareTo(t.node);return i===0?vr(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return te.MIN}maxPost(){return te.MAX}makePost(e,t){let i=Ee(e);return new te(t,i)}toString(){return".value"}},u_=new gg;function $0(n){return{type:"value",snapshotNode:n}}function Os(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ua(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function qa(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function ex(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var ja=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Ua(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Os(t,i)):o.trackChildChange(qa(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(me,(r,s)=>{t.hasChild(r)||i.trackChildChange(Ua(r,s))}),t.isLeafNode()||t.forEachChild(me,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(qa(r,s,o))}else i.trackChildChange(Os(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?X.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Mu=class n{constructor(e){this.indexedFilter_=new ja(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new te(t,i))||(i=X.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=X.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(X.EMPTY_NODE);let s=this;return t.forEachChild(me,(o,a)=>{s.matches(new te(o,a))||(r=r.updateImmediateChild(o,X.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var _g=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Mu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new te(t,i))||(i=X.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=X.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=X.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(X.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,X.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let p=this.index_.getCompare();o=(m,y)=>p(y,m)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let c=new te(t,i),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let p=a.getImmediateChild(t),m=r.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=r.getChildAfterChild(this.index_,m,this.reverse_);let y=m==null?1:o(m,c);if(d&&!i.isEmpty()&&y>=0)return s?.trackChildChange(qa(t,i,p)),a.updateImmediateChild(t,i);{s?.trackChildChange(Ua(t,p));let P=a.updateImmediateChild(t,X.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(s?.trackChildChange(Os(m.name,m.node)),P.updateImmediateChild(m.name,m.node)):P}}else return i.isEmpty()?e:d&&o(u,c)>=0?(s!=null&&(s.trackChildChange(Ua(u.name,u.node)),s.trackChildChange(Os(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(u.name,X.EMPTY_NODE)):e}};var Ga=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=me}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ai}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Fn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===me}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function tx(n){return n.loadsAllData()?new ja(n.getIndex()):n.hasLimit()?new _g(n):new Mu(n)}function nx(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function ix(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function yg(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function rx(n,e,t){let i;return n.index_===dn||t?i=yg(n,e,t):i=yg(n,e,Fn),i.startAfterSet_=!0,i}function vg(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function sx(n,e,t){let i;return n.index_===dn||t?i=vg(n,e,t):i=vg(n,e,Ai),i.endBeforeSet_=!0,i}function nh(n,e){let t=n.copy();return t.index_=e,t}function i0(n){let e={};if(n.isDefault())return e;let t;if(n.index_===me?t="$priority":n.index_===u_?t="$value":n.index_===dn?t="$key":(O(n.index_ instanceof Ba,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ve(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=Ve(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+Ve(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=Ve(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+Ve(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function r0(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==me&&(e.i=n.index_.toString()),e}var wg=class n extends ku{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Ja("p:rest:"),this.listens_={}}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let c=i0(e._queryParams);this.restRequest_(s+".json",c,(u,d)=>{let p=d;if(u===404&&(p=null,u=null),u===null&&this.onDataUpdate_(s,p,!1,i),zn(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",r(m,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=i0(e._queryParams),i=e._path.toString(),r=new ze;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ov(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Vl(a.responseText)}catch{rt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&rt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var Tg=class{constructor(){this.rootNode_=X.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Lu(){return{value:null,children:new Map}}function qs(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=Z(e);n.children.has(i)||n.children.set(i,Lu());let r=n.children.get(i);e=fe(e),qs(r,e,t)}}function Eg(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(me,(i,r)=>{qs(n,new ce(i),r)}),Eg(n,e)}}else if(n.children.size>0){let t=Z(e);return e=fe(e),n.children.has(t)&&Eg(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Ig(n,e,t){n.value!==null?t(e,n.value):ox(n,(i,r)=>{let s=new ce(e.toString()+"/"+i);Ig(r,s,t)})}function ox(n,e){n.children.forEach((t,i)=>{e(i,t)})}var Ag=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&$e(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var s0=10*1e3,ax=30*1e3,lx=5*60*1e3,Cg=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ag(e);let i=s0+(ax-s0)*Math.random();ka(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;$e(e,(r,s)=>{s>0&&St(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),ka(this.reportStats_.bind(this),Math.floor(Math.random()*2*lx))}};var hn=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(hn||{});function h_(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function d_(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function f_(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var bg=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=hn.ACK_USER_WRITE,this.source=h_()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ce(e));return new n(le(),t,this.revert)}}else return O(Z(this.path)===e,"operationForChild called for unrelated child."),new n(fe(this.path),this.affectedTree,this.revert)}};var Bu=class n{constructor(e,t){this.source=e,this.path=t,this.type=hn.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new n(this.source,le()):new n(this.source,fe(this.path))}};var Fs=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=hn.OVERWRITE}operationForChild(e){return ee(this.path)?new n(this.source,le(),this.snap.getImmediateChild(e)):new n(this.source,fe(this.path),this.snap)}};var Ka=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=hn.MERGE}operationForChild(e){if(ee(this.path)){let t=this.children.subtree(new ce(e));return t.isEmpty()?null:t.value?new Fs(this.source,le(),t.value):new n(this.source,le(),t)}else return O(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,fe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var pn=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Sg=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function cx(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(ex(o.childName,o.snapshotNode))}),Na(n,r,"child_removed",e,i,t),Na(n,r,"child_added",e,i,t),Na(n,r,"child_moved",s,i,t),Na(n,r,"child_changed",e,i,t),Na(n,r,"value",e,i,t),r}function Na(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,c)=>hx(n,a,c)),o.forEach(a=>{let c=ux(n,a,s);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function ux(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function hx(n,e,t){if(e.childName==null||t.childName==null)throw Pr("Should only compare child_ events.");let i=new te(e.childName,e.snapshotNode),r=new te(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function ih(n,e){return{eventCache:n,serverCache:e}}function Va(n,e,t,i){return ih(new pn(e,t,i),n.serverCache)}function H0(n,e,t,i){return ih(n.eventCache,new pn(e,t,i))}function Uu(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function yr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Qm,dx=()=>(Qm||(Qm=new kt(uP)),Qm),ht=class n{static fromObject(e){let t=new n(null);return $e(e,(i,r)=>{t=t.set(new ce(i),r)}),t}constructor(e,t=dx()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:le(),value:this.value};if(ee(e))return null;{let i=Z(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(fe(e),t);return s!=null?{path:ve(new ce(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{let t=Z(e),i=this.children.get(t);return i!==null?i.subtree(fe(e)):new n(null)}}set(e,t){if(ee(e))return new n(t,this.children);{let i=Z(e),s=(this.children.get(i)||new n(null)).set(fe(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Z(e),i=this.children.get(t);if(i){let r=i.remove(fe(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ee(e))return this.value;{let t=Z(e),i=this.children.get(t);return i?i.get(fe(e)):null}}setTree(e,t){if(ee(e))return t;{let i=Z(e),s=(this.children.get(i)||new n(null)).setTree(fe(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(le(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(ve(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,le(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(ee(e))return null;{let s=Z(e),o=this.children.get(s);return o?o.findOnPath_(fe(e),ve(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,le(),t)}foreachOnPath_(e,t,i){if(ee(e))return this;{this.value&&i(t,this.value);let r=Z(e),s=this.children.get(r);return s?s.foreachOnPath_(fe(e),ve(t,r),i):new n(null)}}foreach(e){this.foreach_(le(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(ve(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var $t=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new ht(null))}};function Oa(n,e,t){if(ee(e))return new $t(new ht(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=ut(r,e);return s=s.updateChild(o,t),new $t(n.writeTree_.set(r,s))}else{let r=new ht(t),s=n.writeTree_.setTree(e,r);return new $t(s)}}}function Rg(n,e,t){let i=n;return $e(t,(r,s)=>{i=Oa(i,ve(e,r),s)}),i}function o0(n,e){if(ee(e))return $t.empty();{let t=n.writeTree_.setTree(e,new ht(null));return new $t(t)}}function Pg(n,e){return wr(n,e)!=null}function wr(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ut(t.path,e)):null}function a0(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(me,(i,r)=>{e.push(new te(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new te(i,r.value))}),e}function Ei(n,e){if(ee(e))return n;{let t=wr(n,e);return t!=null?new $t(new ht(t)):new $t(n.writeTree_.subtree(e))}}function xg(n){return n.writeTree_.isEmpty()}function Ms(n,e){return Q0(le(),n.writeTree_,e)}function Q0(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=Q0(ve(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(ve(n,".priority"),i)),t}}function rh(n,e){return Z0(e,n)}function fx(n,e,t,i,r){O(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=Oa(n.visibleWrites,e,t)),n.lastWriteId=i}function px(n,e,t,i){O(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Rg(n.visibleWrites,e,t),n.lastWriteId=i}function mx(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function gx(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&_x(a,i.path)?r=!1:Nt(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return yx(n),!0;if(i.snap)n.visibleWrites=o0(n.visibleWrites,i.path);else{let a=i.children;$e(a,c=>{n.visibleWrites=o0(n.visibleWrites,ve(i.path,c))})}return!0}else return!1}function _x(n,e){if(n.snap)return Nt(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Nt(ve(n.path,t),e))return!0;return!1}function yx(n){n.visibleWrites=Y0(n.allWrites,vx,le()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function vx(n){return n.visible}function Y0(n,e,t){let i=$t.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)Nt(t,o)?(a=ut(t,o),i=Oa(i,a,s.snap)):Nt(o,t)&&(a=ut(o,t),i=Oa(i,le(),s.snap.getChild(a)));else if(s.children){if(Nt(t,o))a=ut(t,o),i=Rg(i,a,s.children);else if(Nt(o,t))if(a=ut(o,t),ee(a))i=Rg(i,le(),s.children);else{let c=zn(s.children,Z(a));if(c){let u=c.getChild(fe(a));i=Oa(i,le(),u)}}}else throw Pr("WriteRecord should have .snap or .children")}}return i}function X0(n,e,t,i,r){if(!i&&!r){let s=wr(n.visibleWrites,e);if(s!=null)return s;{let o=Ei(n.visibleWrites,e);if(xg(o))return t;if(t==null&&!Pg(o,le()))return null;{let a=t||X.EMPTY_NODE;return Ms(o,a)}}}else{let s=Ei(n.visibleWrites,e);if(!r&&xg(s))return t;if(!r&&t==null&&!Pg(s,le()))return null;{let o=function(u){return(u.visible||r)&&(!i||!~i.indexOf(u.writeId))&&(Nt(u.path,e)||Nt(e,u.path))},a=Y0(n.allWrites,o,e),c=t||X.EMPTY_NODE;return Ms(a,c)}}}function wx(n,e,t){let i=X.EMPTY_NODE,r=wr(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(me,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=Ei(n.visibleWrites,e);return t.forEachChild(me,(o,a)=>{let c=Ms(Ei(s,new ce(o)),a);i=i.updateImmediateChild(o,c)}),a0(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=Ei(n.visibleWrites,e);return a0(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Tx(n,e,t,i,r){O(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=ve(e,t);if(Pg(n.visibleWrites,s))return null;{let o=Ei(n.visibleWrites,s);return xg(o)?r.getChild(t):Ms(o,r.getChild(t))}}function Ex(n,e,t,i){let r=ve(e,t),s=wr(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=Ei(n.visibleWrites,r);return Ms(o,i.getNode().getImmediateChild(t))}else return null}function Ix(n,e){return wr(n.visibleWrites,e)}function Ax(n,e,t,i,r,s,o){let a,c=Ei(n.visibleWrites,e),u=wr(c,le());if(u!=null)a=u;else if(t!=null)a=Ms(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],p=o.getCompare(),m=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),y=m.getNext();for(;y&&d.length<r;)p(y,i)!==0&&d.push(y),y=m.getNext();return d}else return[]}function Cx(){return{visibleWrites:$t.empty(),allWrites:[],lastWriteId:-1}}function qu(n,e,t,i){return X0(n.writeTree,n.treePath,e,t,i)}function p_(n,e){return wx(n.writeTree,n.treePath,e)}function l0(n,e,t,i){return Tx(n.writeTree,n.treePath,e,t,i)}function ju(n,e){return Ix(n.writeTree,ve(n.treePath,e))}function bx(n,e,t,i,r,s){return Ax(n.writeTree,n.treePath,e,t,i,r,s)}function m_(n,e,t){return Ex(n.writeTree,n.treePath,e,t)}function J0(n,e){return Z0(ve(n.treePath,e),n.writeTree)}function Z0(n,e){return{treePath:n,writeTree:e}}var Ng=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,qa(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,Ua(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,Os(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,qa(i,e.snapshotNode,r.oldSnap));else throw Pr("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var kg=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},eA=new kg,za=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new pn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return m_(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:yr(this.viewCache_),s=bx(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function Sx(n){return{filter:n}}function Rx(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Px(n,e,t,i,r){let s=new Ng,o,a;if(t.type===hn.OVERWRITE){let u=t;u.source.fromUser?o=Dg(n,e,u.path,u.snap,i,r,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ee(u.path),o=Gu(n,e,u.path,u.snap,i,r,a,s))}else if(t.type===hn.MERGE){let u=t;u.source.fromUser?o=Nx(n,e,u.path,u.children,i,r,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=Vg(n,e,u.path,u.children,i,r,a,s))}else if(t.type===hn.ACK_USER_WRITE){let u=t;u.revert?o=Vx(n,e,u.path,i,r,s):o=kx(n,e,u.path,u.affectedTree,i,r,s)}else if(t.type===hn.LISTEN_COMPLETE)o=Dx(n,e,t.path,i,s);else throw Pr("Unknown operation type: "+t.type);let c=s.getChanges();return xx(e,o,c),{viewCache:o,changes:c}}function xx(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Uu(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push($0(Uu(e)))}}function tA(n,e,t,i,r,s){let o=e.eventCache;if(ju(i,t)!=null)return e;{let a,c;if(ee(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=yr(e),d=u instanceof X?u:X.EMPTY_NODE,p=p_(i,d);a=n.filter.updateFullNode(e.eventCache.getNode(),p,s)}else{let u=qu(i,yr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{let u=Z(t);if(u===".priority"){O(Ci(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let p=l0(i,t,d,c);p!=null?a=n.filter.updatePriority(d,p):a=o.getNode()}else{let d=fe(t),p;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let m=l0(i,t,o.getNode(),c);m!=null?p=o.getNode().getImmediateChild(u).updateChild(d,m):p=o.getNode().getImmediateChild(u)}else p=m_(i,u,e.serverCache);p!=null?a=n.filter.updateChild(o.getNode(),u,p,d,r,s):a=o.getNode()}}return Va(e,a,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function Gu(n,e,t,i,r,s,o,a){let c=e.serverCache,u,d=o?n.filter:n.filter.getIndexedFilter();if(ee(t))u=d.updateFullNode(c.getNode(),i,null);else if(d.filtersNodes()&&!c.isFiltered()){let y=c.getNode().updateChild(t,i);u=d.updateFullNode(c.getNode(),y,null)}else{let y=Z(t);if(!c.isCompleteForPath(t)&&Ci(t)>1)return e;let C=fe(t),k=c.getNode().getImmediateChild(y).updateChild(C,i);y===".priority"?u=d.updatePriority(c.getNode(),k):u=d.updateChild(c.getNode(),y,k,C,eA,null)}let p=H0(e,u,c.isFullyInitialized()||ee(t),d.filtersNodes()),m=new za(r,p,s);return tA(n,p,t,r,m,a)}function Dg(n,e,t,i,r,s,o){let a=e.eventCache,c,u,d=new za(r,e,s);if(ee(t))u=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=Va(e,u,!0,n.filter.filtersNodes());else{let p=Z(t);if(p===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),i),c=Va(e,u,a.isFullyInitialized(),a.isFiltered());else{let m=fe(t),y=a.getNode().getImmediateChild(p),C;if(ee(m))C=i;else{let P=d.getCompleteChild(p);P!=null?o_(m)===".priority"&&P.getChild(q0(m)).isEmpty()?C=P:C=P.updateChild(m,i):C=X.EMPTY_NODE}if(y.equals(C))c=e;else{let P=n.filter.updateChild(a.getNode(),p,C,m,d,o);c=Va(e,P,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function c0(n,e){return n.eventCache.isCompleteForChild(e)}function Nx(n,e,t,i,r,s,o){let a=e;return i.foreach((c,u)=>{let d=ve(t,c);c0(e,Z(d))&&(a=Dg(n,a,d,u,r,s,o))}),i.foreach((c,u)=>{let d=ve(t,c);c0(e,Z(d))||(a=Dg(n,a,d,u,r,s,o))}),a}function u0(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function Vg(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;ee(t)?u=i:u=new ht(null).setTree(t,i);let d=e.serverCache.getNode();return u.children.inorderTraversal((p,m)=>{if(d.hasChild(p)){let y=e.serverCache.getNode().getImmediateChild(p),C=u0(n,y,m);c=Gu(n,c,new ce(p),C,r,s,o,a)}}),u.children.inorderTraversal((p,m)=>{let y=!e.serverCache.isCompleteForChild(p)&&m.value===null;if(!d.hasChild(p)&&!y){let C=e.serverCache.getNode().getImmediateChild(p),P=u0(n,C,m);c=Gu(n,c,new ce(p),P,r,s,o,a)}}),c}function kx(n,e,t,i,r,s,o){if(ju(r,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(ee(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Gu(n,e,t,c.getNode().getChild(t),r,s,a,o);if(ee(t)){let u=new ht(null);return c.getNode().forEachChild(dn,(d,p)=>{u=u.set(new ce(d),p)}),Vg(n,e,t,u,r,s,a,o)}else return e}else{let u=new ht(null);return i.foreach((d,p)=>{let m=ve(t,d);c.isCompleteForPath(m)&&(u=u.set(d,c.getNode().getChild(m)))}),Vg(n,e,t,u,r,s,a,o)}}function Dx(n,e,t,i,r){let s=e.serverCache,o=H0(e,s.getNode(),s.isFullyInitialized()||ee(t),s.isFiltered());return tA(n,o,t,i,eA,r)}function Vx(n,e,t,i,r,s){let o;if(ju(i,t)!=null)return e;{let a=new za(i,e,r),c=e.eventCache.getNode(),u;if(ee(t)||Z(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=qu(i,yr(e));else{let p=e.serverCache.getNode();O(p instanceof X,"serverChildren would be complete if leaf node"),d=p_(i,p)}d=d,u=n.filter.updateFullNode(c,d,s)}else{let d=Z(t),p=m_(i,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?u=n.filter.updateChild(c,d,p,fe(t),a,s):e.eventCache.getNode().hasChild(d)?u=n.filter.updateChild(c,d,X.EMPTY_NODE,fe(t),a,s):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=qu(i,yr(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||ju(i,le())!=null,Va(e,u,o,n.filter.filtersNodes())}}var Og=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new ja(i.getIndex()),s=tx(i);this.processor_=Sx(s);let o=t.serverCache,a=t.eventCache,c=r.updateFullNode(X.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(X.EMPTY_NODE,a.getNode(),null),d=new pn(c,o.isFullyInitialized(),r.filtersNodes()),p=new pn(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=ih(p,d),this.eventGenerator_=new Sg(this.query_)}get query(){return this.query_}};function Ox(n){return n.viewCache_.serverCache.getNode()}function Fx(n){return Uu(n.viewCache_)}function Mx(n,e){let t=yr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function h0(n){return n.eventRegistrations_.length===0}function Lx(n,e){n.eventRegistrations_.push(e)}function d0(n,e,t){let i=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function f0(n,e,t,i){e.type===hn.MERGE&&e.source.queryId!==null&&(O(yr(n.viewCache_),"We should always have a full cache before handling merges"),O(Uu(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=Px(n.processor_,r,e,t,i);return Rx(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,nA(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Bx(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(me,(s,o)=>{i.push(Os(s,o))}),t.isFullyInitialized()&&i.push($0(t.getNode())),nA(n,i,t.getNode(),e)}function nA(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return cx(n.eventGenerator_,e,t,r)}var Ku,zu=class{constructor(){this.views=new Map}};function Ux(n){O(!Ku,"__referenceConstructor has already been defined"),Ku=n}function qx(){return O(Ku,"Reference.ts has not been loaded"),Ku}function jx(n){return n.views.size===0}function g_(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return O(s!=null,"SyncTree gave us an op for an invalid query."),f0(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(f0(o,e,t,i));return s}}function iA(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=qu(t,r?i:null),c=!1;a?c=!0:i instanceof X?(a=p_(t,i),c=!1):(a=X.EMPTY_NODE,c=!1);let u=ih(new pn(a,c,!1),new pn(i,r,!1));return new Og(e,u)}return o}function Gx(n,e,t,i,r,s){let o=iA(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Lx(o,t),Bx(o,t)}function Kx(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=bi(n);if(r==="default")for(let[c,u]of n.views.entries())o=o.concat(d0(u,t,i)),h0(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{let c=n.views.get(r);c&&(o=o.concat(d0(c,t,i)),h0(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!bi(n)&&s.push(new(qx())(e._repo,e._path)),{removed:s,events:o}}function rA(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ii(n,e){let t=null;for(let i of n.views.values())t=t||Mx(i,e);return t}function sA(n,e){if(e._queryParams.loadsAllData())return sh(n);{let i=e._queryIdentifier;return n.views.get(i)}}function oA(n,e){return sA(n,e)!=null}function bi(n){return sh(n)!=null}function sh(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Wu;function zx(n){O(!Wu,"__referenceConstructor has already been defined"),Wu=n}function Wx(){return O(Wu,"Reference.ts has not been loaded"),Wu}var $x=1,$u=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ht(null),this.pendingWriteTree_=Cx(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function __(n,e,t,i,r){return fx(n.pendingWriteTree_,e,t,i,r),r?js(n,new Fs(h_(),e,t)):[]}function Hx(n,e,t,i){px(n.pendingWriteTree_,e,t,i);let r=ht.fromObject(t);return js(n,new Ka(h_(),e,r))}function Ti(n,e,t=!1){let i=mx(n.pendingWriteTree_,e);if(gx(n.pendingWriteTree_,e)){let s=new ht(null);return i.snap!=null?s=s.set(le(),!0):$e(i.children,o=>{s=s.set(new ce(o),!0)}),js(n,new bg(i.path,s,t))}else return[]}function el(n,e,t){return js(n,new Fs(d_(),e,t))}function Qx(n,e,t){let i=ht.fromObject(t);return js(n,new Ka(d_(),e,i))}function Yx(n,e){return js(n,new Bu(d_(),e))}function Xx(n,e,t){let i=y_(n,t);if(i){let r=v_(i),s=r.path,o=r.queryId,a=ut(s,e),c=new Bu(f_(o),a);return w_(n,s,c)}else return[]}function Hu(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||oA(o,e))){let c=Kx(o,e,t,i);jx(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let u=c.removed;if(a=c.events,!r){let d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(s,(m,y)=>bi(y));if(d&&!p){let m=n.syncPointTree_.subtree(s);if(!m.isEmpty()){let y=eN(m);for(let C=0;C<y.length;++C){let P=y[C],k=P.query,q=uA(n,P);n.listenProvider_.startListening(Fa(k),Wa(n,k),q.hashFn,q.onComplete)}}}!p&&u.length>0&&!i&&(d?n.listenProvider_.stopListening(Fa(e),null):u.forEach(m=>{let y=n.queryToTagMap.get(ah(m));n.listenProvider_.stopListening(Fa(m),y)}))}tN(n,u)}return a}function aA(n,e,t,i){let r=y_(n,i);if(r!=null){let s=v_(r),o=s.path,a=s.queryId,c=ut(o,e),u=new Fs(f_(a),c,t);return w_(n,o,u)}else return[]}function Jx(n,e,t,i){let r=y_(n,i);if(r){let s=v_(r),o=s.path,a=s.queryId,c=ut(o,e),u=ht.fromObject(t),d=new Ka(f_(a),c,u);return w_(n,o,d)}else return[]}function Fg(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(m,y)=>{let C=ut(m,r);s=s||Ii(y,C),o=o||bi(y)});let a=n.syncPointTree_.get(r);a?(o=o||bi(a),s=s||Ii(a,le())):(a=new zu,n.syncPointTree_=n.syncPointTree_.set(r,a));let c;s!=null?c=!0:(c=!1,s=X.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((y,C)=>{let P=Ii(C,le());P&&(s=s.updateImmediateChild(y,P))}));let u=oA(a,e);if(!u&&!e._queryParams.loadsAllData()){let m=ah(e);O(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");let y=nN();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}let d=rh(n.pendingWriteTree_,r),p=Gx(a,e,t,d,s,c);if(!u&&!o&&!i){let m=sA(a,e);p=p.concat(iN(n,e,m))}return p}function oh(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=ut(o,e),u=Ii(a,c);if(u)return u});return X0(r,e,s,t,!0)}function Zx(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(u,d)=>{let p=ut(u,t);i=i||Ii(d,p)});let r=n.syncPointTree_.get(t);r?i=i||Ii(r,le()):(r=new zu,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new pn(i,!0,!1):null,a=rh(n.pendingWriteTree_,e._path),c=iA(r,e,a,s?o.getNode():X.EMPTY_NODE,s);return Fx(c)}function js(n,e){return lA(e,n.syncPointTree_,null,rh(n.pendingWriteTree_,le()))}function lA(n,e,t,i){if(ee(n.path))return cA(n,e,t,i);{let r=e.get(le());t==null&&r!=null&&(t=Ii(r,le()));let s=[],o=Z(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=J0(i,o);s=s.concat(lA(a,c,u,d))}return r&&(s=s.concat(g_(r,n,i,t))),s}}function cA(n,e,t,i){let r=e.get(le());t==null&&r!=null&&(t=Ii(r,le()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=J0(i,o),d=n.operationForChild(o);d&&(s=s.concat(cA(d,a,c,u)))}),r&&(s=s.concat(g_(r,n,i,t))),s}function uA(n,e){let t=e.query,i=Wa(n,t);return{hashFn:()=>(Ox(e)||X.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?Xx(n,t._path,i):Yx(n,t._path);{let s=fP(r,t);return Hu(n,t,null,s)}}}}function Wa(n,e){let t=ah(e);return n.queryToTagMap.get(t)}function ah(n){return n._path.toString()+"$"+n._queryIdentifier}function y_(n,e){return n.tagToQueryMap.get(e)}function v_(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ce(n.substr(0,e))}}function w_(n,e,t){let i=n.syncPointTree_.get(e);O(i,"Missing sync point for query tag that we're tracking");let r=rh(n.pendingWriteTree_,e);return g_(i,t,r,null)}function eN(n){return n.fold((e,t,i)=>{if(t&&bi(t))return[sh(t)];{let r=[];return t&&(r=rA(t)),$e(i,(s,o)=>{r=r.concat(o)}),r}})}function Fa(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Wx())(n._repo,n._path):n}function tN(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=ah(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function nN(){return $x++}function iN(n,e,t){let i=e._path,r=Wa(n,e),s=uA(n,t),o=n.listenProvider_.startListening(Fa(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)O(!bi(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,p)=>{if(!ee(u)&&d&&bi(d))return[sh(d).query];{let m=[];return d&&(m=m.concat(rA(d).map(y=>y.query))),$e(p,(y,C)=>{m=m.concat(C)}),m}});for(let u=0;u<c.length;++u){let d=c[u];n.listenProvider_.stopListening(Fa(d),Wa(n,d))}}return o}var Mg=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Lg=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ve(this.path_,e);return new n(this.syncTree_,t)}node(){return oh(this.syncTree_,this.path_)}},rN=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},p0=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return sN(n[".sv"],e,t);if(typeof n[".sv"]=="object")return oN(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},sN=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},oN=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&O(!1,"Unexpected increment value: "+i);let r=e.node();if(O(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},hA=function(n,e,t,i){return E_(e,new Lg(t,n),i)},T_=function(n,e,t){return E_(n,new Mg(e),t)};function E_(n,e,t){let i=n.getPriority().val(),r=p0(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=p0(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Ds(a,Ee(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new Ds(r))),o.forEachChild(me,(a,c)=>{let u=E_(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}var $a=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function lh(n,e){let t=e instanceof ce?e:new ce(e),i=n,r=Z(t);for(;r!==null;){let s=zn(i.node.children,r)||{children:{},childCount:0};i=new $a(r,i,s),t=fe(t),r=Z(t)}return i}function Tr(n){return n.node.value}function I_(n,e){n.node.value=e,Bg(n)}function dA(n){return n.node.childCount>0}function aN(n){return Tr(n)===void 0&&!dA(n)}function ch(n,e){$e(n.node.children,(t,i)=>{e(new $a(t,n,i))})}function fA(n,e,t,i){t&&!i&&e(n),ch(n,r=>{fA(r,e,!0,i)}),t&&i&&e(n)}function lN(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function tl(n){return new ce(n.parent===null?n.name:tl(n.parent)+"/"+n.name)}function Bg(n){n.parent!==null&&cN(n.parent,n.name,n)}function cN(n,e,t){let i=aN(t),r=St(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,Bg(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Bg(n))}var uN=/[\[\].#$\/\u0000-\u001F\u007F]/,hN=/[\[\].#$\u0000-\u001F\u007F]/,Ym=10*1024*1024,uh=function(n){return typeof n=="string"&&n.length!==0&&!uN.test(n)},pA=function(n){return typeof n=="string"&&n.length!==0&&!hN.test(n)},dN=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),pA(n)},Ha=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!th(n)||n&&typeof n=="object"&&St(n,".sv")},mn=function(n,e,t,i){i&&e===void 0||nl(ft(n,"value"),e,t)},nl=function(n,e,t){let i=t instanceof ce?new cg(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+mr(i));if(typeof e=="function")throw new Error(n+"contains a function "+mr(i)+" with contents = "+e.toString());if(th(e))throw new Error(n+"contains "+e.toString()+" "+mr(i));if(typeof e=="string"&&e.length>Ym/3&&Io(e)>Ym)throw new Error(n+"contains a string greater than "+Ym+" utf8 bytes "+mr(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if($e(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!uh(o)))throw new Error(n+" contains an invalid key ("+o+") "+mr(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);jP(i,o),nl(n,a,i),GP(i)}),r&&s)throw new Error(n+' contains ".value" child '+mr(i)+" in addition to actual children.")}},fN=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=La(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!uh(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(qP);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&Nt(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},mA=function(n,e,t,i){if(i&&e===void 0)return;let r=ft(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];$e(e,(o,a)=>{let c=new ce(o);if(nl(r,a,ve(t,c)),o_(c)===".priority"&&!Ha(a))throw new Error(r+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),fN(r,s)},A_=function(n,e,t){if(!(t&&e===void 0)){if(th(e))throw new Error(ft(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ha(e))throw new Error(ft(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},il=function(n,e,t,i){if(!(i&&t===void 0)&&!uh(t))throw new Error(ft(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Gs=function(n,e,t,i){if(!(i&&t===void 0)&&!pA(t))throw new Error(ft(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},pN=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gs(n,e,t,i)},Et=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},gA=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!uh(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!dN(t))throw new Error(ft(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Ug=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function hh(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!a_(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function _A(n,e,t){hh(n,t),yA(n,i=>a_(i,e))}function It(n,e,t){hh(n,t),yA(n,i=>Nt(i,e)||Nt(e,i))}function yA(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(mN(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function mN(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();_r&&We("event: "+t.toString()),Us(i)}}}var vA="repo_interrupt",gN=25,qg=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ug,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Lu(),this.transactionQueueTree_=new $a,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function _N(n,e,t){if(n.stats_=s_(n.repoInfo_),n.forceRestClient_||_P())n.server_=new wg(n.repoInfo_,(i,r,s,o)=>{m0(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>g0(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ve(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new l_(n.repoInfo_,e,(i,r,s,o)=>{m0(n,i,r,s,o)},i=>{g0(n,i)},i=>{yN(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=vP(n.repoInfo_,()=>new Cg(n.stats_,n.server_)),n.infoData_=new Tg,n.infoSyncTree_=new $u({startListening:(i,r,s,o)=>{let a=[],c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=el(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),C_(n,"connected",!1),n.serverSyncTree_=new $u({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{let u=o(a,c);It(n.eventQueue_,i._path,u)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function wA(n){let t=n.infoData_.getNode(new ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function rl(n){return rN({timestamp:wA(n)})}function m0(n,e,t,i,r){n.dataUpdateCount++;let s=new ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let c=Eo(t,u=>Ee(u));o=Jx(n.serverSyncTree_,s,c,r)}else{let c=Ee(t);o=aA(n.serverSyncTree_,s,c,r)}else if(i){let c=Eo(t,u=>Ee(u));o=Qx(n.serverSyncTree_,s,c)}else{let c=Ee(t);o=el(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=Ls(n,s)),It(n.eventQueue_,a,o)}function g0(n,e){C_(n,"connected",e),e===!1&&TN(n)}function yN(n,e){$e(e,(t,i)=>{C_(n,t,i)})}function C_(n,e,t){let i=new ce("/.info/"+e),r=Ee(t);n.infoData_.updateSnapshot(i,r);let s=el(n.infoSyncTree_,i,r);It(n.eventQueue_,i,s)}function dh(n){return n.nextWriteId_++}function vN(n,e,t){let i=Zx(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=Ee(r).withIndex(e._queryParams.getIndex());Fg(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=el(n.serverSyncTree_,e._path,s);else{let a=Wa(n.serverSyncTree_,e);o=aA(n.serverSyncTree_,e._path,s,a)}return It(n.eventQueue_,e._path,o),Hu(n.serverSyncTree_,e,t,null,!0),s},r=>(Ks(n,"get for query "+Ve(e)+" failed: "+r),Promise.reject(new Error(r))))}function b_(n,e,t,i,r){Ks(n,"set",{path:e.toString(),value:t,priority:i});let s=rl(n),o=Ee(t,i),a=oh(n.serverSyncTree_,e),c=T_(o,a,s),u=dh(n),d=__(n.serverSyncTree_,e,c,u,!0);hh(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(m,y)=>{let C=m==="ok";C||rt("set at "+e+" failed: "+m);let P=Ti(n.serverSyncTree_,u,!C);It(n.eventQueue_,e,P),Si(n,r,m,y)});let p=R_(n,e);Ls(n,p),It(n.eventQueue_,p,[])}function wN(n,e,t,i){Ks(n,"update",{path:e.toString(),value:t});let r=!0,s=rl(n),o={};if($e(t,(a,c)=>{r=!1,o[a]=hA(ve(e,a),Ee(c),n.serverSyncTree_,s)}),r)We("update() called with empty data.  Don't do anything."),Si(n,i,"ok",void 0);else{let a=dh(n),c=Hx(n.serverSyncTree_,e,o,a);hh(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,d)=>{let p=u==="ok";p||rt("update at "+e+" failed: "+u);let m=Ti(n.serverSyncTree_,a,!p),y=m.length>0?Ls(n,e):e;It(n.eventQueue_,y,m),Si(n,i,u,d)}),$e(t,u=>{let d=R_(n,ve(e,u));Ls(n,d)}),It(n.eventQueue_,e,[])}}function TN(n){Ks(n,"onDisconnectEvents");let e=rl(n),t=Lu();Ig(n.onDisconnect_,le(),(r,s)=>{let o=hA(r,s,n.serverSyncTree_,e);qs(t,r,o)});let i=[];Ig(t,le(),(r,s)=>{i=i.concat(el(n.serverSyncTree_,r,s));let o=R_(n,r);Ls(n,o)}),n.onDisconnect_=Lu(),It(n.eventQueue_,le(),i)}function EN(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&Eg(n.onDisconnect_,e),Si(n,t,i,r)})}function _0(n,e,t,i){let r=Ee(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&qs(n.onDisconnect_,e,r),Si(n,i,s,o)})}function IN(n,e,t,i,r){let s=Ee(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&qs(n.onDisconnect_,e,s),Si(n,r,o,a)})}function AN(n,e,t,i){if(Ol(t)){We("onDisconnect().update() called with empty data.  Don't do anything."),Si(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&$e(t,(o,a)=>{let c=Ee(a);qs(n.onDisconnect_,ve(e,o),c)}),Si(n,i,r,s)})}function CN(n,e,t){let i;Z(e._path)===".info"?i=Fg(n.infoSyncTree_,e,t):i=Fg(n.serverSyncTree_,e,t),_A(n.eventQueue_,e._path,i)}function jg(n,e,t){let i;Z(e._path)===".info"?i=Hu(n.infoSyncTree_,e,t):i=Hu(n.serverSyncTree_,e,t),_A(n.eventQueue_,e._path,i)}function TA(n){n.persistentConnection_&&n.persistentConnection_.interrupt(vA)}function bN(n){n.persistentConnection_&&n.persistentConnection_.resume(vA)}function Ks(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),We(t,...e)}function Si(n,e,t,i){e&&Us(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function SN(n,e,t,i,r,s){Ks(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:w0(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=S_(n,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{nl("transaction failed: Data returned ",c,o.path),o.status=0;let u=lh(n.transactionQueueTree_,e),d=Tr(u)||[];d.push(o),I_(u,d);let p;typeof c=="object"&&c!==null&&St(c,".priority")?(p=zn(c,".priority"),O(Ha(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(oh(n.serverSyncTree_,e)||X.EMPTY_NODE).getPriority().val();let m=rl(n),y=Ee(c,p),C=T_(y,a,m);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=C,o.currentWriteId=dh(n);let P=__(n.serverSyncTree_,e,C,o.currentWriteId,o.applyLocally);It(n.eventQueue_,e,P),fh(n,n.transactionQueueTree_)}}function S_(n,e,t){return oh(n.serverSyncTree_,e,t)||X.EMPTY_NODE}function fh(n,e=n.transactionQueueTree_){if(e||ph(n,e),Tr(e)){let t=IA(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&RN(n,tl(e),t)}else dA(e)&&ch(e,t=>{fh(n,t)})}function RN(n,e,t){let i=t.map(u=>u.currentWriteId),r=S_(n,e,i),s=r,o=r.hash();for(let u=0;u<t.length;u++){let d=t[u];O(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let p=ut(e,d.path);s=s.updateChild(p,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Ks(n,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let p=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat(Ti(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&p.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();ph(n,lh(n.transactionQueueTree_,e)),fh(n,n.transactionQueueTree_),It(n.eventQueue_,e,d);for(let m=0;m<p.length;m++)Us(p[m])}else{if(u==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{rt("transaction at "+c.toString()+" failed: "+u);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=u}Ls(n,e)}},o)}function Ls(n,e){let t=EA(n,e),i=tl(t),r=IA(n,t);return PN(n,r,i),i}function PN(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=ut(t,c.path),d=!1,p;if(O(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,r=r.concat(Ti(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=gN)d=!0,p="maxretry",r=r.concat(Ti(n.serverSyncTree_,c.currentWriteId,!0));else{let m=S_(n,c.path,o);c.currentInputSnapshot=m;let y=e[a].update(m.val());if(y!==void 0){nl("transaction failed: Data returned ",y,c.path);let C=Ee(y);typeof y=="object"&&y!=null&&St(y,".priority")||(C=C.updatePriority(m.getPriority()));let k=c.currentWriteId,q=rl(n),j=T_(C,m,q);c.currentOutputSnapshotRaw=C,c.currentOutputSnapshotResolved=j,c.currentWriteId=dh(n),o.splice(o.indexOf(k),1),r=r.concat(__(n.serverSyncTree_,c.path,j,c.currentWriteId,c.applyLocally)),r=r.concat(Ti(n.serverSyncTree_,k,!0))}else d=!0,p="nodata",r=r.concat(Ti(n.serverSyncTree_,c.currentWriteId,!0))}It(n.eventQueue_,t,r),r=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(p==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(p),!1,null))))}ph(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Us(i[a]);fh(n,n.transactionQueueTree_)}function EA(n,e){let t,i=n.transactionQueueTree_;for(t=Z(e);t!==null&&Tr(i)===void 0;)i=lh(i,t),e=fe(e),t=Z(e);return i}function IA(n,e){let t=[];return AA(n,e,t),t.sort((i,r)=>i.order-r.order),t}function AA(n,e,t){let i=Tr(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);ch(e,r=>{AA(n,r,t)})}function ph(n,e){let t=Tr(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,I_(e,t.length>0?t:void 0)}ch(e,i=>{ph(n,i)})}function R_(n,e){let t=tl(EA(n,e)),i=lh(n.transactionQueueTree_,e);return lN(i,r=>{Xm(n,r)}),Xm(n,i),fA(i,r=>{Xm(n,r)}),t}function Xm(n,e){let t=Tr(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Ti(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?I_(e,void 0):t.length=s+1,It(n.eventQueue_,tl(e),r);for(let o=0;o<i.length;o++)Us(i[o])}}function xN(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function NN(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):rt(`Invalid query segment '${t}' in query '${n}'`)}return e}var Gg=function(n,e){let t=kN(n),i=t.namespace;t.domain==="firebase.com"&&fn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&fn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||lP();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new xu(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new ce(t.pathString)}},kN=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(r=xN(n.substring(d,p)));let m=NN(n.substring(Math.min(n.length,p)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let C=e.indexOf(".");i=e.substring(0,C).toLowerCase(),t=e.substring(C+1),s=i}"ns"in m&&(s=m.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var y0="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",DN=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=y0.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=y0.charAt(e[r]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var Qu=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ve(this.snapshot.exportVal())}},Yu=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Qa=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Xu=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new ze;return EN(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Et("OnDisconnect.remove",this._path);let e=new ze;return _0(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Et("OnDisconnect.set",this._path),mn("OnDisconnect.set",e,this._path,!1);let t=new ze;return _0(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Et("OnDisconnect.setWithPriority",this._path),mn("OnDisconnect.setWithPriority",e,this._path,!1),A_("OnDisconnect.setWithPriority",t,!1);let i=new ze;return IN(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Et("OnDisconnect.update",this._path),mA("OnDisconnect.update",e,this._path,!1);let t=new ze;return AN(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var dt=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return ee(this._path)?null:o_(this._path)}get ref(){return new At(this._repo,this._path)}get _queryIdentifier(){let e=r0(this._queryParams),t=r_(e);return t==="{}"?"default":t}get _queryObject(){return r0(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=a_(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+UP(this._path)}};function mh(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Pi(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===dn){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Ai)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==Fn)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===me){if(e!=null&&!Ha(e)||t!=null&&!Ha(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof Ba||n.getIndex()===u_,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function gh(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var At=class n extends dt{constructor(e,t){super(e,t,new Ga,!1)}get parent(){let e=q0(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Bs=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ce(e),i=Ri(this.ref,e);return new n(this._node.getChild(t),i,me)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,Ri(this.ref,i),me)))}hasChild(e){let t=new ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function P_(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?Ri(n._root,e):n._root}function x_(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=Gg(e,n._repo.repoInfo_.nodeAdmin);gA("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&fn("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),P_(n,t.path.toString())}function Ri(n,e){return n=ne(n),Z(n._path)===null?pN("child","path",e,!1):Gs("child","path",e,!1),new At(n._repo,ve(n._path,e))}function CA(n,e){n=ne(n),Et("push",n._path),mn("push",e,n._path,!0);let t=wA(n._repo),i=DN(t),r=Ri(n,i),s=Ri(n,i),o;return e!=null?o=_h(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function bA(n){return Et("remove",n._path),_h(n,null)}function _h(n,e){n=ne(n),Et("set",n._path),mn("set",e,n._path,!1);let t=new ze;return b_(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function SA(n,e){n=ne(n),Et("setPriority",n._path),A_("setPriority",e,!1);let t=new ze;return b_(n._repo,ve(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function RA(n,e,t){if(Et("setWithPriority",n._path),mn("setWithPriority",e,n._path,!1),A_("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new ze;return b_(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function PA(n,e){mA("update",e,n._path,!1);let t=new ze;return wN(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function xA(n){n=ne(n);let e=new Qa(()=>{}),t=new Ya(e);return vN(n._repo,n,t).then(i=>new Bs(i,new At(n._repo,n._path),n._queryParams.getIndex()))}var Ya=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Qu("value",this,new Bs(e.snapshotNode,new At(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Yu(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Ju=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Yu(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let i=Ri(new At(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Qu(e.type,this,new Bs(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function sl(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let c=t,u=(d,p)=>{jg(n._repo,n,a),c(d,p)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new Qa(t,s||void 0),a=e==="value"?new Ya(o):new Ju(e,o);return CN(n._repo,n,a),()=>jg(n._repo,n,a)}function yh(n,e,t,i){return sl(n,"value",e,t,i)}function N_(n,e,t,i){return sl(n,"child_added",e,t,i)}function k_(n,e,t,i){return sl(n,"child_changed",e,t,i)}function D_(n,e,t,i){return sl(n,"child_moved",e,t,i)}function V_(n,e,t,i){return sl(n,"child_removed",e,t,i)}function O_(n,e,t){let i=null,r=t?new Qa(t):null;e==="value"?i=new Ya(r):e&&(i=new Ju(e,r)),jg(n._repo,n,i)}var Ct=class{},Zu=class extends Ct{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){mn("endAt",this._value,e._path,!0);let t=vg(e._queryParams,this._value,this._key);if(gh(t),Pi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new dt(e._repo,e._path,t,e._orderByCalled)}};function NA(n,e){return il("endAt","key",e,!0),new Zu(n,e)}var Kg=class extends Ct{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){mn("endBefore",this._value,e._path,!1);let t=sx(e._queryParams,this._value,this._key);if(gh(t),Pi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new dt(e._repo,e._path,t,e._orderByCalled)}};function kA(n,e){return il("endBefore","key",e,!0),new Kg(n,e)}var eh=class extends Ct{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){mn("startAt",this._value,e._path,!0);let t=yg(e._queryParams,this._value,this._key);if(gh(t),Pi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new dt(e._repo,e._path,t,e._orderByCalled)}};function DA(n=null,e){return il("startAt","key",e,!0),new eh(n,e)}var zg=class extends Ct{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){mn("startAfter",this._value,e._path,!1);let t=rx(e._queryParams,this._value,this._key);if(gh(t),Pi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new dt(e._repo,e._path,t,e._orderByCalled)}};function VA(n,e){return il("startAfter","key",e,!0),new zg(n,e)}var Wg=class extends Ct{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new dt(e._repo,e._path,nx(e._queryParams,this._limit),e._orderByCalled)}};function OA(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Wg(n)}var $g=class extends Ct{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new dt(e._repo,e._path,ix(e._queryParams,this._limit),e._orderByCalled)}};function FA(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new $g(n)}var Hg=class extends Ct{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){mh(e,"orderByChild");let t=new ce(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new Ba(t),r=nh(e._queryParams,i);return Pi(r),new dt(e._repo,e._path,r,!0)}};function MA(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Gs("orderByChild","path",n,!1),new Hg(n)}var Qg=class extends Ct{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){mh(e,"orderByKey");let t=nh(e._queryParams,dn);return Pi(t),new dt(e._repo,e._path,t,!0)}};function LA(){return new Qg}var Yg=class extends Ct{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){mh(e,"orderByPriority");let t=nh(e._queryParams,me);return Pi(t),new dt(e._repo,e._path,t,!0)}};function BA(){return new Yg}var Xg=class extends Ct{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){mh(e,"orderByValue");let t=nh(e._queryParams,u_);return Pi(t),new dt(e._repo,e._path,t,!0)}};function UA(){return new Xg}var Jg=class extends Ct{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(mn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Zu(this._value,this._key)._apply(new eh(this._value,this._key)._apply(e))}};function qA(n,e){return il("equalTo","key",e,!0),new Jg(n,e)}function Dt(n,...e){let t=ne(n);for(let i of e)t=i._apply(t);return t}Ux(At);zx(At);var VN="FIREBASE_DATABASE_EMULATOR_HOST",Zg={},ON=!1;function FN(n,e,t,i){n.repoInfo_=new xu(e,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function F_(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||fn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),We("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Gg(s,r),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[VN]),u?(c=!0,s=`http://${u}?ns=${a.namespace}`,o=Gg(s,r),a=o.repoInfo):c=!o.repoInfo.secure;let d=r&&c?new Da(Da.OWNER):new ig(n.name,n.options,e);gA("Invalid Firebase Database URL",o),ee(o.path)||fn("Database URL must point to the root of a Firebase Database (not including a child path).");let p=LN(a,n,d,new ng(n,t));return new e_(p,n)}function MN(n,e){let t=Zg[e];(!t||t[n.key]!==n)&&fn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),TA(n),delete t[n.key]}function LN(n,e,t,i){let r=Zg[e.name];r||(r={},Zg[e.name]=r);let s=r[n.toURLString()];return s&&fn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new qg(n,ON,t,i),r[n.toURLString()]=s,s}var e_=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(_N(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new At(this._repo,le())),this._rootInternal}_delete(){return this._rootInternal!==null&&(MN(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&fn("Cannot call "+e+" on a deleted database.")}};function jA(){U0.IS_TRANSPORT_INITIALIZED&&rt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function GA(){jA(),Ma.forceDisallow()}function KA(){jA(),Ps.forceDisallow(),Ma.forceAllow()}function zA(n,e,t,i={}){n=ne(n),n._checkNotDeleted("useEmulator");let r=`${e}:${t}`,s=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&xr(i,s.repoInfo_.emulatorOptions))return;fn("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&fn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Da(Da.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:kl(i.mockUserToken,n.app.options.projectId);o=new Da(a)}FN(s,r,i,o)}function WA(n){n=ne(n),n._checkNotDeleted("goOffline"),TA(n._repo)}function $A(n){n=ne(n),n._checkNotDeleted("goOnline"),bN(n._repo)}function HA(n,e){E0(n,e)}function BN(n){i_(Ll),Mi(new yt("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return F_(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Mt(qI,jI,n),Mt(qI,jI,"esm2017")}var UN={".sv":"timestamp"};function QA(){return UN}function YA(n){return{".sv":{increment:n}}}var t_=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function XA(n,e,t){var i;if(n=ne(n),Et("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let r=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,s=new ze,o=(c,u,d)=>{let p=null;c?s.reject(c):(p=new Bs(d,new At(n._repo,n._path),me),s.resolve(new t_(u,p)))},a=yh(n,()=>{});return SN(n._repo,n._path,e,o,a,r),s.promise}l_.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};l_.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};BN();var qN="@firebase/database-compat",jN="2.0.4";var GN=new Wn("@firebase/database-compat"),JA=function(n){let e="FIREBASE WARNING: "+n;GN.warn(e)};var KN=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(ft(n,e)+"must be a boolean.")},zN=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ft(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var M_=class{constructor(e){this._delegate=e}cancel(e){$("OnDisconnect.cancel",0,1,arguments.length),Ue("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){$("OnDisconnect.remove",0,1,arguments.length),Ue("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){$("OnDisconnect.set",1,2,arguments.length),Ue("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){$("OnDisconnect.setWithPriority",2,3,arguments.length),Ue("OnDisconnect.setWithPriority","onComplete",i,!0);let r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if($("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,JA("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ue("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}};var L_=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return $("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Er=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return $("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return $("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return $("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return $("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return $("DataSnapshot.child",0,1,arguments.length),e=String(e),Gs("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return $("DataSnapshot.hasChild",1,1,arguments.length),Gs("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return $("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return $("DataSnapshot.forEach",1,1,arguments.length),Ue("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return $("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return $("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return $("DataSnapshot.ref",0,0,arguments.length),new Mn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},vh=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;$("Query.on",2,4,arguments.length),Ue("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,r),a=(u,d)=>{t.call(o.context,new Er(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return yh(this._delegate,a,c),t;case"child_added":return N_(this._delegate,a,c),t;case"child_removed":return V_(this._delegate,a,c),t;case"child_changed":return k_(this._delegate,a,c),t;case"child_moved":return D_(this._delegate,a,c),t;default:throw new Error(ft("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if($("Query.off",0,3,arguments.length),zN("Query.off",e,!0),Ue("Query.off","callback",t,!0),sd("Query.off","context",i,!0),t){let r=()=>{};r.userCallback=t,r.context=i,O_(this._delegate,e,r)}else O_(this._delegate,e)}get(){return xA(this._delegate).then(e=>new Er(this.database,e))}once(e,t,i,r){$("Query.once",1,4,arguments.length),Ue("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",i,r),o=new ze,a=(u,d)=>{let p=new Er(this.database,u);t&&t.call(s.context,p,d),o.resolve(p)};a.userCallback=t,a.context=s.context;let c=u=>{s.cancel&&s.cancel.call(s.context,u),o.reject(u)};switch(e){case"value":yh(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":N_(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":V_(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":k_(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":D_(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(ft("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return $("Query.limitToFirst",1,1,arguments.length),new n(this.database,Dt(this._delegate,OA(e)))}limitToLast(e){return $("Query.limitToLast",1,1,arguments.length),new n(this.database,Dt(this._delegate,FA(e)))}orderByChild(e){return $("Query.orderByChild",1,1,arguments.length),new n(this.database,Dt(this._delegate,MA(e)))}orderByKey(){return $("Query.orderByKey",0,0,arguments.length),new n(this.database,Dt(this._delegate,LA()))}orderByPriority(){return $("Query.orderByPriority",0,0,arguments.length),new n(this.database,Dt(this._delegate,BA()))}orderByValue(){return $("Query.orderByValue",0,0,arguments.length),new n(this.database,Dt(this._delegate,UA()))}startAt(e=null,t){return $("Query.startAt",0,2,arguments.length),new n(this.database,Dt(this._delegate,DA(e,t)))}startAfter(e=null,t){return $("Query.startAfter",0,2,arguments.length),new n(this.database,Dt(this._delegate,VA(e,t)))}endAt(e=null,t){return $("Query.endAt",0,2,arguments.length),new n(this.database,Dt(this._delegate,NA(e,t)))}endBefore(e=null,t){return $("Query.endBefore",0,2,arguments.length),new n(this.database,Dt(this._delegate,kA(e,t)))}equalTo(e,t){return $("Query.equalTo",1,2,arguments.length),new n(this.database,Dt(this._delegate,qA(e,t)))}toString(){return $("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return $("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if($("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,Ue(e,"cancel",r.cancel,!0),r.context=i,sd(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error(ft(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new Mn(this.database,new At(this._delegate._repo,this._delegate._path))}},Mn=class n extends vh{constructor(e,t){super(e,new dt(t._repo,t._path,new Ga,!1)),this.database=e,this._delegate=t}getKey(){return $("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return $("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Ri(this._delegate,e))}getParent(){$("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return $("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){$("Reference.set",1,2,arguments.length),Ue("Reference.set","onComplete",t,!0);let i=_h(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if($("Reference.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,JA("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Et("Reference.update",this._delegate._path),Ue("Reference.update","onComplete",t,!0);let i=PA(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){$("Reference.setWithPriority",2,3,arguments.length),Ue("Reference.setWithPriority","onComplete",i,!0);let r=RA(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){$("Reference.remove",0,1,arguments.length),Ue("Reference.remove","onComplete",e,!0);let t=bA(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){$("Reference.transaction",1,3,arguments.length),Ue("Reference.transaction","transactionUpdate",e,!1),Ue("Reference.transaction","onComplete",t,!0),KN("Reference.transaction","applyLocally",i,!0);let r=XA(this._delegate,e,{applyLocally:i}).then(s=>new L_(s.committed,new Er(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){$("Reference.setPriority",1,2,arguments.length),Ue("Reference.setPriority","onComplete",t,!0);let i=SA(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){$("Reference.push",0,2,arguments.length),Ue("Reference.push","onComplete",t,!0);let i=CA(this._delegate,e),r=i.then(o=>new n(this.database,o));t&&r.then(()=>t(null),o=>t(o));let s=new n(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return Et("Reference.onDisconnect",this._delegate._path),new M_(new Xu(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Ir=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:GA,forceLongPolling:KA}}useEmulator(e,t,i={}){zA(this._delegate,e,t,i)}ref(e){if($("database.ref",0,1,arguments.length),e instanceof Mn){let t=x_(this._delegate,e.toString());return new Mn(this,t)}else{let t=P_(this._delegate,e);return new Mn(this,t)}}refFromURL(e){$("database.refFromURL",1,1,arguments.length);let i=x_(this._delegate,e);return new Mn(this,i)}goOffline(){return $("database.goOffline",0,0,arguments.length),WA(this._delegate)}goOnline(){return $("database.goOnline",0,0,arguments.length),$A(this._delegate)}};Ir.ServerValue={TIMESTAMP:QA(),increment:n=>YA(n)};function WN({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:r,namespace:s,nodeAdmin:o=!1}){i_(t);let a=new od("database-standalone"),c=new Fl("auth-internal",a);c.setComponent(new yt("auth-internal",()=>i,"PRIVATE"));let u;return r&&(u=new Fl("app-check-internal",a),u.setComponent(new yt("app-check-internal",()=>r,"PRIVATE"))),{instance:new Ir(F_(n,c,u,e,o),n),namespace:s}}var $N=Object.freeze({__proto__:null,initStandalone:WN});var HN=Ir.ServerValue;function QN(n){n.INTERNAL.registerComponent(new yt("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new Ir(r,i)},"PUBLIC").setServiceProps({Reference:Mn,Query:vh,Database:Ir,DataSnapshot:Er,enableLogging:HA,INTERNAL:$N,ServerValue:HN}).setMultipleInstances(!0)),n.registerVersion(qN,jN)}QN(qe);function ol(n,e,t="on",i=Rr){return new jn(r=>{let s=null;return s=n[t](e,(o,a)=>{i.schedule(()=>{r.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>r.complete())},o=>{i.schedule(()=>r.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ae(r=>{let{snapshot:s,prevKey:o}=r,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),jy())}function YN(n){return typeof n=="string"}function XN(n){return typeof n.exportVal=="function"}function iC(n){return n==null}function rC(n){return typeof n.set=="function"}function ZA(n,e){return rC(e)?e:n.ref(e)}function sC(n,e){if(YN(n))return e.stringCase();if(rC(n))return e.firebaseCase();if(XN(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function oC(n){return(iC(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function aC(n,e,t){e=oC(e);let i=e.map(r=>ol(n,r,"on",t));return ho(...i)}function JN(n,e,t){let i=aC(n,e).pipe(Vi((r,s)=>[...r,s],[]));return ek(n,i,t)}function ZN(n,e){return ol(n,"value","on",e).pipe(Ae(t=>{let i;return t.payload.forEach(r=>(i=r.key,!1)),{data:t,lastKeyToLoad:i}}))}function ek(n,e,t){return ZN(n,t).pipe(Ky(e),Ae(([r,s])=>{let o=r.lastKeyToLoad,a=s.map(c=>c.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),Gy(r=>r.loadedKeys.indexOf(r.lastKeyToLoad)===-1),Ae(r=>r.actions))}function eC(n,e){return function(i,r){return sC(i,{stringCase:()=>n.child(i)[e](r),firebaseCase:()=>i[e](r),snapshotCase:()=>i.ref[e](r)})}}function tk(n){return function(t){return t?sC(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function nk(n,e,t){return ol(n,"value","once",t).pipe(vn(i=>{let r=[Qt(i)];return e.forEach(s=>r.push(ol(n,s,"on",t))),ho(...r).pipe(Vi(rk,[]))}),Cl())}function lC(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function ik(n,e){if(iC(e))return 0;{let t=lC(n,e);return t===-1?n.length:t+1}}function rk(n,e){let{payload:t,prevKey:i,key:r}=e,s=lC(n,r),o=ik(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,u],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==i&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===r?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function tC(n,e,t){return e=oC(e),nk(n,e,t)}function sk(n,e,t){let i=e.schedulers.outsideAngular,r=be(De).run(()=>n.ref);return{query:n,update:eC(r,"update"),set:eC(r,"set"),push:s=>r.push(s),remove:tk(r),snapshotChanges(s){return tC(n,s,i).pipe(Se(t))},stateChanges(s){return aC(n,s,i).pipe(Se(t))},auditTrail(s){return JN(n,s,i).pipe(Se(t))},valueChanges(s,o){return tC(n,s,i).pipe(Ae(c=>c.map(u=>o&&o.idField?Ot(Ke({},u.payload.val()),{[o.idField]:u.key}):u.payload.val())),Se(t))}}}function nC(n,e){return function(){return ol(n,"value","on",e)}}function ok(n,e,t){return{query:n,snapshotChanges(){return nC(n,e.schedulers.outsideAngular)().pipe(Se(t))},update(i){return n.ref.update(i)},set(i){return n.ref.set(i)},remove(){return n.ref.remove()},valueChanges(){return nC(n,e.schedulers.outsideAngular)().pipe(Se(t),Ae(r=>r.payload.exists()?r.payload.val():null))}}}var ak=new ke("angularfire2.realtimeDatabaseURL"),lk=new ke("angularfire2.database.use-emulator"),ck=(()=>{class n{schedulers;database;injector=be(wn);constructor(t,i,r,s,o,a,c,u,d,p,m,y,C,P,k){this.schedulers=a;let q=c,j=Ui(t,o,i);u&&Do(j,o,d,m,y,C,p,P),this.database=kr(`${j.name}.database.${r}`,"AngularFireDatabase",j.name,()=>{let F=o.runOutsideAngular(()=>j.database(r||void 0));return q&&F.useEmulator(...q),F},[q])}list(t,i){let r=be(De).runOutsideAngular(()=>ZA(this.database,t)),s=r;return i&&(s=i(r)),sk(s,this,this.injector)}object(t){let i=be(De).runOutsideAngular(()=>ZA(this.database,t));return ok(i,this,this.injector)}createPushId(){return be(De).runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(z($n),z(Hn,8),z(ak,8),z(Kn),z(De),z(Bi),z(lk,8),z(Vo,8),z(So,8),z(Ro,8),z(Po,8),z(xo,8),z(No,8),z(ko,8),z(Yn,8))};static \u0275prov=bt({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Q1=(()=>{class n{constructor(){qe.registerVersion("angularfire",Zt.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Xt({type:n});static \u0275inj=Yt({providers:[ck]})}return n})();var J1={production:!0,firebase:{apiKey:"***************************************",authDomain:"************************",projectId:"***********************************",storageBucket:"************************",messagingSenderId:"*********************",appId:"*******************************************",measurementId:"*********************"}};export{Li as a,uk as b,hk as c,Bl as d,uv as e,hv as f,dk as g,gv as h,Pk as i,Xk as j,Vo as k,MD as l,v1 as m,Q1 as n,J1 as o};
